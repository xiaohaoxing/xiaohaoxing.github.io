<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>éƒ¨ç½² FRP åå‘ä»£ç†æµç¨‹</title>
      <link href="/2023/04/14/%E9%83%A8%E7%BD%B2-FRP-%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E6%B5%81%E7%A8%8B/"/>
      <url>/2023/04/14/%E9%83%A8%E7%BD%B2-FRP-%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E6%B5%81%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘æœ‰å¥½å‡ ä¸ªæœºå™¨éƒ½è¦ç”¨åå‘ä»£ç†èƒ½åŠ›å°†å†…ç½‘çš„æœºå™¨æ˜ å°„å‡ºæ¥ï¼Œåšå¤šäº†å°±æˆäº†æœºæ¢°æ“ä½œï¼Œè¿™é‡ŒæŠŠå…·ä½“æ“ä½œæµç¨‹å†™ä¸‹æ¥ï¼Œæ–¹ä¾¿è‡ªå·±ä¹Ÿæ–¹ä¾¿å¤§å®¶å‚è€ƒã€‚</p><h1>å‰ç½®æ¡ä»¶</h1><ul><li>æœ‰å…¬ç½‘ IP çš„æœºå™¨ä¸€å°</li><li>éœ€è¦æ˜ å°„çš„æœºå™¨ N å°</li></ul><h1>æœåŠ¡ç«¯æµç¨‹</h1><p>é¦–å…ˆåœ¨æœ‰å…¬ç½‘ IP çš„æœºå™¨ä¸Šéƒ¨ç½²æœåŠ¡ç«¯ï¼ˆserverï¼‰ï¼Œä¾›å…¶ä»–çš„æœºå™¨è¿æ¥ã€‚</p><ol><li>ä¸‹è½½ FRP çš„æœ€æ–°ç‰ˆæœ¬</li></ol><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">wget</span> https://github.com/fatedier/frp/releases/download/v0.48.0/frp_0.48.0_linux_amd64.tar.gz </code></pre><ol start="2"><li>è§£å‹å¹¶æ”¾åˆ°ä»»æ„ä½ æ–¹ä¾¿è®°å¿†çš„ç›®å½•</li></ol><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># è§£å‹</span><span class="token function">tar</span> -zxvf frp_0.48.0_linux_amd64.tar.gz<span class="token comment"># è¿›å…¥æ–‡ä»¶å¤¹</span><span class="token builtin class-name">cd</span> frp_0.48.0_linux_amd64<span class="token comment"># åˆ›å»ºæ–‡ä»¶å¤¹</span><span class="token function">sudo</span> <span class="token function">mkdir</span> /usr/lib/frp<span class="token comment"># ç§»åŠ¨æœåŠ¡ç«¯ç¨‹åº</span><span class="token function">sudo</span> <span class="token function">cp</span> frps /usr/lib/frp/<span class="token comment"># ç§»åŠ¨æœåŠ¡ç«¯é…ç½®</span><span class="token function">sudo</span> <span class="token function">cp</span> frps.ini /usr/lib/frp/</code></pre><ol start="3"><li>å‰å¾€é…ç½®æœåŠ¡ç«¯</li></ol><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">vim</span> /usr/lib/frp/frps.ini</code></pre><pre class="language-ini" data-language="ini"><code class="language-ini"><span class="token header"><span class="token punctuation">[</span><span class="token section-name selector">common</span><span class="token punctuation">]</span></span><span class="token comment"># å…¶ä»–çš„ä¹Ÿè¡Œï¼Œä¸ä¸‹é¢å®¢æˆ·ç«¯é…ç½®ä¿æŒä¸€è‡´å³å¯</span><span class="token key attr-name">bind_port</span> <span class="token punctuation">=</span> <span class="token value attr-value">7001</span> <span class="token key attr-name">token</span> <span class="token punctuation">=</span> <span class="token value attr-value">[YOUR_TOKEN]</span><span class="token key attr-name">dashboard_port</span> <span class="token punctuation">=</span> <span class="token value attr-value">8080</span> <span class="token key attr-name">databoard_user</span> <span class="token punctuation">=</span> <span class="token value attr-value">[YOUR_USERNAME]</span><span class="token key attr-name">dashboard_pwd</span> <span class="token punctuation">=</span> <span class="token value attr-value">[YOUR_PASSWORD]</span><span class="token key attr-name">enable_prometheus</span> <span class="token punctuation">=</span> <span class="token value attr-value">true</span><span class="token key attr-name">log_file</span> <span class="token punctuation">=</span> <span class="token value attr-value">/usr/lib/frp/frps.log</span><span class="token key attr-name">log_level</span> <span class="token punctuation">=</span> <span class="token value attr-value">info</span><span class="token key attr-name">log_max_days</span> <span class="token punctuation">=</span> <span class="token value attr-value">7</span></code></pre><ol start="4"><li>ç¼–å†™æœåŠ¡ç«¯ç¨‹åºçš„ç³»ç»ŸæœåŠ¡</li></ol><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># è¿™é‡Œæ˜¯/usr/lib/...ï¼Œç”¨æˆ·çº§åˆ«çš„ç³»ç»ŸæœåŠ¡</span><span class="token function">sudo</span> <span class="token function">vim</span> /usr/lib/systemd/system/frps.service</code></pre><pre class="language-ini" data-language="ini"><code class="language-ini"><span class="token header"><span class="token punctuation">[</span><span class="token section-name selector">Unit</span><span class="token punctuation">]</span></span><span class="token key attr-name">Description</span><span class="token punctuation">=</span><span class="token value attr-value">Frp Server Service</span><span class="token key attr-name">After</span><span class="token punctuation">=</span><span class="token value attr-value">network.target</span><span class="token header"><span class="token punctuation">[</span><span class="token section-name selector">Service</span><span class="token punctuation">]</span></span><span class="token key attr-name">Type</span><span class="token punctuation">=</span><span class="token value attr-value">simple</span><span class="token key attr-name">User</span><span class="token punctuation">=</span><span class="token value attr-value">nobody</span><span class="token key attr-name">Restart</span><span class="token punctuation">=</span><span class="token value attr-value">on-failure</span><span class="token key attr-name">RestartSec</span><span class="token punctuation">=</span><span class="token value attr-value">5s</span><span class="token key attr-name">ExecStart</span><span class="token punctuation">=</span><span class="token value attr-value">/usr/lib/frp/frps -c /usr/lib/frp/frps.ini</span><span class="token header"><span class="token punctuation">[</span><span class="token section-name selector">Install</span><span class="token punctuation">]</span></span><span class="token key attr-name">WantedBy</span><span class="token punctuation">=</span><span class="token value attr-value">multi-user.target</span></code></pre><ol start="5"><li>ä½¿ç”¨ç³»ç»ŸæœåŠ¡çš„æ–¹å¼å¯åŠ¨æœåŠ¡ç«¯ç¨‹åº &amp; å¯ç”¨å¼€æœºè‡ªåŠ¨å¯åŠ¨</li></ol><pre class="language-bash" data-language="bash"><code class="language-bash">systemctl start frpssystemctl <span class="token builtin class-name">enable</span> frps</code></pre><ol start="6"><li>åœ¨æµè§ˆå™¨ä¸Šè¾“å…¥ <code>[IP]:8080</code> è¿›å…¥æ§åˆ¶å°ï¼ˆè´¦å·å¯†ç åœ¨ç¬¬ä¸‰æ­¥è®¾ç½®äº†ï¼‰ï¼ŒæŸ¥çœ‹æœåŠ¡æ˜¯å¦æ­£å¸¸å¯åŠ¨äº†ã€‚å¦‚æœå‡ºç°ç•Œé¢åˆ™è¡¨ç¤ºæœåŠ¡ç«¯å·²ç»æ­£å¸¸å¯åŠ¨äº†~ğŸ‰</li></ol><p><img onerror="imgOnError(this);" data-fancybox="gallery" src="https://xiaohaoxing-1257815318.cos.ap-chengdu.myqcloud.com/image-20230414185831869.png" alt="image-20230414185831869" data-caption="image-20230414185831869" loading="lazy"></p><h1>å®¢æˆ·ç«¯æµç¨‹</h1><p>å®¢æˆ·ç«¯æµç¨‹åŸºæœ¬åŒä¸Šï¼Œä¸åŒçš„åœ°æ–¹ä¼šæ ‡è¯†å‡ºæ¥ã€‚åœ¨å†…ç½‘ç¯å¢ƒçš„è®¾å¤‡ä¸Šæ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p><ol><li>ä¸‹è½½ FRP çš„æœ€æ–°ç‰ˆæœ¬</li></ol><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">wget</span> https://github.com/fatedier/frp/releases/download/v0.48.0/frp_0.48.0_linux_amd64.tar.gz </code></pre><ol start="2"><li>è§£å‹å¹¶æ”¾åˆ°ä»»æ„ä½ æ–¹ä¾¿è®°å¿†çš„ç›®å½•</li></ol><blockquote><p>âš ï¸  <span style="color:red">ç§»åŠ¨å®¢æˆ·ç«¯ç¨‹åºå’Œé…ç½®ï¼</span></p></blockquote><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># è§£å‹</span><span class="token function">tar</span> -zxvf frp_0.48.0_linux_amd64.tar.gz<span class="token comment"># è¿›å…¥æ–‡ä»¶å¤¹</span><span class="token builtin class-name">cd</span> frp_0.48.0_linux_amd64<span class="token comment"># åˆ›å»ºæ–‡ä»¶å¤¹</span><span class="token function">sudo</span> <span class="token function">mkdir</span> /usr/lib/frp<span class="token comment"># ç§»åŠ¨å®¢æˆ·ç«¯ç¨‹åº</span><span class="token function">sudo</span> <span class="token function">cp</span> frpc /usr/lib/frp/<span class="token comment"># ç§»åŠ¨å®¢æˆ·ç«¯é…ç½®</span><span class="token function">sudo</span> <span class="token function">cp</span> frpc.ini /usr/lib/frp/</code></pre><ol start="3"><li>å‰å¾€é…ç½®å®¢æˆ·ç«¯</li></ol><blockquote><p>âš ï¸  <span style="color:red">é…ç½®å®¢æˆ·ç«¯çš„é…ç½®æ–‡ä»¶ï¼Œæœ‰æ‰€ä¸åŒï¼</span></p></blockquote><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">vim</span> /usr/lib/frp/frpc.ini</code></pre><pre class="language-ini" data-language="ini"><code class="language-ini"><span class="token header"><span class="token punctuation">[</span><span class="token section-name selector">common</span><span class="token punctuation">]</span></span><span class="token key attr-name">server_addr</span> <span class="token punctuation">=</span> <span class="token value attr-value">[YOUR_PUBLIC_IP_ADDRESS]</span><span class="token key attr-name">server_port</span> <span class="token punctuation">=</span> <span class="token value attr-value">7001</span><span class="token comment"># åœ¨ä¸Šé¢æœåŠ¡ç«¯é…ç½®çš„ token</span><span class="token key attr-name">token</span> <span class="token punctuation">=</span> <span class="token value attr-value">[YOUR_SERVER_CONFIG_TOKEN]</span> <span class="token comment"># è¿™æ˜¯ä½ åœ¨æœåŠ¡ç«¯ç®¡ç†ç•Œé¢ä¸Šçœ‹åˆ°çš„åç§°ï¼Œå¯ä»¥ä»»æ„èµ·åã€‚</span><span class="token header"><span class="token punctuation">[</span><span class="token section-name selector">cs-lab</span><span class="token punctuation">]</span></span>  <span class="token key attr-name">type</span> <span class="token punctuation">=</span> <span class="token value attr-value">tcp</span><span class="token key attr-name">local_ip</span> <span class="token punctuation">=</span> <span class="token value attr-value">127.0.0.1</span><span class="token key attr-name">local_port</span> <span class="token punctuation">=</span> <span class="token value attr-value">22</span><span class="token comment"># æ˜ å°„åˆ°å…¬ç½‘çš„ç«¯å£</span><span class="token key attr-name">remote_port</span> <span class="token punctuation">=</span> <span class="token value attr-value">20022</span> </code></pre><ol start="4"><li>ç¼–å†™å®¢æˆ·ç«¯ç«¯ç¨‹åºçš„ç³»ç»ŸæœåŠ¡</li></ol><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">vim</span> /usr/lib/systemd/system/frpc.service</code></pre><pre class="language-ini" data-language="ini"><code class="language-ini"><span class="token header"><span class="token punctuation">[</span><span class="token section-name selector">Unit</span><span class="token punctuation">]</span></span><span class="token key attr-name">Description</span><span class="token punctuation">=</span><span class="token value attr-value">Frp Client Service</span><span class="token key attr-name">After</span><span class="token punctuation">=</span><span class="token value attr-value">network.target</span><span class="token header"><span class="token punctuation">[</span><span class="token section-name selector">Service</span><span class="token punctuation">]</span></span><span class="token key attr-name">Type</span><span class="token punctuation">=</span><span class="token value attr-value">simple</span><span class="token key attr-name">User</span><span class="token punctuation">=</span><span class="token value attr-value">nobody</span><span class="token key attr-name">Restart</span><span class="token punctuation">=</span><span class="token value attr-value">on-failure</span><span class="token key attr-name">RestartSec</span><span class="token punctuation">=</span><span class="token value attr-value">5s</span><span class="token key attr-name">ExecStart</span><span class="token punctuation">=</span><span class="token value attr-value">/usr/lib/frp/frpc -c /usr/lib/frp/frpc.ini</span><span class="token header"><span class="token punctuation">[</span><span class="token section-name selector">Install</span><span class="token punctuation">]</span></span><span class="token key attr-name">WantedBy</span><span class="token punctuation">=</span><span class="token value attr-value">multi-user.target</span></code></pre><ol start="5"><li>ä½¿ç”¨ç³»ç»ŸæœåŠ¡çš„æ–¹å¼å¯åŠ¨æœåŠ¡ç«¯ç¨‹åº &amp; å¯ç”¨å¼€æœºè‡ªå¯</li></ol><pre class="language-bash" data-language="bash"><code class="language-bash">systemctl start frpcsystemctl <span class="token builtin class-name">enable</span> frpc</code></pre><ol start="6"><li>åœ¨æ§åˆ¶å°åˆ·æ–°ä¸€ä¸‹æŸ¥çœ‹ proxyï¼Œå¦‚æœå‡ºç°æ–°æ¡ç›®åˆ™è¡¨ç¤ºå¯åŠ¨æˆåŠŸäº†ï¼ğŸ‰</li></ol><p><img onerror="imgOnError(this);" data-fancybox="gallery" src="https://xiaohaoxing-1257815318.cos.ap-chengdu.myqcloud.com/image-20230414192401048.png" alt="image-20230414192401048" data-caption="image-20230414192401048" loading="lazy"></p><h1>Q&amp;A</h1><p>å¦‚æœå¯åŠ¨å‡ºç°é—®é¢˜ä¹Ÿä¸ç”¨ç´§å¼ ï¼Œç³»ç»ŸæœåŠ¡è™½ç„¶å½“åœºä¸ä¼šæ˜¾ç¤ºé”™è¯¯æ—¥å¿—ï¼Œä¸è¿‡å¯ä»¥é€šè¿‡ <code>journalctl -u frp</code> å‘½ä»¤æŸ¥çœ‹å¯¹åº”çš„æ—¥å¿—ä»è€Œæ’æŸ¥é”™è¯¯ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> æ•™ç¨‹ </tag>
            
            <tag> frp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è§£å†³å›½å†… OpenStreetMap åœ°å›¾æ— æ³•æ˜¾ç¤ºçš„é—®é¢˜</title>
      <link href="/2023/04/11/%E8%A7%A3%E5%86%B3%E5%9B%BD%E5%86%85-OpenStreetMap-%E5%9C%B0%E5%9B%BE%E6%97%A0%E6%B3%95%E6%98%BE%E7%A4%BA%E7%9A%84%E9%97%AE%E9%A2%98/"/>
      <url>/2023/04/11/%E8%A7%A3%E5%86%B3%E5%9B%BD%E5%86%85-OpenStreetMap-%E5%9C%B0%E5%9B%BE%E6%97%A0%E6%B3%95%E6%98%BE%E7%A4%BA%E7%9A%84%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<p>ä»Šå¤©å»å¼€ä¼šï¼Œäº†è§£åˆ°å¸ˆå¼Ÿé‚£è¾¹é¡¹ç›®é‡åˆ°äº†ä¸€ä¸ªé—®é¢˜ï¼šOpenStreetMap çš„åœ°å›¾ç»„ä»¶åœ¨å›½å†…ç½‘ç»œç¯å¢ƒåˆ™åŠ è½½ä¸å‡ºæ¥ã€‚æœ¬ç€åŠ©äººä¸ºä¹çš„ç²¾ç¥ï¼Œæˆ‘ä¸»åŠ¨æ‰¿æ‹…äº†å¸®åŠ©è§£å†³è¿™ä¸ªé—®é¢˜çš„ä»»åŠ¡ã€‚</p><span id="more"></span><h2 id="â“é—®é¢˜å¤ç°"><a class="header-anchor" href="#â“é—®é¢˜å¤ç°">Â¶</a>â“é—®é¢˜å¤ç°</h2><p>ç½‘ç«™åœ°å€ï¼š <a href="http://sheng.whu.edu.cn/spadas/">http://sheng.whu.edu.cn/spadas/</a>, åœ¨æ‰“å¼€è¯¥åœ°å€åï¼Œå¯ä»¥çœ‹åˆ°åœ°å›¾ä¸Šçš„æ ‡æ³¨å¯ä»¥åŠ è½½ï¼Œä½†æ˜¯åº•å›¾æ²¡æœ‰å‡ºæ¥ã€‚åƒè¿™æ ·å­ï¼š</p><p><img onerror="imgOnError(this);" data-fancybox="gallery" src="https://xiaohaoxing-1257815318.cos.ap-chengdu.myqcloud.com/image-20230411010153737.png" alt="image-20230411010153737" data-caption="image-20230411010153737" loading="lazy"></p><p>åœ¨æ‰“å¼€ F12 ç½‘ç»œæƒ…å†µåå‘ç°ï¼Œå’Œå…¶ä»–çš„åœ°å›¾åŠ è½½æ–¹å¼ä¸€æ ·ï¼ŒOpenStreetMap ä¹Ÿæ˜¯ä½¿ç”¨äº†åœ°å›¾åˆ†å—å›¾å±‚çš„æ–¹å¼åŠ è½½çš„ï¼Œæ¯ä¸ªåŒºå—éƒ½æ˜¯å•ç‹¬åœ¨åŸŸåä¸‹ <code>a.tile.openstreetmap.org</code> å»è·å–çš„ã€‚è€Œè¿™ä¸ªåŸŸåé€šè¿‡ ping å‘ç°åœ¨å›½å†…ç½‘ç»œæ˜¯æ— æ³•è®¿é—®çš„ï¼š</p><p><img onerror="imgOnError(this);" data-fancybox="gallery" src="https://xiaohaoxing-1257815318.cos.ap-chengdu.myqcloud.com/image-20230411010620924.png" alt="image-20230411010620924" data-caption="image-20230411010620924" loading="lazy"></p><p>æœ€ç»ˆå°±ä¼šå¯¼è‡´æ‰€æœ‰å›¾å±‚çš„å›¾åƒè·å–å¤±è´¥ï¼Œåœ°å›¾æ˜¾ç¤ºç©ºç™½ï¼š</p><p><img onerror="imgOnError(this);" data-fancybox="gallery" src="https://xiaohaoxing-1257815318.cos.ap-chengdu.myqcloud.com/image-20230411010646445.png" alt="image-20230411010646445" data-caption="image-20230411010646445" loading="lazy"></p><h2 id="ğŸ‘Œ-è§£å†³æ–¹æ¡ˆ"><a class="header-anchor" href="#ğŸ‘Œ-è§£å†³æ–¹æ¡ˆ">Â¶</a>ğŸ‘Œ è§£å†³æ–¹æ¡ˆ</h2><p>ç¡®è®¤äº†é—®é¢˜ï¼Œä¸‹é¢å°±æ˜¯å»æ‰¾å¯¹åº”çš„è§£å†³æ–¹æ¡ˆã€‚å› ä¸ºå·²ç»å®šä½åˆ°æ˜¯åŸŸåçš„é—®é¢˜ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥å°±ç›´å¥”ä¸»é¢˜ï¼Œå»æ‰¾ OpenStreetMap çš„ CDN åŠ é€Ÿæ–¹æ¡ˆã€‚ç»è¿‡ä¸€ç•ªæœå¯»ï¼Œæœ€ç»ˆå‘ç° OpenStreetMap <a href="https://wiki.openstreetmap.org/wiki/Raster_tile_providers">å®˜ç½‘</a> åˆ—ä¸¾å‡ºäº†æ‰€æœ‰å›¾å±‚æ•°æ®çš„æœåŠ¡æä¾›å•†ï¼ˆå…è´¹/å•†ç”¨ï¼‰åŸŸååœ°å€ï¼Œurl ç»“æ„å¤§éƒ¨åˆ†ä¸º <code>https://&#123;s&#125;.tile.[DOMAIN]/&#123;z&#125;/&#123;x&#125;/&#123;y&#125;.png</code>ï¼Œè¿™å’Œä¸Šé¢çš„è®¿é—®å¤±è´¥çš„ç»“æ„å®Œå…¨ä¸€è‡´ï¼Œå¯ä»¥æ–­å®šå°±æ˜¯ä¿®æ”¹è¿™ä¸ª URL å³å¯æ›¿æ¢æ‰å›¾åƒçš„è·å–åœ°å€ï¼Œç¡®ä¿åœ°å›¾çš„æ­£ç¡®åŠ è½½ã€‚</p><p>æ¥ä¸‹æ¥åœ¨é¡¹ç›®å‰ç«¯ä»£ç é‡Œæœç´¢ <code>openstreetmap.org</code>è¯¥åŸŸåï¼Œå¾ˆå®¹æ˜“æ‰¾åˆ°äº†å¯¹åº”çš„é…ç½®é¡¹ï¼š<img onerror="imgOnError(this);" data-fancybox="gallery" src="https://xiaohaoxing-1257815318.cos.ap-chengdu.myqcloud.com/image-20230411011425496.png" alt="image-20230411011425496" data-caption="image-20230411011425496" loading="lazy"></p><p>æœ€åæŠŠè¿™ä¸ª url æ¨¡æ¿åœ¨ç½‘ç«™ä¸Šæ‰¾ä¸€ä¸ªè®¿é—®é€Ÿåº¦å¿«çš„åœ°å€æ›¿æ¢æ‰ï¼Œåœ°å›¾ä¸åŠ è½½çš„é—®é¢˜å°±è§£å†³äº†ğŸ‰</p><p><img onerror="imgOnError(this);" data-fancybox="gallery" src="https://xiaohaoxing-1257815318.cos.ap-chengdu.myqcloud.com/image-20230411011821681.png" alt="image-20230411011821681" data-caption="image-20230411011821681" loading="lazy"></p>]]></content>
      
      
      
        <tags>
            
            <tag> æ•™ç¨‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¯¼å‡ºå¾®ä¿¡èŠå¤©è®°å½•</title>
      <link href="/2022/11/15/%E5%AF%BC%E5%87%BA%E5%BE%AE%E4%BF%A1%E8%81%8A%E5%A4%A9%E8%AE%B0%E5%BD%95/"/>
      <url>/2022/11/15/%E5%AF%BC%E5%87%BA%E5%BE%AE%E4%BF%A1%E8%81%8A%E5%A4%A9%E8%AE%B0%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<h2 id="èƒŒæ™¯"><a class="header-anchor" href="#èƒŒæ™¯">Â¶</a>èƒŒæ™¯</h2><p>å¥³æœ‹å‹è®ºæ–‡éœ€è¦å¼•ç”¨å¾®ä¿¡ç¾¤çš„èŠå¤©è®°å½•ä½œä¸ºæ•°æ®åˆ†æï¼Œå› æ­¤æœ‰å¯¼å‡ºæŒ‡å®šç¾¤èŠçš„æ¶ˆæ¯è®°å½•çš„éœ€æ±‚ã€‚ç›¸ä¿¡æœ‰å¾ˆå¤šé‡åº¦ä¾èµ–å¾®ä¿¡çš„æœ‹å‹ä¹Ÿæœ‰å¯¼å‡ºå¾®ä¿¡èŠå¤©è®°å½•çš„éœ€æ±‚ï¼Œå› æ­¤è¿™é‡Œè¿‡ç¨‹ç‰¹åšä¸€ä¸ªè®°å½•ï¼Œå¸Œæœ›å¯¹å¤§å®¶æœ‰å¸®åŠ©~</p><span id="more"></span><h2 id="ç›¸å…³å·¥å…·"><a class="header-anchor" href="#ç›¸å…³å·¥å…·">Â¶</a>ç›¸å…³å·¥å…·</h2><p>ä¸»è¦ä½¿ç”¨çš„å·¥å…·ä¸º <a href="http://wxbackup.imxfd.com/">wxbackup</a>ï¼Œå¾®ä¿¡èŠå¤©è®°å½•å¯¼å‡ºç¥å™¨ã€‚</p><h2 id="æ­¥éª¤"><a class="header-anchor" href="#æ­¥éª¤">Â¶</a>æ­¥éª¤</h2><ol><li><p>è¿æ¥æ‰‹æœºï¼ˆä»…é™ iOSï¼‰åˆ°ç”µè„‘ï¼Œå»ºè®®ä½¿ç”¨ Macï¼Œè™½ç„¶ä¸Šè¿°å·¥å…·æœ‰ windows å®¢æˆ·ç«¯ï¼Œä½†æ˜¯åœ¨åç»­å¯¼å‡ºè¿‡ç¨‹ä¸­å‡ºç°æŠ¥é”™å¯¼è‡´æ— æ³•è¿›è¡Œä¸‹å»ï¼Œè¿˜æ˜¯ MacOS ä¸Šæ¯”è¾ƒç¨³å®šã€‚</p></li><li><p>æ‰“å¼€ iTunesï¼ˆè€ç‰ˆæœ¬æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ Appï¼Œæ–°ç‰ˆæœ¬ MacOS å·²ç»æ•´åˆè¿› Finder äº†ï¼Œç›´æ¥åœ¨ Finder ä¾§è¾¹æ æ‰¾åˆ°å¯¹åº”çš„è®¾å¤‡å³å¯ï¼‰ã€‚</p></li><li><p>åœ¨ iTunes ä¸­æ“ä½œå¤‡ä»½åˆ°æœ¬æœºï¼Œå¦‚å›¾</p></li></ol><p><img onerror="imgOnError(this);" data-fancybox="gallery" src="https://xiaohaoxing-1257815318.cos.ap-chengdu.myqcloud.com/%E5%A4%87%E4%BB%BD%E6%8C%87%E5%BC%95.png" alt="å¤‡ä»½æŒ‡å¼•" data-caption="å¤‡ä»½æŒ‡å¼•" loading="lazy"></p><blockquote><p>å¦‚æœå’Œæˆ‘æƒ…å†µä¸€æ ·ï¼Œ Mac ç©ºé—´æœ‰é™ï¼Œæ— æ³•å¤‡ä»½åˆ°æœ¬æœºï¼Œä¹Ÿæ˜¯æœ‰è§£å†³åŠæ³•çš„ï¼Œè¯¦è§ä¸‹é¢è¡¥å……éƒ¨åˆ†è¯´æ˜ã€‚</p></blockquote><ol start="4"><li>å¯¼å‡ºå®Œæˆåï¼Œæ‰“å¼€ä¸Šé¢ä¸‹è½½çš„å¾®ä¿¡å¯¼å‡ºå·¥å…· wxbackupï¼Œå¯åŠ¨æ—¶ä¼šè‡ªåŠ¨æ£€æµ‹å¤‡ä»½ä½ç½®çš„ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°å¤‡ä»½ä¼šæç¤ºä½ æ‰‹åŠ¨æŒ‡å®šç›®å½•ï¼Œè¿™ç§æƒ…å†µå¯ä»¥æŒ‡å®š <code>~/Library/Application Support/MobileSync/Backup</code> ç›®å½•è¯•è¯•ã€‚</li></ol><blockquote><p>è²Œä¼¼æ˜¯ MacOS ç‰ˆæœ¬æ›´æ–°å¯¼è‡´çš„ï¼Œæ—§ç‰ˆæœ¬çš„ç›®å½•æ˜¯åœ¨ <code>~/Library/Application Support/Apple/MobileSync/Backup</code> ä¸‹ã€‚</p></blockquote><ol start="5"><li><p>å¦‚æœæˆåŠŸæ£€æµ‹åˆ°å¤‡ä»½ï¼Œå·¥å…·ä¼šè‡ªåŠ¨æå–å‡ºæ‰€æœ‰çš„èŠå¤©è®°å½•å±•ç¤ºä¸ºåˆ—è¡¨ï¼Œè¿™é‡Œå°±å¯ä»¥é€‰æ‹©è‡ªå·±æƒ³è¦å¯¼å‡ºçš„ç¾¤æˆ–è€…å•èŠé€‰æ‹©è¾“å‡ºä½ç½®ç›´æ¥å¯¼å‡ºäº†ã€‚</p></li><li><p>å¯¼å‡ºçš„æ ¼å¼ä¸ºé™æ€ç½‘é¡µï¼Œæ‰“å¼€æ–‡ä»¶å¤¹åæ‰“å¼€ index.html æ–‡ä»¶å³å¯é¢„è§ˆèŠå¤©ç•Œé¢ï¼Œè·ŸçœŸå®çš„å¾®ä¿¡èŠå¤©ç•Œé¢éå¸¸ç›¸ä¼¼ï¼ˆæ‚¼å¿µä¸‹ web ç‰ˆå¾®ä¿¡ï¼‰ã€‚</p></li><li><p>å¦‚æœæœ‰åç»­æ•°æ®å¤„ç†å’Œæ•°æ®åˆ†æéœ€æ±‚çš„ï¼Œæ‰€æœ‰çš„æ¶ˆæ¯æ•°æ®æ˜¯ä»¥ä¸€ä¸ª js å¤§å¯¹è±¡æ ¼å¼å­˜å‚¨åœ¨ <code>js/message.js</code> é‡Œçš„ï¼Œå¯ä»¥ç¼–å†™ä¸€ç‚¹ç®€å•çš„ JavaScript ä»£ç æ¥å¤„ç†ä¸€ä¸‹ï¼Œæ¯”å¦‚è½¬æ¢æˆ csv æˆ–è€… excel è¿™æ ·å­ã€‚è¿™é‡Œä¸å¤šåšä»‹ç»äº†ã€‚</p></li></ol><h2 id="å¦‚æœ-Mac-ç©ºé—´ä¸è¶³æ— æ³•å¤‡ä»½æ€ä¹ˆåŠï¼Ÿ"><a class="header-anchor" href="#å¦‚æœ-Mac-ç©ºé—´ä¸è¶³æ— æ³•å¤‡ä»½æ€ä¹ˆåŠï¼Ÿ">Â¶</a>å¦‚æœ Mac ç©ºé—´ä¸è¶³æ— æ³•å¤‡ä»½æ€ä¹ˆåŠï¼Ÿ</h2><p>è¿™é‡Œä¹Ÿæ˜¯æœ‰åŠæ³•çš„~åœ¨ç½‘ä¸Šæ‰¾åˆ°äº†å¦ä¸€æ¬¾ç¥å™¨ <a href="https://imazing.com/">iMazing</a>ï¼Œæ”¯æŒå°†æ‰‹æœºç›´æ¥å¤‡ä»½åˆ°å¤–éƒ¨ç©ºé—´ä¸Šï¼Œä¸‹è½½å¹¶æ‰“å¼€ iMazingï¼Œç‚¹å‡»å¤‡ä»½ï¼Œå³å¯è‡ªè¡Œé€‰æ‹©å¤‡ä»½ä½ç½®ï¼Œæ¢åˆ° U ç›˜æˆ–è€…ç§»åŠ¨ç¡¬ç›˜å³å¯ã€‚</p><p><img onerror="imgOnError(this);" data-fancybox="gallery" src="https://xiaohaoxing-1257815318.cos.ap-chengdu.myqcloud.com/iMazing.png" alt="iMazing" data-caption="iMazing" loading="lazy"></p>]]></content>
      
      
      
        <tags>
            
            <tag> æ•™ç¨‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>çˆ¬å–å¾®ä¿¡å…¬ä¼—å·æ–‡ç« </title>
      <link href="/2022/07/05/%E7%88%AC%E5%8F%96%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7%E6%96%87%E7%AB%A0/"/>
      <url>/2022/07/05/%E7%88%AC%E5%8F%96%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7%E6%96%87%E7%AB%A0/</url>
      
        <content type="html"><![CDATA[<h2 id="éœ€æ±‚èƒŒæ™¯"><a class="header-anchor" href="#éœ€æ±‚èƒŒæ™¯">Â¶</a>éœ€æ±‚èƒŒæ™¯</h2><p>Â Â ç”±äºå¾®ä¿¡å…¬ä¼—å·æ–‡ç« çš„æœç´¢åŠŸèƒ½å®åœ¨æ˜¯è¿‡äºå­±å¼±ï¼ˆåªæ”¯æŒå†…å®¹åˆ†è¯åŒ¹é…+æ˜¯å¦æœ€è¿‘è¯»è¿‡+æ’åºæ–¹å¼ï¼‰ï¼Œå¯¹äºæŸäº›å…¬ä¼—å·å†…çš„æ–‡ç« éœ€è¦è¿›è¡Œæ›´å¤šçš„æ£€ç´¢å°±åªèƒ½è‡ªå·±åŠ¨æ‰‹äº†ã€‚</p><span id="more"></span><p><img onerror="imgOnError(this);" data-fancybox="gallery" src="https://xiaohaoxing-1257815318.cos.ap-chengdu.myqcloud.com/wechat_public_account_article_search_conditions%20.jpeg" alt="å¾®ä¿¡å…¬ä¼—å·æœç´¢ç•Œé¢" data-caption="å¾®ä¿¡å…¬ä¼—å·æœç´¢ç•Œé¢" loading="lazy"></p><h2 id="è®¾è®¡æ€è·¯"><a class="header-anchor" href="#è®¾è®¡æ€è·¯">Â¶</a>è®¾è®¡æ€è·¯</h2><p>Â Â æ€»çš„è®¡åˆ’æ˜¯å°†æ–‡ç« çš„å†…å®¹éƒ½çˆ¬å–ä¸‹æ¥ä¿å­˜åœ¨è‡ªå·±çš„æ•°æ®åº“ä¸­ï¼Œåç»­éœ€è¦æŒ‰ç…§ä»»ä½•æ¡ä»¶æ£€ç´¢éƒ½å¯ä»¥å¾ˆæ–¹ä¾¿çš„è¿›è¡Œã€‚</p><p>Â Â å¾®ä¿¡å…¬ä¼—å·çš„æ–‡ç« åˆ—è¡¨åœ¨ç”µè„‘ç«¯éƒ½æ˜¯è¦åœ¨å¾®ä¿¡å†…ç½®æµè§ˆå™¨å†…æ˜¾ç¤ºçš„ï¼Œåœ¨å¤–éƒ¨æµè§ˆå™¨å¼ºè¡Œæ‰“å¼€å°±ä¼šæç¤ºï¼š<code>è¯·åœ¨å¾®ä¿¡ç«¯æ‰“å¼€</code>ã€‚ä½†æ˜¯å…·ä½“ä¸€ç¯‡æ–‡ç« å´æ˜¯å¯ä»¥åœ¨æµè§ˆå™¨æ‰“å¼€çš„ã€‚å› æ­¤ï¼Œè·å–åˆ°æ–‡ç« é“¾æ¥å†çˆ¬å–æ–‡ç« å†…å®¹ç›¸å¯¹æ˜¯æ¯”è¾ƒå®¹æ˜“åšåˆ°çš„ã€‚éš¾ç‚¹åœ¨äºå¦‚ä½•è·å–åˆ°å®Œæ•´çš„å…¬ä¼—å·æ–‡ç« åˆ—è¡¨ã€‚</p><div class="mermaid">graph LR    æŠ“å–æ–‡ç« åˆ—è¡¨è¯·æ±‚--->çˆ¬å–æ–‡ç« åˆ—è¡¨--->çˆ¬å–æ–‡ç« æ­£æ–‡--->æ¢³ç†æ–‡ç« æ•°æ®--->è¾“å‡ºå±•ç¤º;</div><h2 id="æŠ“å–æ–‡ç« åˆ—è¡¨è¯·æ±‚"><a class="header-anchor" href="#æŠ“å–æ–‡ç« åˆ—è¡¨è¯·æ±‚">Â¶</a>æŠ“å–æ–‡ç« åˆ—è¡¨è¯·æ±‚</h2><p>Â Â ç”±äºå¾®ä¿¡å…¬ä¼—å·ä¸»é¡µä¸èƒ½åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ï¼Œå› æ­¤è€ƒè™‘ä½¿ç”¨æŠ“åŒ…å·¥å…·æŠ“åˆ°è¯·æ±‚æ–‡ç« åˆ—è¡¨çš„è¯·æ±‚ã€‚<br><img onerror="imgOnError(this);" data-fancybox="gallery" src="https://xiaohaoxing-1257815318.cos.ap-chengdu.myqcloud.com/wechat_public_account_homepage.png" alt="æ–‡ç« åˆ—è¡¨è¯·æ±‚" data-caption="æ–‡ç« åˆ—è¡¨è¯·æ±‚" loading="lazy"></p><hr />&nbsp;&nbsp;Mac ä¸Šå¤§å®¶æ¨èçš„å¤§å¤šæ˜¯ [Charles](https://xclient.info/s/charles.html)è¿™æ¬¾è½¯ä»¶ã€‚ä¸è¿‡è¿™æ¬¾è½¯ä»¶åœ¨æˆ‘çš„ mac ä¸Šå¥½åƒæœ‰ç‚¹æ°´åœŸä¸æœï¼Œåæ­£å°±æ˜¯æ— æ³•æŠ“åˆ°ä»»ä½•è¯·æ±‚ã€‚<p><img onerror="imgOnError(this);" data-fancybox="gallery" src="https://xiaohaoxing-1257815318.cos.ap-chengdu.myqcloud.com/ceeb653ely8gyke9r2sfij206o06o0sv.jpg" alt="çƒ§è„‘ç­‹å‘¢_è„‘ç­‹è¡¨æƒ…" data-caption="çƒ§è„‘ç­‹å‘¢_è„‘ç­‹è¡¨æƒ…" loading="lazy"></p><p>ç„¶åå°±æ£€ç´¢åˆ°äº† windows ä¸Šå¸¸ç”¨çš„æŠ“åŒ…è½¯ä»¶ <a href="https://www.telerik.com/fiddler">Fiddler</a> å‡ºäº†ä¸€ä¸ª <a href="https://www.telerik.com/fiddler/fiddler-everywhere">Fiddler Everywhere</a>ï¼Œå¯ä»¥åœ¨ MacOS ä¸Šå®‰è£…ä½¿ç”¨ã€‚äºæ˜¯ä½¿ç”¨äº†ä¸€ä¸‹ï¼Œæ•ˆæœæ‹”ç¾¤ï¼è€Œä¸”è½¯ä»¶è¿˜æ”¯æŒ http è¯·æ±‚è°ƒè¯•ï¼ˆPostman å±ï¼‰ï¼Œç•Œé¢ä¹Ÿæ˜¯éå¸¸ç°ä»£åŒ–å¾ˆå¥½çœ‹ï¼Œæ¨èï¼</p><blockquote><p>Fiddler æŠ“åˆ°çš„å…¬ä¼—å·æ–‡ç« åˆ—è¡¨è¯·æ±‚ï¼š</p></blockquote><p><img onerror="imgOnError(this);" data-fancybox="gallery" src="https://xiaohaoxing-1257815318.cos.ap-chengdu.myqcloud.com/image-20220705164401641.png" alt="Fiddler æŠ“åˆ°çš„å…¬ä¼—å·æ–‡ç« åˆ—è¡¨" data-caption="Fiddler æŠ“åˆ°çš„å…¬ä¼—å·æ–‡ç« åˆ—è¡¨" loading="lazy"></p><h2 id="çˆ¬å–æ–‡ç« åˆ—è¡¨"><a class="header-anchor" href="#çˆ¬å–æ–‡ç« åˆ—è¡¨">Â¶</a>çˆ¬å–æ–‡ç« åˆ—è¡¨</h2><p>è¿™ä¸€æ­¥å…·ä½“æ“ä½œå°±æ˜¯ç”¨ä»£ç ä¿®æ”¹ä¸€äº›å‚æ•°å¹¶é‡æ¼”ä¸Šè¿°çš„è¯·æ±‚ï¼Œå°†ç›¸åº”çš„ç»“æœæ‹¼æ¥ä¿å­˜ï¼Œä»è€Œè·å–æ•´ä¸ªå…¬ä¼—å·çš„æ‰€æœ‰æ–‡ç« é“¾æ¥~</p><p>å°†æŠ“å–çš„è¯·æ±‚çš„ urlã€methodã€headersã€params éƒ½ç²˜è´´å‡ºæ¥ï¼Œæ”¾åˆ° postman é‡Œä¿®æ”¹ä¸€ä¸‹ offset å‚æ•°å†æ¬¡è¯·æ±‚ç¡®è®¤æ˜¯å¯ä»¥æ­£å¸¸æ‰§è¡Œçš„ï¼š</p><p><img onerror="imgOnError(this);" data-fancybox="gallery" src="https://xiaohaoxing-1257815318.cos.ap-chengdu.myqcloud.com/image-20220705165346083.png" alt="Postman è¯·æ±‚" data-caption="Postman è¯·æ±‚" loading="lazy"></p><p>å±•å¼€å³è¾¹çš„ä»£ç ï¼Œé€‰æ‹©ä½ æƒ³ç”¨çš„çˆ¬è™«ä»£ç è¯­è¨€ç‰ˆæœ¬ï¼Œæˆ‘è¿™é‡Œç”¨äº† pythonï¼Œç¼–å†™å®Œæˆåçš„çˆ¬å–åˆ—è¡¨çš„ä»£ç å¦‚ä¸‹ï¼š</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> json<span class="token keyword">def</span> <span class="token function">send_req</span><span class="token punctuation">(</span>offset<span class="token punctuation">)</span><span class="token punctuation">:</span>    url <span class="token operator">=</span> <span class="token string">"https://mp.weixin.qq.com/mp/profile_ext?action=getmsg&amp;__biz=Mzg5OTE4NTczMQ==&amp;f=json&amp;offset="</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>        offset<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"&amp;count=10&amp;is_ok=1&amp;...ç•¥"</span>    payload <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>    headers <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token comment"># ç•¥</span>    <span class="token punctuation">&#125;</span>    response <span class="token operator">=</span> requests<span class="token punctuation">.</span>request<span class="token punctuation">(</span><span class="token string">"GET"</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">,</span> data<span class="token operator">=</span>payload<span class="token punctuation">)</span>    resp <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span>    <span class="token keyword">return</span> resp<span class="token punctuation">[</span><span class="token string">'general_msg_list'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> resp<span class="token punctuation">[</span><span class="token string">'next_offset'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> resp<span class="token punctuation">[</span><span class="token string">'can_msg_continue'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    has_more <span class="token operator">=</span> <span class="token boolean">True</span>    offset <span class="token operator">=</span> <span class="token number">0</span>    count <span class="token operator">=</span> <span class="token number">1</span>    all_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">while</span> has_more<span class="token punctuation">:</span>        msg_list<span class="token punctuation">,</span> offset<span class="token punctuation">,</span> has_more <span class="token operator">=</span> send_req<span class="token punctuation">(</span>offset<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'ç¬¬'</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'é¡µ:'</span> <span class="token operator">+</span> msg_list<span class="token punctuation">)</span>        post_list <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>msg_list<span class="token punctuation">)</span>        all_list<span class="token punctuation">.</span>extend<span class="token punctuation">(</span>post_list<span class="token punctuation">)</span>        count <span class="token operator">+=</span> <span class="token number">1</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>all_list<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><blockquote><p>è¿™é‡Œæœ‰ä¸€ä¸ªå°ä¼˜åŒ–ç‚¹ï¼šæ¯æ¬¡è¯·æ±‚æ‹¿åˆ°çš„ç»“æœæ˜¯{â€œlistâ€: [â€¦]}ï¼Œå¯ä»¥å…ˆå±•å¼€å† appendã€‚è¿™é‡Œæ‡’å¾—å¼„äº†å°±è¿™æ ·å§~åç»­è§£æçš„æ—¶å€™æŒ‰è¡Œè§£æå°±è¡Œäº†ã€‚</p></blockquote><h2 id="çˆ¬å–æ–‡ç« æ­£æ–‡"><a class="header-anchor" href="#çˆ¬å–æ–‡ç« æ­£æ–‡">Â¶</a>çˆ¬å–æ–‡ç« æ­£æ–‡</h2><p>è·å–åˆ°åˆ—è¡¨åè§‚å¯Ÿä¸€ä¸‹ç»“æ„ï¼š</p><p><img onerror="imgOnError(this);" data-fancybox="gallery" src="https://xiaohaoxing-1257815318.cos.ap-chengdu.myqcloud.com/image-20220705173700603.png" alt="list json æ ¼å¼" data-caption="list json æ ¼å¼" loading="lazy"></p><p>å­—æ®µå¾ˆå¤šï¼ŒæŒ‰ç…§è‡ªå·±éœ€æ±‚å†³å®šå°†å…¶ä¸­çš„ typeï¼ˆåšåˆ†ç»„æ£€ç´¢å¯èƒ½ç”¨å¾—ä¸Šï¼Œè™½ç„¶è¿˜æ²¡ææ‡‚æšä¸¾å€¼åˆ†åˆ«æ˜¯ä»€ä¹ˆå«ä¹‰ï¼‰ï¼Œdatetmeï¼ˆæ—¶é—´èŒƒå›´æ¡ä»¶ç­›é€‰ï¼‰ï¼Œtitleï¼Œcontent_urlï¼Œcoverï¼ˆå°é¢å›¾ï¼Œåç»­å±•ç¤ºæ•ˆæœä¼˜åŒ–æ—¶å¯èƒ½ç”¨å¾—ä¸Šï¼‰è¿™å‡ ä¸ªå­—æ®µæŒ‘é€‰å‡ºæ¥ä½¿ç”¨ã€‚</p><blockquote><p>è¿™é‡Œåˆæœ‰ä¸€ä¸ªä¼˜åŒ–ç‚¹ï¼Œåœ¨æœ€ç»ˆå±•ç¤ºçš„æ—¶å€™å‘ç°ï¼Œæœ‰å¾ˆå¤šè²Œä¼¼è‰ç¨¿/å·²åˆ é™¤çš„ä¹Ÿè¢«æŸ¥è¯¢å‡ºæ¥äº†ï¼Œè¿™é‡Œåº”è¯¥è¦æŒ‰ç…§ status åšä¸€æ¬¡è¿‡æ»¤ã€‚</p></blockquote><p>å°†ä¸Šè¿°å‡ ä¸ªå­—æ®µä¿å­˜åˆ°ç»“æ„ä½“ä¸­ï¼Œå¹¶ç•™ç©º content å­—æ®µï¼Œç­‰å¾…åç»­çˆ¬æ­£æ–‡å†…å®¹å†å¡«å……ã€‚</p><h3 id="è½¬æ¢è§£æç»“æ„ä½“"><a class="header-anchor" href="#è½¬æ¢è§£æç»“æ„ä½“">Â¶</a>è½¬æ¢è§£æç»“æ„ä½“</h3><pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># Python ä¸­é¢å‘å¯¹è±¡çš„ç¼–ç¨‹</span><span class="token keyword">class</span> <span class="token class-name">Record</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> obj<span class="token punctuation">)</span><span class="token punctuation">:</span>        common <span class="token operator">=</span> obj<span class="token punctuation">[</span><span class="token string">'comm_msg_info'</span><span class="token punctuation">]</span>        ext <span class="token operator">=</span> obj<span class="token punctuation">[</span><span class="token string">'app_msg_ext_info'</span><span class="token punctuation">]</span>        self<span class="token punctuation">.</span><span class="token builtin">type</span> <span class="token operator">=</span> common<span class="token punctuation">[</span><span class="token string">'type'</span><span class="token punctuation">]</span>        self<span class="token punctuation">.</span>datetime <span class="token operator">=</span> common<span class="token punctuation">[</span><span class="token string">'datetime'</span><span class="token punctuation">]</span>        self<span class="token punctuation">.</span>title <span class="token operator">=</span> ext<span class="token punctuation">[</span><span class="token string">'title'</span><span class="token punctuation">]</span>        self<span class="token punctuation">.</span>content_url <span class="token operator">=</span> ext<span class="token punctuation">[</span><span class="token string">'content_url'</span><span class="token punctuation">]</span>        self<span class="token punctuation">.</span>cover_url <span class="token operator">=</span> ext<span class="token punctuation">[</span><span class="token string">'cover'</span><span class="token punctuation">]</span>        self<span class="token punctuation">.</span>content <span class="token operator">=</span> <span class="token string">''</span><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'wechat.json'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>  has_more <span class="token operator">=</span> <span class="token boolean">True</span>  <span class="token keyword">while</span> has_more<span class="token punctuation">:</span>    line <span class="token operator">=</span> f<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> line <span class="token operator">==</span> <span class="token string">''</span> <span class="token keyword">or</span> line <span class="token operator">==</span> <span class="token string">'\n'</span><span class="token punctuation">:</span>      has_more <span class="token operator">=</span> <span class="token boolean">False</span>      <span class="token keyword">continue</span>      objs <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>line<span class="token punctuation">)</span>      arr <span class="token operator">=</span> objs<span class="token punctuation">[</span><span class="token string">'list'</span><span class="token punctuation">]</span>      <span class="token keyword">for</span> obj <span class="token keyword">in</span> arr<span class="token punctuation">:</span>        results<span class="token punctuation">.</span>append<span class="token punctuation">(</span>Record<span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><h3 id="è¯·æ±‚æ–‡ç« æ­£æ–‡"><a class="header-anchor" href="#è¯·æ±‚æ–‡ç« æ­£æ–‡">Â¶</a>è¯·æ±‚æ–‡ç« æ­£æ–‡</h3><p>è¯»å–äº†æ–‡ç« åˆ—è¡¨åå°±å¯ä»¥å¼€å§‹çˆ¬å–æ–‡ç« æ•°æ®äº†ã€‚è¿™é‡Œç”¨ requests æ¨¡å—å‘é€ http è¯·æ±‚è·å–æ­£æ–‡ï¼ŒBeautifulSoup æ¨¡å—è§£æå“åº”çš„ html æ–‡æ¡£ã€‚åœ¨ F12 æ§åˆ¶å°ä¸­å¯ä»¥æ£€ç´¢åˆ°æ­£æ–‡å¯¹åº”çš„æ–‡æ¡£æ ‘èŠ‚ç‚¹ id ä¸º&quot;js_content&quot;ï¼Œç”¨è¿™ä¸ª selector å»è·å–å…ƒç´ åŠå…¶æ–‡æœ¬å³å¯ã€‚</p><pre class="language-python" data-language="python"><code class="language-python">counter <span class="token operator">=</span> <span class="token number">0</span>fails <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">for</span> record <span class="token keyword">in</span> results<span class="token punctuation">:</span>  url <span class="token operator">=</span> record<span class="token punctuation">.</span>content_url  <span class="token keyword">try</span><span class="token punctuation">:</span>    resp <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'get success #'</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>counter<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token keyword">except</span> Exception<span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'get failed #'</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>counter<span class="token punctuation">)</span><span class="token punctuation">)</span>    fails<span class="token punctuation">.</span>append<span class="token punctuation">(</span>record<span class="token punctuation">)</span>    counter <span class="token operator">+=</span> <span class="token number">1</span>    content <span class="token operator">=</span> resp<span class="token punctuation">.</span>content    soup <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>content<span class="token punctuation">,</span> <span class="token string">'lxml'</span><span class="token punctuation">)</span>    text <span class="token operator">=</span> soup<span class="token punctuation">.</span>select<span class="token punctuation">(</span><span class="token string">'#js_content'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>getText<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment"># é¿å… csv å‡ºé”™ï¼Œç»Ÿä¸€æ”¹ä¸ºä¸­æ–‡é€—å·</span>    text <span class="token operator">=</span> text<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">,</span> <span class="token string">'ï¼Œ'</span><span class="token punctuation">)</span>    record<span class="token punctuation">.</span>content <span class="token operator">=</span> text    <span class="token comment"># TODO æ ‡é¢˜ä¹Ÿä¿®æ”¹ä¸ºä¸­æ–‡é€—å·</span>    record<span class="token punctuation">.</span>title <span class="token operator">=</span> record<span class="token punctuation">.</span>title<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">,</span> <span class="token string">'ï¼Œ'</span><span class="token punctuation">)</span></code></pre><h3 id="å†™å…¥-csv-æ–‡ä»¶"><a class="header-anchor" href="#å†™å…¥-csv-æ–‡ä»¶">Â¶</a>å†™å…¥ csv æ–‡ä»¶</h3><p>å¾—åˆ°æ­£æ–‡åéœ€è¦ä¿å­˜è½åº“ã€‚åŸæœ¬è®¡åˆ’æ˜¯å†™å…¥æ•°æ®åº“ï¼Œä½†æ˜¯çœ‹åˆ° <a href="https://github.com/YunYouJun">yunyoujun</a> çš„<a href="https://github.com/YunYouJun/cook">åšèœé¡¹ç›®</a>ä½¿ç”¨äº† csv ä½œä¸ºæ•°æ®æºï¼Œç›´æ¥ç”¨ ts ä»£ç è¯»å–æ•°æ®è€Œä¸ç”¨è¿æ¥ä¼ ç»Ÿ sql æ•°æ®åº“ï¼Œè€ƒè™‘åˆ°æœ€è¿‘ä¹Ÿæ­£åœ¨çœ‹ react çš„æ•™ç¨‹ï¼Œäºæ˜¯å†³å®šä¹Ÿè¿™ä¹ˆåšï¼</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># for export to csv</span>titles <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'title'</span><span class="token punctuation">,</span> <span class="token string">'datetime'</span><span class="token punctuation">,</span> <span class="token string">'content_url'</span><span class="token punctuation">,</span> <span class="token string">'content'</span><span class="token punctuation">,</span> <span class="token string">'type'</span><span class="token punctuation">,</span> <span class="token string">'cover_url'</span><span class="token punctuation">]</span>f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'database.csv'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span><span class="token keyword">with</span> f<span class="token punctuation">:</span>  writer <span class="token operator">=</span> csv<span class="token punctuation">.</span>DictWriter<span class="token punctuation">(</span>f<span class="token punctuation">,</span> fieldnames<span class="token operator">=</span>titles<span class="token punctuation">)</span>  writer<span class="token punctuation">.</span>writeheader<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token keyword">for</span> row <span class="token keyword">in</span> results<span class="token punctuation">:</span>    writer<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span>row<span class="token punctuation">.</span>__dict__<span class="token punctuation">)</span></code></pre><h3 id="è®°å½•è¯·æ±‚å¤±è´¥çš„case"><a class="header-anchor" href="#è®°å½•è¯·æ±‚å¤±è´¥çš„case">Â¶</a>è®°å½•è¯·æ±‚å¤±è´¥çš„case</h3><p>ç”±äºç½‘ç»œç­‰åŸå› ï¼Œæ­£æ–‡è·å–æ€»ä¼šæœ‰å¤±è´¥çš„å¯èƒ½æ€§ï¼Œè¿™é‡Œåœ¨ request.get() çš„æ—¶å€™è®°å½•ä¸‹äº†å¯¹åº”çš„ urlï¼ˆä¸Šæ–‡çš„è¯·æ±‚æ–‡ç« æ­£æ–‡éƒ¨åˆ†çš„<code>fails.append(record)</code>ï¼‰ï¼Œæœ€ç»ˆä¼šæ±‡æ€»è¾“å‡ºåˆ°æ§åˆ¶å°ï¼Œå†æ ¹æ®æƒ…å†µè€ƒè™‘å¦‚ä½•è¡¥ä¸Šè¿™éƒ¨åˆ†æ•°æ®ã€‚</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>fails<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">:</span>  <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'get '</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>fails<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'failed:'</span><span class="token punctuation">)</span>  <span class="token keyword">for</span> fail <span class="token keyword">in</span> fails<span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>fail<span class="token punctuation">.</span>__dict__<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><blockquote><p>å¯èƒ½æ˜¯å¾®ä¿¡å…¬ä¼—å·çš„æœåŠ¡æ¯”è¾ƒä¸ç¨³å®šæˆ–è€…æ˜¯æˆ‘ç½‘ç»œä¸ç¨³å®šï¼Œå³ä½¿åœ¨æµè§ˆå™¨ä¸­è®¿é—®æ–‡ç« ä¹Ÿæœ‰ä¸å°çš„æ¦‚ç‡å¤±è´¥ï¼Œå› æ­¤å°†è¯·æ±‚åŠ äº†é‡è¯•ï¼Œå…·ä½“è§ä¸‹é¢çš„å®Œæ•´ä»£ç ã€‚</p></blockquote><h3 id="å®Œæ•´ä»£ç "><a class="header-anchor" href="#å®Œæ•´ä»£ç ">Â¶</a>å®Œæ•´ä»£ç </h3><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> json<span class="token keyword">import</span> requests<span class="token keyword">from</span> bs4 <span class="token keyword">import</span> BeautifulSoup<span class="token keyword">import</span> csv<span class="token keyword">class</span> <span class="token class-name">Record</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> obj<span class="token punctuation">)</span><span class="token punctuation">:</span>        common <span class="token operator">=</span> obj<span class="token punctuation">[</span><span class="token string">'comm_msg_info'</span><span class="token punctuation">]</span>        ext <span class="token operator">=</span> obj<span class="token punctuation">[</span><span class="token string">'app_msg_ext_info'</span><span class="token punctuation">]</span>        self<span class="token punctuation">.</span><span class="token builtin">type</span> <span class="token operator">=</span> common<span class="token punctuation">[</span><span class="token string">'type'</span><span class="token punctuation">]</span>        self<span class="token punctuation">.</span>datetime <span class="token operator">=</span> common<span class="token punctuation">[</span><span class="token string">'datetime'</span><span class="token punctuation">]</span>        self<span class="token punctuation">.</span>title <span class="token operator">=</span> ext<span class="token punctuation">[</span><span class="token string">'title'</span><span class="token punctuation">]</span>        self<span class="token punctuation">.</span>content_url <span class="token operator">=</span> ext<span class="token punctuation">[</span><span class="token string">'content_url'</span><span class="token punctuation">]</span>        self<span class="token punctuation">.</span>cover_url <span class="token operator">=</span> ext<span class="token punctuation">[</span><span class="token string">'cover'</span><span class="token punctuation">]</span>        self<span class="token punctuation">.</span>content <span class="token operator">=</span> <span class="token string">''</span><span class="token comment"># åŠ ä¸Šé‡è¯•</span><span class="token keyword">def</span> <span class="token function">try_get</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> times<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> time <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>times<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            resp <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>            <span class="token keyword">if</span> resp<span class="token punctuation">.</span>status_code <span class="token operator">!=</span> <span class="token number">200</span><span class="token punctuation">:</span>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'request failed for #'</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>time<span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token keyword">continue</span>            <span class="token keyword">return</span> resp        <span class="token keyword">except</span> Exception<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'request failed for #'</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>time<span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token keyword">continue</span>    <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">'failed for '</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>times<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">' times'</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    results <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'wechat.json'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>        has_more <span class="token operator">=</span> <span class="token boolean">True</span>        <span class="token keyword">while</span> has_more<span class="token punctuation">:</span>            line <span class="token operator">=</span> f<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">if</span> line <span class="token operator">==</span> <span class="token string">''</span> <span class="token keyword">or</span> line <span class="token operator">==</span> <span class="token string">'\n'</span><span class="token punctuation">:</span>                has_more <span class="token operator">=</span> <span class="token boolean">False</span>                <span class="token keyword">continue</span>            objs <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>line<span class="token punctuation">)</span>            arr <span class="token operator">=</span> objs<span class="token punctuation">[</span><span class="token string">'list'</span><span class="token punctuation">]</span>            <span class="token keyword">for</span> obj <span class="token keyword">in</span> arr<span class="token punctuation">:</span>                results<span class="token punctuation">.</span>append<span class="token punctuation">(</span>Record<span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment"># for fetch content</span>    counter <span class="token operator">=</span> <span class="token number">0</span>    fails <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">for</span> record <span class="token keyword">in</span> results<span class="token punctuation">:</span>        url <span class="token operator">=</span> record<span class="token punctuation">.</span>content_url        <span class="token keyword">print</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            resp <span class="token operator">=</span> try_get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'get success #'</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>counter<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">except</span> Exception<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'get failed #'</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>counter<span class="token punctuation">)</span><span class="token punctuation">)</span>            fails<span class="token punctuation">.</span>append<span class="token punctuation">(</span>record<span class="token punctuation">)</span>        counter <span class="token operator">+=</span> <span class="token number">1</span>        content <span class="token operator">=</span> resp<span class="token punctuation">.</span>content        soup <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>content<span class="token punctuation">,</span> <span class="token string">'lxml'</span><span class="token punctuation">)</span>        text <span class="token operator">=</span> soup<span class="token punctuation">.</span>select<span class="token punctuation">(</span><span class="token string">'#js_content'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>getText<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment"># é¿å… csv å‡ºé”™ï¼Œç»Ÿä¸€æ”¹ä¸ºä¸­æ–‡é€—å·</span>        text <span class="token operator">=</span> text<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">,</span> <span class="token string">'ï¼Œ'</span><span class="token punctuation">)</span>        record<span class="token punctuation">.</span>content <span class="token operator">=</span> text        <span class="token comment"># TODO æ ‡é¢˜ä¹Ÿä¿®æ”¹ä¸ºä¸­æ–‡é€—å·</span>        record<span class="token punctuation">.</span>title <span class="token operator">=</span> record<span class="token punctuation">.</span>title<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">,</span> <span class="token string">'ï¼Œ'</span><span class="token punctuation">)</span>    <span class="token comment"># for export to csv</span>    titles <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'title'</span><span class="token punctuation">,</span> <span class="token string">'datetime'</span><span class="token punctuation">,</span> <span class="token string">'content_url'</span><span class="token punctuation">,</span> <span class="token string">'content'</span><span class="token punctuation">,</span> <span class="token string">'type'</span><span class="token punctuation">,</span> <span class="token string">'cover_url'</span><span class="token punctuation">]</span>    f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'database.csv'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span>    <span class="token keyword">with</span> f<span class="token punctuation">:</span>        writer <span class="token operator">=</span> csv<span class="token punctuation">.</span>DictWriter<span class="token punctuation">(</span>f<span class="token punctuation">,</span> fieldnames<span class="token operator">=</span>titles<span class="token punctuation">)</span>        writer<span class="token punctuation">.</span>writeheader<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">for</span> row <span class="token keyword">in</span> results<span class="token punctuation">:</span>            writer<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span>row<span class="token punctuation">.</span>__dict__<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>fails<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'get '</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>fails<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'failed:'</span><span class="token punctuation">)</span>        <span class="token keyword">for</span> fail <span class="token keyword">in</span> fails<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>fail<span class="token punctuation">.</span>__dict__<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>è‡³æ­¤ï¼Œçˆ¬è™«éƒ¨åˆ†çš„ä»£ç å°±å®Œæˆå•¦ã€‚æ‰€æœ‰çš„å…¬ä¼—å·æ–‡ç« çš„å†…å®¹éƒ½å·²ç»å­˜å…¥äº† <code>database.csv</code>æ–‡ä»¶é‡Œäº†ã€‚åç»­å°±å¯ä»¥ä½¿ç”¨ react é¡¹ç›®å»è¯»å–å¹¶å±•ç¤ºäº†ã€‚</p><h2 id="æ¢³ç†æ–‡ç« æ•°æ®"><a class="header-anchor" href="#æ¢³ç†æ–‡ç« æ•°æ®">Â¶</a>æ¢³ç†æ–‡ç« æ•°æ®</h2><p>æ‰€æœ‰æ–‡ç« ä¿¡æ¯éƒ½å¯¼å…¥åˆ°äº† CSV é‡Œäº†ï¼š</p><p><img onerror="imgOnError(this);" data-fancybox="gallery" src="https://xiaohaoxing-1257815318.cos.ap-chengdu.myqcloud.com/image-20220705211106545.png" alt="csvç¤ºä¾‹" data-caption="csvç¤ºä¾‹" loading="lazy"></p><p>åˆ›å»ºä¸€ä¸ªå‰ç«¯ React é¡¹ç›®ï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash">npx create-react-app wechat-app</code></pre><p>ç„¶åè¿›å…¥é¡¹ç›® <code>src</code> ç›®å½•ï¼Œå‚è€ƒ yunyoujun çš„<a href="https://github.com/YunYouJun/cook/blob/dev/scripts/convert.ts">è½¬æ¢ä»£ç </a>ï¼Œå°† csv è½¬æ¢ä¸º json æ•°æ®æä¾›ç»™ js ä»£ç å¼•ç”¨ã€‚</p><blockquote><p>ä¹‹æ‰€ä»¥è½¬æ¢çš„åŸå› æ˜¯å‰ç«¯ä»£ç åªèƒ½ import ä¸€ä¸ª json æ–‡ä»¶è€Œä¸èƒ½ import ä¸€ä¸ª csv æ–‡ä»¶ã€‚</p></blockquote><p>è½¬æ¢ä»£ç ï¼š</p><pre class="language-js" data-language="js"><code class="language-js"># csvConverter<span class="token punctuation">.</span>ts<span class="token keyword">import</span> fs <span class="token keyword">from</span> <span class="token string">'fs'</span><span class="token keyword">import</span> path <span class="token keyword">from</span> <span class="token string">'path'</span><span class="token keyword">import</span> consola <span class="token keyword">from</span> <span class="token string">'consola'</span><span class="token keyword">const</span> csvFile <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../src/asset/database.csv'</span><span class="token punctuation">)</span><span class="token keyword">const</span> jsonFile <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../src/asset/database.json'</span><span class="token punctuation">)</span><span class="token keyword">function</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> csvData <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>csvFile<span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span>    <span class="token keyword">let</span> jsonData<span class="token operator">:</span> Database <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">const</span> lines <span class="token operator">=</span> csvData<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\r?\n</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span>    lines<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">line</span><span class="token punctuation">)</span><span class="token operator">=></span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">const</span> attrs <span class="token operator">=</span> line<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span>            jsonData<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>                title<span class="token operator">:</span> attrs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                datetime<span class="token operator">:</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>attrs<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                content_url<span class="token operator">:</span>attrs<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                content<span class="token operator">:</span>attrs<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                type<span class="token operator">:</span><span class="token function">parseInt</span><span class="token punctuation">(</span>attrs<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                cover_url<span class="token operator">:</span>attrs<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>jsonFile<span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>jsonData<span class="token punctuation">)</span><span class="token punctuation">)</span>    consola<span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Generate file success: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>jsonFile<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">Item</span> <span class="token punctuation">&#123;</span>    title<span class="token operator">:</span> string    datetime<span class="token operator">:</span> number    content_url<span class="token operator">:</span> string    content<span class="token operator">:</span> string    type<span class="token operator">:</span> number    cover_url<span class="token operator">:</span> string<span class="token punctuation">&#125;</span><span class="token keyword">export</span> type Database <span class="token operator">=</span> Item<span class="token punctuation">[</span><span class="token punctuation">]</span></code></pre><p>åœ¨ package.json æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹ï¼š</p><pre class="language-diff" data-language="diff"><code class="language-diff">&#123;<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> ...</span><span class="token prefix unchanged"> </span><span class="token line"> "scripts": &#123;</span><span class="token prefix unchanged"> </span><span class="token line">   ...</span></span><span class="token coord">+++    "convert": "tsx src/csvConverter.ts"</span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> &#125;</span></span>&#125;</code></pre><p>åœ¨å‘½ä»¤è¡Œä¸­æ‰§è¡Œè½¬æ¢ä»£ç ï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> run convert</code></pre><p>æ‰§è¡Œå®Œæˆåå°±å¯ä»¥çœ‹åˆ°å‡ºç°äº†ä¸€ä¸ªæ–°æ–‡ä»¶ï¼š<code>database.json</code>ã€‚æ­¤æ—¶å°±å¯ä»¥åœ¨é¡¹ç›®ä¸­ç›´æ¥å¼•ç”¨è¯¥æ–‡ä»¶ä½œä¸ºæ•°æ®æºå•¦ã€‚</p><h2 id="è¾“å‡ºå±•ç¤º"><a class="header-anchor" href="#è¾“å‡ºå±•ç¤º">Â¶</a>è¾“å‡ºå±•ç¤º</h2><p>å‰ç«¯ä½¿ç”¨ import å¼•å…¥æ•°æ®æ–‡ä»¶ï¼š</p><pre class="language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">import</span> data <span class="token keyword">from</span> <span class="token string">'./asset/database.json'</span></code></pre><p>éšåå°±å¯ä»¥æŒ‰ç…§ React çš„æ­£å¸¸å¼€å‘æ–¹å¼è¯»å–æ•°æ®å†™ä¸šåŠ¡ä»£ç äº†~~ï¼ˆç¨‹åºå‘˜æœ€æ“…é•¿å†™çš„è¡¨æ ¼è§†å›¾ï¼‰</p><p>å®Œæ•´ä»£ç ï¼š</p><pre class="language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">'react-dom/client'</span><span class="token keyword">import</span> <span class="token string">'./index.css'</span><span class="token keyword">import</span> data <span class="token keyword">from</span> <span class="token string">'./asset/database.json'</span><span class="token comment">// å‡½æ•°å¼ç»„ä»¶</span><span class="token keyword">function</span> <span class="token function">Record</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> record <span class="token operator">=</span> props<span class="token punctuation">.</span>record    <span class="token keyword">let</span> time <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>record<span class="token punctuation">.</span>datetime<span class="token punctuation">)</span>    <span class="token comment">//æ—¥æœŸ</span>    <span class="token keyword">var</span> <span class="token constant">DD</span> <span class="token operator">=</span> <span class="token function">String</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">padStart</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è·å–æ—¥</span>    <span class="token keyword">var</span> <span class="token constant">MM</span> <span class="token operator">=</span> <span class="token function">String</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">getMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">padStart</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//è·å–æœˆä»½ï¼Œ1 æœˆä¸º 0</span>    <span class="token keyword">var</span> yyyy <span class="token operator">=</span> time<span class="token punctuation">.</span><span class="token function">getFullYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è·å–å¹´</span>    <span class="token comment">// æ—¶é—´</span>    <span class="token keyword">let</span> hh <span class="token operator">=</span>  <span class="token function">String</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">getHours</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">padStart</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">//è·å–å½“å‰å°æ—¶æ•°(0-23)</span>    <span class="token keyword">let</span> mm <span class="token operator">=</span> <span class="token function">String</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">getMinutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">padStart</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">//è·å–å½“å‰åˆ†é’Ÿæ•°(0-59)</span>    <span class="token keyword">let</span> ss <span class="token operator">=</span> <span class="token function">String</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">getSeconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">padStart</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">//è·å–å½“å‰ç§’æ•°(0-59)</span>    <span class="token keyword">let</span> timeformat <span class="token operator">=</span> yyyy <span class="token operator">+</span> <span class="token string">'-'</span> <span class="token operator">+</span> <span class="token constant">MM</span> <span class="token operator">+</span> <span class="token string">'-'</span> <span class="token operator">+</span> <span class="token constant">DD</span> <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span> hh <span class="token operator">+</span> <span class="token string">':'</span> <span class="token operator">+</span> mm <span class="token operator">+</span> <span class="token string">':'</span> <span class="token operator">+</span> ss<span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">></span></span><span class="token plain-text">            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span><span class="token punctuation">&#123;</span>timeformat<span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span><span class="token plain-text">            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>record<span class="token punctuation">.</span>content_url<span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token punctuation">&#123;</span>record<span class="token punctuation">.</span>title<span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span><span class="token plain-text">            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span><span class="token punctuation">&#123;</span>record<span class="token punctuation">.</span>content<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">50</span><span class="token operator">?</span>record<span class="token punctuation">.</span>content<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token operator">:</span>record<span class="token punctuation">.</span>content <span class="token operator">+</span> <span class="token string">'...'</span><span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span><span class="token plain-text">        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span>    <span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token comment">// ä¼ ç»Ÿç»„ä»¶</span><span class="token keyword">class</span> <span class="token class-name">DataBase</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">&#123;</span>    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">&#123;</span>            data<span class="token operator">:</span> data        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>        <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">let</span> recordList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>        <span class="token comment">// åªå±•ç¤º top 10 é¢„è§ˆ</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span><span class="token number">10</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            recordList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Record</span></span> <span class="token attr-name">record</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token punctuation">/></span></span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span>  <span class="token punctuation">(</span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">loaded </span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>data<span class="token punctuation">.</span>length<span class="token punctuation">&#125;</span><span class="token plain-text"> records</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token punctuation">></span></span><span class="token plain-text">            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span><span class="token plain-text">                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">></span></span><span class="token plain-text">æ—¶é—´</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">></span></span><span class="token plain-text">                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">></span></span><span class="token plain-text">æ ‡é¢˜</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">></span></span><span class="token plain-text">                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">></span></span><span class="token plain-text">æ­£æ–‡</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">></span></span><span class="token plain-text">            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span><span class="token plain-text">            </span><span class="token punctuation">&#123;</span>recordList<span class="token punctuation">&#125;</span><span class="token plain-text">            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">></span></span><span class="token plain-text">        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> root <span class="token operator">=</span> ReactDOM<span class="token punctuation">.</span><span class="token function">createRoot</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"root"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>root<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">DataBase</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2 id="æ€»ç»“"><a class="header-anchor" href="#æ€»ç»“">Â¶</a>æ€»ç»“</h2><p>å¾ˆä¹…ä¸å†™åšå®¢äº†ï¼Œè¿™æ¬¡ä½¿ç”¨æŠ€æœ¯è§£å†³äº†ä¸€ä¸ªå®é™…é—®é¢˜ï¼Œæ­£å¥½å°†åšå®¢é‡æ–°è¥ä¸šèµ·æ¥~</p><p>ç”±äºè¦å»æ”»è¯»åšå£«å­¦ä½ï¼Œåé¢å†…å®¹å¯èƒ½ä¼šæ›´åå‘äºä¸€äº›ç§‘ç ”ã€‚ä¸è¿‡ä¹Ÿè¯´ä¸å‡†â”“(Â Â´âˆ€`Â )â”ã€‚</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>web åº”ç”¨å®‰å…¨è®¤è¯</title>
      <link href="/2020/11/17/web-%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8%E8%AE%A4%E8%AF%81/"/>
      <url>/2020/11/17/web-%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8%E8%AE%A4%E8%AF%81/</url>
      
        <content type="html"><![CDATA[<p>è¿™ç¯‡æŒ‡å—å¸¦ä½ åˆ›å»ºä¸€ä¸ªSpring Security ç®¡ç†èµ„æºå®‰å…¨çš„ç®€å•çš„ web åº”ç”¨ã€‚</p><span id="more"></span><h2 id="ä½ å°†ä¼šæ­å»ºâ€¦"><a class="header-anchor" href="#ä½ å°†ä¼šæ­å»ºâ€¦">Â¶</a>ä½ å°†ä¼šæ­å»ºâ€¦</h2><p>ä¸€ä¸ª Spring MVC çš„åº”ç”¨ï¼Œé¡µé¢è¢«ä¸€ä¸ªç™»é™†è¡¨å•ä¿æŠ¤ï¼Œåªæœ‰ç‰¹å®šçš„ç”¨æˆ·å¯ä»¥è®¿é—®ã€‚</p><h2 id="ä½ éœ€è¦â€¦"><a class="header-anchor" href="#ä½ éœ€è¦â€¦">Â¶</a>ä½ éœ€è¦â€¦</h2><ul><li>15åˆ†é’Ÿæ—¶é—´</li><li>ä½ å–œæ¬¢çš„ç¼–è¾‘å™¨æˆ– IDE</li><li>JDK1.8+</li><li>Gradle 4+ æˆ– Maven3.2+</li><li>å¯ä»¥ç›´æ¥ç›´æ¥åœ¨ä»¥ä¸‹ IDE ä¸­å¯¼å…¥ä»£ç ï¼š<ul><li><a href="https://spring.io/guides/gs/sts">Spring Tool Suite(STS)</a></li><li><a href="https://spring.io/guides/gs/intellij-idea/">IntelliJ IDEA</a></li></ul></li></ul><h2 id="å¦‚ä½•å®ŒæˆæŒ‡å—"><a class="header-anchor" href="#å¦‚ä½•å®ŒæˆæŒ‡å—">Â¶</a>å¦‚ä½•å®ŒæˆæŒ‡å—</h2><p>è·Ÿå¤§å¤šæ•° Spring çš„æŒ‡å—ä¸€æ ·ï¼Œä½ éœ€è¦ä»ä¸€ä¸ªéª¨æ¶é¡¹ç›®å¯åŠ¨ï¼Œä¸€æ­¥ä¸€æ­¥å®Œæˆï¼›æˆ–è€…ç›´æ¥è·³è¿‡ä½ å·²ç»å¾ˆç†Ÿæ‚‰çš„é…ç½®æ­¥éª¤ã€‚ä¸¤ç§æ–¹å¼å¾—åˆ°çš„ä»£ç éƒ½èƒ½æ­£ç¡®è¿è¡Œã€‚</p><p>ä»éª¨æ¶é¡¹ç›®å¼€å§‹ï¼Œç§»æ­¥<a href="https://spring.io/guides/gs/securing-web/#scratch">ä» Spring å¯åŠ¨å™¨å¼€å§‹</a>ã€‚</p><p>è·³è¿‡åŸºæœ¬æ­¥éª¤ï¼Œåšå¦‚ä¸‹å‡ æ­¥ï¼š</p><ul><li><a href="https://github.com/spring-guides/gs-securing-web/archive/master.zip">ä¸‹è½½</a>å¹¶è§£å‹æºç é¡¹ç›®æˆ–ç”¨ <a href="https://spring.io/understanding/Git">Git</a> å‘½ä»¤ï¼š</li></ul><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> clone https://github.com/spring-guides/gs-securing-web.git</code></pre><ul><li>æ‰“å¼€åˆ°ç›®å½•  <code>gs-securing-web/initial</code></li><li>è·³åˆ°<a href="">åˆ›å»ºä¸å®‰å…¨çš„åº”ç”¨</a></li></ul><p>å½“ä½ å®Œæˆåï¼Œå¯ä»¥å¯¹æ¯” <code>gs-securing-web/complete</code> æ£€æŸ¥è‡ªå·±çš„ä»£ç ã€‚</p><h2 id="ä»-Spring-å¯åŠ¨å™¨å¼€å§‹"><a class="header-anchor" href="#ä»-Spring-å¯åŠ¨å™¨å¼€å§‹">Â¶</a>ä» Spring å¯åŠ¨å™¨å¼€å§‹</h2><p>æ‰€æœ‰ Spring åº”ç”¨éƒ½éœ€è¦ä» Spring å¯åŠ¨å™¨å¼€å§‹ã€‚å¯åŠ¨å™¨æä¾›å¿«é€Ÿçš„æ–¹å¼å¯¼å…¥æ‰€æœ‰éœ€è¦çš„ä¾èµ–å¹¶è‡ªåŠ¨æ‰§è¡Œå¾ˆå¤šå¯åŠ¨é¡¹ã€‚æœ¬ä¾‹éœ€è¦ Spring Web å’Œ Thymeleaf ä¾èµ–ã€‚</p><p>ä¸‹é¢æ˜¯é€‰æ‹© Maven æ—¶éœ€è¦åˆ›å»ºçš„ <code>pom/xml</code> æ–‡ä»¶ã€‚</p><pre class="language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span><span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">></span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.3.2.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>relativePath</span><span class="token punctuation">/></span></span> <span class="token comment">&lt;!-- lookup parent from repository --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.example<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>securing-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>0.0.1-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>securing-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">></span></span>Demo project for Spring Boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>java.version</span><span class="token punctuation">></span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>java.version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-thymeleaf<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">></span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusions</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.junit.vintage<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>junit-vintage-engine<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusions</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">></span></span></code></pre><p>ä¸‹é¢æ˜¯é€‰æ‹© Gradle æ—¶éœ€è¦åˆ›å»ºçš„ <code>build.gradle</code> æ–‡ä»¶ã€‚</p><pre class="language-gradle" data-language="gradle"><code class="language-gradle">plugins &#123;id &#39;org.springframework.boot&#39; version &#39;2.3.2.RELEASE&#39;id &#39;io.spring.dependency-management&#39; version &#39;1.0.8.RELEASE&#39;id &#39;java&#39;&#125;group &#x3D; &#39;com.example&#39;version &#x3D; &#39;0.0.1-SNAPSHOT&#39;sourceCompatibility &#x3D; &#39;1.8&#39;repositories &#123;mavenCentral()&#125;dependencies &#123;implementation &#39;org.springframework.boot:spring-boot-starter-thymeleaf&#39;implementation &#39;org.springframework.boot:spring-boot-starter-web&#39;testImplementation(&#39;org.springframework.boot:spring-boot-starter-test&#39;) &#123;exclude group: &#39;org.junit.vintage&#39;, module: &#39;junit-vintage-engine&#39;&#125;&#125;test &#123;useJUnitPlatform()&#125;</code></pre><h2 id="åˆ›å»ºä¸å®‰å…¨çš„-web-åº”ç”¨"><a class="header-anchor" href="#åˆ›å»ºä¸å®‰å…¨çš„-web-åº”ç”¨">Â¶</a>åˆ›å»ºä¸å®‰å…¨çš„ web åº”ç”¨</h2><p>åœ¨åº”ç”¨å®‰å…¨ç»„ä»¶åˆ° web åº”ç”¨ä¸­å‰ï¼Œéœ€è¦å…ˆæœ‰ä¸€ä¸ª web åº”ç”¨ã€‚æœ¬èŠ‚å¸¦ä½ åˆ›å»ºä¸€ä¸ªç®€å•çš„ web åº”ç”¨ç¨‹åºï¼Œå¹¶åœ¨ä¸‹ä¸€èŠ‚ä¸­ä½¿ç”¨ Spring Security æ¥å…¥å®‰å…¨ã€‚</p><p>åº”ç”¨åŒ…å« 2 ä¸ªç®€å•é¡µé¢ï¼šé¦–é¡µå’Œâ€œHello Worldâ€é¡µé¢ã€‚é¦–é¡µç”¨å¦‚ä¸‹ Thymeleaf æ¨¡æ¿å®šä¹‰ï¼ˆä½äºï¼‰<code>src/main/resources/templates/home.html</code>ï¼š</p><pre class="language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/1999/xhtml<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>th</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://www.thymeleaf.org<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>sec</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://www.thymeleaf.org/thymeleaf-extras-springsecurity3<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Spring Security Example<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Welcome!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Click <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name"><span class="token namespace">th:</span>href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@&#123;/hello&#125;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>here<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span> to see a greeting.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>è§†å›¾åªæ˜¯ç®€å•çš„åŒ…å«ä¸€ä¸ªæŒ‡å‘ <code>/hello</code>é¡µé¢çš„é“¾æ¥ï¼Œé¡µé¢å®šä¹‰å¦‚ä¸‹ï¼ˆä½äº<code>src/main/resources/templates/hello.html</code>ï¼‰ï¼š</p><pre class="language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/1999/xhtml<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>th</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://www.thymeleaf.org<span class="token punctuation">"</span></span>      <span class="token attr-name"><span class="token namespace">xmlns:</span>sec</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://www.thymeleaf.org/thymeleaf-extras-springsecurity3<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Hello World!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Hello world!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>è¿™ä¸ª web åº”ç”¨ç¨‹åºæ˜¯åŸºäº Spring MVC çš„ï¼Œå› æ­¤éœ€è¦é…ç½®Spring MVC è®©è§†å›¾æ§åˆ¶å™¨æš´éœ²å‡ºè¿™äº›æ¨¡æ¿ï¼Œä¸‹é¢åˆ—å‡ºï¼ˆä½äº src/main/java/com/example/securingweb/MvcConfig.javaï¼‰å±•ç¤ºäº† Spring MVC åº”ç”¨çš„é…ç½®ç±»ï¼š</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>securingweb</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>config<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ViewControllerRegistry</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>config<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">WebMvcConfigurer</span><span class="token punctuation">;</span><span class="token annotation punctuation">@Configuration</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MvcConfig</span> <span class="token keyword">implements</span> <span class="token class-name">WebMvcConfigurer</span> <span class="token punctuation">&#123;</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addViewControllers</span><span class="token punctuation">(</span><span class="token class-name">ViewControllerRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>registry<span class="token punctuation">.</span><span class="token function">addViewController</span><span class="token punctuation">(</span><span class="token string">"/home"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setViewName</span><span class="token punctuation">(</span><span class="token string">"home"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>registry<span class="token punctuation">.</span><span class="token function">addViewController</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setViewName</span><span class="token punctuation">(</span><span class="token string">"home"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>registry<span class="token punctuation">.</span><span class="token function">addViewController</span><span class="token punctuation">(</span><span class="token string">"/hello"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setViewName</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>registry<span class="token punctuation">.</span><span class="token function">addViewController</span><span class="token punctuation">(</span><span class="token string">"/login"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setViewName</span><span class="token punctuation">(</span><span class="token string">"login"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p><code>addViewControllers()</code> æ–¹æ³•ï¼ˆé‡å†™äº† <code>WebMvcConfigurer</code> ç±»çš„åŒåæ–¹æ³•ï¼‰æ·»åŠ äº† 4  ä¸ªè§†å›¾æ§åˆ¶å™¨ã€‚2 ä¸ªå…³è”äº†å®šä¹‰åœ¨ home.html æ–‡ä»¶çš„ home è§†å›¾ï¼Œå¦ 1 ä¸ªå…³è”äº†hello.html æ–‡ä»¶çš„ hello è§†å›¾ã€‚ç¬¬å››ä¸ªè§†å›¾æ§åˆ¶å™¨å…³è”äº† login è§†å›¾ï¼Œä¸‹ä¸€èŠ‚ä¸­ä¼šåˆ›å»ºã€‚</p><p>æ­¤æ—¶ï¼Œä½ å¯ä»¥è·³è½¬åˆ°â€œè¿è¡Œåº”ç”¨ç¨‹åºâ€å¹¶ä¸”è¿è¡Œä¸ç”¨ç™»å½•å°±å¯è®¿é—®ä»»æ„ä½ç½®çš„åº”ç”¨ç¨‹åºã€‚</p><p>æ—¢ç„¶æ­¤æ—¶åº”ç”¨ç¨‹åºè¿˜æ²¡æ¥å…¥å®‰å…¨ï¼Œè¿™æ—¶æ¥æ·»åŠ å®‰å…¨ç»„ä»¶ã€‚</p><h2 id="é…ç½®-Spring-Security"><a class="header-anchor" href="#é…ç½®-Spring-Security">Â¶</a>é…ç½® Spring Security</h2><p>å‡è®¾ä½ å¸Œæœ›é˜»æ­¢æœªæˆæƒç”¨æˆ·è®¿é—® <code>/hello</code> è·¯å¾„ä¸‹çš„é¡µé¢ã€‚å½“å‰ï¼Œè®¿é—®è€…ç‚¹å‡»é¦–é¡µé“¾æ¥ï¼Œå°†ä¼šä¸å—é˜»æ­¢çœ‹åˆ°é—®å€™é¡µã€‚ä½ éœ€è¦æ·»åŠ ä¸€å±‚å±éšœè¿«ä½¿è®¿é—®è€…çœ‹åˆ°é¡µé¢å‰å¿…é¡»ç™»å½•ã€‚</p><p>é€šè¿‡é›†æˆ Spring Security åˆ°é¡¹ç›®ä¸­å®ç°ã€‚å½“ Spring Security ä½äºç±»è·¯å¾„ä¸‹æ—¶ï¼ŒSpring <a href="https://docs.spring.io/spring-boot/docs/2.3.2.RELEASE/reference/htmlsingle/#boot-features-security">è‡ªåŠ¨å°†æ‰€æœ‰ HTTP æ¥å£</a>ç”¨ â€œbasicâ€  é‰´æƒã€‚ä¸è¿‡ä½ å¯ä»¥ç»§ç»­è‡ªå®šä¹‰å®‰å…¨é…ç½®ã€‚é¦–å…ˆéœ€è¦æ·»åŠ  Spring Security åˆ°ç±»è·¯å¾„ä¸‹ã€‚</p><p>ä½¿ç”¨ Gradleï¼Œæ·»åŠ ä»¥ä¸‹ 2 è¡Œåˆ° <code>build.gradle</code> æ–‡ä»¶çš„ <code>dependencies</code> ä¸€çº§ä¸‹ï¼Œï¼ˆä¸€ä¸ªç”¨åœ¨åº”ç”¨ä¸­ï¼Œä¸€ä¸ªç”¨æ¥æµ‹è¯•ï¼‰ï¼š</p><pre class="language-gradle" data-language="gradle"><code class="language-gradle">implementation &#39;org.springframework.boot:spring-boot-starter-security&#39;implementation &#39;org.springframework.security:spring-security-test&#39;</code></pre><p>ä¸‹é¢æ˜¯å®Œæ•´çš„ <code>build.gradle</code>æ–‡ä»¶ï¼š</p><pre class="language-gradle" data-language="gradle"><code class="language-gradle">plugins &#123;id &#39;org.springframework.boot&#39; version &#39;2.3.2.RELEASE&#39;id &#39;io.spring.dependency-management&#39; version &#39;1.0.8.RELEASE&#39;id &#39;java&#39;&#125;group &#x3D; &#39;com.example&#39;version &#x3D; &#39;0.0.1-SNAPSHOT&#39;sourceCompatibility &#x3D; &#39;1.8&#39;repositories &#123;mavenCentral()&#125;dependencies &#123;implementation &#39;org.springframework.boot:spring-boot-starter-thymeleaf&#39;implementation &#39;org.springframework.boot:spring-boot-starter-web&#39;implementation &#39;org.springframework.boot:spring-boot-starter-security&#39;implementation &#39;org.springframework.security:spring-security-test&#39;testImplementation(&#39;org.springframework.boot:spring-boot-starter-test&#39;) &#123;exclude group: &#39;org.junit.vintage&#39;, module: &#39;junit-vintage-engine&#39;&#125;&#125;test &#123;useJUnitPlatform()&#125;</code></pre><p>ä½¿ç”¨ Maven éœ€è¦æ·»åŠ ä¸€ä¸‹ 2 éƒ¨åˆ†ï¼ˆä¸€ä¸ªç”¨äºåº”ç”¨ï¼Œä¸€ä¸ªç”¨äºæµ‹è¯•ï¼‰åˆ°  <code>pom.xml</code> æ–‡ä»¶çš„ <code>&lt;denpendencies&gt;</code>å…ƒç´ ä¸‹ï¼š</p><pre class="language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-security<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.security<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-security-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">></span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre><p>ä¸‹é¢æ˜¯å®Œæ•´çš„ <code>pom.xml</code>æ–‡ä»¶ï¼š</p><pre class="language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span><span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">></span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.3.2.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>relativePath</span><span class="token punctuation">/></span></span> <span class="token comment">&lt;!-- lookup parent from repository --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.example<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>securing-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>0.0.1-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>securing-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">></span></span>Demo project for Spring Boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>java.version</span><span class="token punctuation">></span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>java.version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-thymeleaf<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-security<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.security<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-security-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">></span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">></span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusions</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.junit.vintage<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>junit-vintage-engine<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusions</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">></span></span></code></pre><p>ä»¥ä¸‹å®‰å…¨é…ç½®ï¼ˆä½äº <code>src/main/java/com/example/securingweb/WebSecurityConfig.java</code>ï¼‰ç¡®ä¿åªæœ‰é‰´æƒäº†çš„ç”¨æˆ·æ‰èƒ½çœ‹åˆ°æ¬¢è¿é¡µï¼š</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>securingweb</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>config<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>web<span class="token punctuation">.</span>builders<span class="token punctuation">.</span></span><span class="token class-name">HttpSecurity</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>config<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>web<span class="token punctuation">.</span>configuration<span class="token punctuation">.</span></span><span class="token class-name">EnableWebSecurity</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>config<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>web<span class="token punctuation">.</span>configuration<span class="token punctuation">.</span></span><span class="token class-name">WebSecurityConfigurerAdapter</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>core<span class="token punctuation">.</span>userdetails<span class="token punctuation">.</span></span><span class="token class-name">User</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>core<span class="token punctuation">.</span>userdetails<span class="token punctuation">.</span></span><span class="token class-name">UserDetails</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>core<span class="token punctuation">.</span>userdetails<span class="token punctuation">.</span></span><span class="token class-name">UserDetailsService</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>provisioning<span class="token punctuation">.</span></span><span class="token class-name">InMemoryUserDetailsManager</span><span class="token punctuation">;</span><span class="token annotation punctuation">@Configuration</span><span class="token annotation punctuation">@EnableWebSecurity</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebSecurityConfig</span> <span class="token keyword">extends</span> <span class="token class-name">WebSecurityConfigurerAdapter</span> <span class="token punctuation">&#123;</span><span class="token annotation punctuation">@Override</span><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>http<span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> <span class="token string">"/home"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">formLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">loginPage</span><span class="token punctuation">(</span><span class="token string">"/login"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token annotation punctuation">@Bean</span><span class="token annotation punctuation">@Override</span><span class="token keyword">public</span> <span class="token class-name">UserDetailsService</span> <span class="token function">userDetailsService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token class-name">UserDetails</span> user <span class="token operator">=</span> <span class="token class-name">User</span><span class="token punctuation">.</span><span class="token function">withDefaultPasswordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">username</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">password</span><span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">roles</span><span class="token punctuation">(</span><span class="token string">"USER"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">InMemoryUserDetailsManager</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p><code>WebSecurityConfig</code>ç±»è¢« <code>@EnableWebSecurity</code> æ³¨è§£äº†ï¼Œå¯ç”¨äº† Spring Security çš„ web å®‰å…¨æ”¯æŒå¹¶æä¾›äº† Spring MVC  çš„é›†æˆã€‚åŒæ—¶ç»§æ‰¿äº† <code>WebSecurityConfigurerAdapter</code>ç±»ï¼Œé‡å†™äº†ä¸€ç»„æ–¹æ³•ç”¨æ¥é…ç½®ä¸€äº›ç‰¹å®šçš„ web å®‰å…¨é…ç½®ã€‚</p><p><code>configure(HttpSecurity)</code> æ–¹æ³•å®šä¹‰äº†å“ªäº› URL è·¯å¾„éœ€è¦è¢«é‰´æƒã€‚è¿™é‡Œ <code>/</code> å’Œ <code>/home</code> ç‰¹åˆ«è¢«æ ‡æ³¨ä¸è¦é‰´æƒï¼Œå…¶ä»–æ‰€æœ‰è·¯å¾„éƒ½è¦è¢«é‰´æƒã€‚</p><p>å½“ç”¨æˆ·æˆåŠŸç™»å½•åï¼Œä»–ä»¬è¢«é‡å®šå‘åˆ°ä¹‹å‰è¯·æ±‚çš„éœ€è¦é‰´æƒçš„é¡µé¢ã€‚æœ‰ä¸€ä¸ªè‡ªå®šä¹‰çš„ <code>/login</code> é¡µé¢ï¼ˆä½¿ç”¨ <code>loginPage()</code> æŒ‡å®šï¼‰ï¼Œä»»ä½•äººéƒ½èƒ½è®¿é—®ã€‚</p><p><code>userDetailsService()</code>æ–¹æ³•è®¾ç½®äº†å•ä¸ªç”¨æˆ·çš„å†…å­˜å­˜å‚¨ï¼Œç»™å®šäº†ç”¨æˆ·åä¸º <code>user</code>ï¼Œå¯†ç ä¸º <code>password</code>ï¼Œè§’è‰²ä¸º <code>USER</code>ã€‚</p><p>ç°åœ¨éœ€è¦åˆ›å»ºç™»å½•é¡µã€‚å·²ç»æœ‰äº† <code>login</code> è§†å›¾çš„è§†å›¾æ§åˆ¶å™¨äº†ï¼Œåªéœ€è¦åˆ›å»ºè§†å›¾å³å¯ï¼Œå¦‚ä¸‹ï¼ˆä½äº <code>src/main/resources/templates/login.html</code>ï¼‰ï¼š</p><pre class="language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/1999/xhtml<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>th</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://www.thymeleaf.org<span class="token punctuation">"</span></span>      <span class="token attr-name"><span class="token namespace">xmlns:</span>sec</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://www.thymeleaf.org/thymeleaf-extras-springsecurity3<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Spring Security Example <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name"><span class="token namespace">th:</span>if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;param.error&#125;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            Invalid username and password.        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name"><span class="token namespace">th:</span>if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;param.logout&#125;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            You have been logged out.        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name"><span class="token namespace">th:</span>action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@&#123;/login&#125;<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span><span class="token punctuation">></span></span> User Name : <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span><span class="token punctuation">></span></span> Password: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Sign In<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>Themeleaf æ¨¡æ¿å±•ç¤ºäº†ä¸€ä¸ªè®°å½•ç”¨æˆ·åå’Œå¯†ç çš„è¡¨å•ï¼Œå¹¶ post æ–¹æ³•ä¼ åˆ° <code>/login</code>ã€‚Spring Security é…ç½®åï¼Œæä¾›ä¸€ä¸ªæ‹¦æˆªè¯·æ±‚çš„è¿‡æ»¤å™¨å¹¶å¯¹ç”¨æˆ·é‰´æƒã€‚å¦‚æœç”¨æˆ·é‰´æƒå¤±è´¥åˆ™ä¼šé‡å®šå‘åˆ° <code>/login?error</code>ï¼Œå¹¶ä¸”å±•ç¤ºç›¸å…³çš„é”™è¯¯ä¿¡æ¯ã€‚ä¸€æ—¦æˆåŠŸç™»å‡ºï¼Œåº”ç”¨ä¼šé‡å®šå‘åˆ° <code>/login?logout</code>ï¼Œå¹¶ä¸”é¡µé¢ä¼šå±•ç¤ºæˆåŠŸä¿¡æ¯ã€‚</p><p>æœ€åï¼Œä½ éœ€è¦æä¾›è®¿é—®è€…ä¸€ç§å±•ç¤ºå½“å‰ç”¨æˆ·å’Œç™»å‡ºçš„æ–¹å¼ã€‚å› æ­¤ï¼Œæ›´æ–° <code>hello.html</code> å‘å½“å‰ç”¨æˆ·æ‰“æ‹›å‘¼å¹¶å¢åŠ ä¸€ä¸ª <code>Sign Out</code> è¡¨å•ï¼Œå¦‚ä¸‹ï¼ˆä½äº <code>src/main/resources/templates/hello.html</code>ï¼‰ï¼š</p><pre class="language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/1999/xhtml<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>th</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://www.thymeleaf.org<span class="token punctuation">"</span></span>      <span class="token attr-name"><span class="token namespace">xmlns:</span>sec</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://www.thymeleaf.org/thymeleaf-extras-springsecurity3<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Hello World!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span> <span class="token attr-name"><span class="token namespace">th:</span>inline</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Hello [[$&#123;#httpServletRequest.remoteUser&#125;]]!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name"><span class="token namespace">th:</span>action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@&#123;/logout&#125;<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Sign Out<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>ä½¿ç”¨ Spring Security é›†æˆçš„ <code>HttpServletRequest#getRemoteUser()</code>æ¥å±•ç¤ºç”¨æˆ·åã€‚ç™»å‡ºè¡¨å•æäº¤ä¸€ä¸ª POST è¯·æ±‚åˆ° <code>/logout</code>ã€‚å½“æˆåŠŸç™»å‡ºåï¼Œç”¨æˆ·ä¼šé‡å®šå‘åˆ° <code>/login?logout</code>ã€‚</p><h2 id="è¿è¡Œåº”ç”¨"><a class="header-anchor" href="#è¿è¡Œåº”ç”¨">Â¶</a>è¿è¡Œåº”ç”¨</h2><p>Spring åˆ›å»ºå™¨å·²ç»ä¸ºä½ åˆ›å»ºäº†ä¸€ä¸ªåº”ç”¨ç±»ã€‚æ­¤æ—¶ä½ ä¸éœ€è¦ä¿®æ”¹è¿™ä¸ªç±»ã€‚ä¸‹é¢å±•ç¤ºäº†è¿™ä¸ªåº”ç”¨å¯åŠ¨ç±»ï¼ˆä½äº <code>src/main/java/com/example/securingweb/SecuringWebApplication.java</code>ï¼‰ï¼š</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>securingweb</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span></span><span class="token class-name">SpringApplication</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span></span><span class="token class-name">SpringBootApplication</span><span class="token punctuation">;</span><span class="token annotation punctuation">@SpringBootApplication</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SecuringWebApplication</span> <span class="token punctuation">&#123;</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">&#123;</span><span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">SecuringWebApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><h3 id="æ„å»ºå¯æ‰§è¡Œ-JAR-æ–‡ä»¶"><a class="header-anchor" href="#æ„å»ºå¯æ‰§è¡Œ-JAR-æ–‡ä»¶">Â¶</a>æ„å»ºå¯æ‰§è¡Œ JAR æ–‡ä»¶</h3><p>å¯ä»¥åœ¨å‘½ä»¤è¡Œä½¿ç”¨ Gradle æˆ– Maven è¿è¡Œè¿™ä¸ªåº”ç”¨ç¨‹åºã€‚ä¹Ÿå¯ä»¥æ„å»ºä¸€ä¸ªåŒ…å«æ‰€æœ‰ä¾èµ–ã€ç±»å’Œèµ„æºçš„å¯æ‰§è¡Œçš„ JAR æ–‡ä»¶å¹¶ç›´æ¥è¿è¡Œå®ƒã€‚æ„å»º JAR æ–‡ä»¶æ›´æ–¹ä¾¿å»åœ¨å¼€å‘ç”Ÿå‘½å‘¨æœŸä¸­è·¨ç¯å¢ƒæ‰“åŒ…ï¼Œç‰ˆæœ¬ç®¡ç†å’Œéƒ¨ç½²æœåŠ¡ã€‚</p><p>å¦‚æœä½¿ç”¨ Gradleï¼Œå¯ä»¥ä½¿ç”¨ <code>./gradlew bootRun</code> å¯åŠ¨åº”ç”¨ã€‚æˆ–è€…ä¹Ÿå¯ä»¥ç”¨ <code>./gradlew build</code> æ„å»º JAR æ–‡ä»¶ç„¶åç”¨ä¸‹é¢å‘½ä»¤è¿è¡Œè¿™ä¸ª JAR æ–‡ä»¶ï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash">java -jar build/libs/gs-securng-web-0.1.0.jar</code></pre><p>å¦‚æœä½¿ç”¨ Mavenï¼Œå¯ä»¥ä½¿ç”¨ <code>./mvnw spring-boot:run</code> å¯åŠ¨åº”ç”¨ã€‚æˆ–è€…ä¹Ÿå¯ä»¥ç”¨ <code>./mvnw clean package</code> æ„å»º JAR æ–‡ä»¶ç„¶åç”¨ä¸‹é¢å‘½ä»¤è¿è¡Œè¿™ä¸ª JAR æ–‡ä»¶ï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash">java -jar target/gs-securing-web-0.1.0.jar</code></pre><p>ä¸€æ—¦é¡¹ç›®å¯åŠ¨ï¼Œåœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ <code>http://localhost:8080</code>ã€‚ä½ å°†ä¼šçœ‹åˆ°ä¸»é¡µï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img onerror="imgOnError(this);" data-fancybox="gallery" src="https://tva1.sinaimg.cn/large/0081Kckwgy1gl8ikm92n4j30ic0cjq43.jpg" alt="The applicationâ€™s home page" data-caption="The applicationâ€™s home page" loading="lazy"></p><p>å½“ä½ ç‚¹å‡»é“¾æ¥ï¼Œä¼šå°è¯•å°†ä½ å¸¦åˆ° <code>hello</code> çš„æ¬¢è¿é¡µã€‚ä½†æ˜¯è¯¥é¡µé¢æ˜¯éœ€è¦é‰´æƒçš„ï¼Œå¹¶ä¸”ä½ è¿˜æ²¡ç™»å½•ï¼Œæ‰€ä»¥ä¼šé‡å®šå‘åˆ°ç™»å½•é¡µï¼Œå¦‚ä¸‹å›¾:</p><p><img onerror="imgOnError(this);" data-fancybox="gallery" src="https://tva1.sinaimg.cn/large/0081Kckwgy1gl8im4joijj30ic0cjjsi.jpg" alt="The login page" data-caption="The login page" loading="lazy"></p><blockquote><p>å¦‚æœä½ æ˜¯ç›´æ¥è·³åˆ°è¿™é‡Œï¼Œæ˜¯æœªæ¥å…¥é‰´æƒçš„ç‰ˆæœ¬ï¼Œå°†ä¸ä¼šçœ‹åˆ°ç™»å½•é¡µã€‚éœ€è¦è¿”å›å»ç»§ç»­å†™å‰©ä¸‹é‰´æƒçš„ä»£ç ã€‚</p></blockquote><p>åœ¨ç™»å½•é¡µï¼Œä½¿ç”¨æµ‹è¯•ç”¨æˆ·ç™»å½•ï¼Œåˆ†åˆ«ä½¿ç”¨ <code>user</code> å’Œ <code>password</code> å¡«å…¥ç”¨æˆ·åå’Œå¯†ç æ¡†ã€‚æäº¤ç™»å½•è¡¨å•ï¼Œå°†ä¼šè¢«æˆåŠŸé‰´æƒå¹¶é‡å®šå‘åˆ°æ¬¢è¿é¡µï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img onerror="imgOnError(this);" data-fancybox="gallery" src="https://tva1.sinaimg.cn/large/0081Kckwgy1gl8iq8kmfxj30ic0codgv.jpg" alt="The secured greeting page" data-caption="The secured greeting page" loading="lazy"></p><p>å¦‚æœç‚¹å‡»ç™»å‡ºæŒ‰é’®ï¼Œé‰´æƒå°†ä¼šè¢«æ³¨é”€ï¼Œä¼šè¿”å›åˆ°ç™»å½•é¡µï¼Œå¹¶æœ‰ä¸€æ¡æç¤ºä¿¡æ¯ï¼Œå‘ŠçŸ¥ä½ å·²ç»ç™»å‡ºäº†ã€‚</p><h2 id="æ€»ç»“"><a class="header-anchor" href="#æ€»ç»“">Â¶</a>æ€»ç»“</h2><p>æ­å–œï¼ä½ å·²ç»å¼€å‘äº†ä¸€ä¸ªç®€å•çš„ç”¨ Spring Security é‰´æƒçš„ web åº”ç”¨ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> spring-boot </tag>
            
            <tag> spring-security </tag>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GitLab CI æ­å»ºæŒ‡å—</title>
      <link href="/2020/10/26/GitLab-CI-%E6%90%AD%E5%BB%BA%E6%8C%87%E5%8D%97/"/>
      <url>/2020/10/26/GitLab-CI-%E6%90%AD%E5%BB%BA%E6%8C%87%E5%8D%97/</url>
      
        <content type="html"><![CDATA[<h1>èµ·å› </h1><p>äº‹æƒ…çš„èµ·å› ä¹Ÿæ˜¯æ¥è‡ªå·¥ä½œä¸­è·Ÿæˆ‘ä»¬æ—¥å¸¸å¯†åˆ‡ç›¸å…³ï¼Œè€Œåˆæ²¡æœ‰æœºä¼šæ¥è§¦åˆ°çš„ä¸œè¥¿ï¼šCIã€‚é¡¹ç›®è„šæ‰‹æ¶è‡ªå¸¦äº† CI è„šæœ¬ï¼Œåªéœ€è¦ç¨ä½œä¿®æ”¹å°±å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼›GitLab ä¸Šçš„é¡¹ç›®çš„ CI é…åˆä¹Ÿä¸éœ€è¦æˆ‘ä»¬ç®¡ï¼Œç›´æ¥ä½¿ç”¨<code>Public Runner</code>å°±è¡Œäº†ã€‚æ—¶é—´é•¿äº†è‡ªç„¶å°±å¯¹è¿™æ–¹é¢æ¯”è¾ƒæ„Ÿå…´è¶£ï¼Œæƒ³çŸ¥é“å…¶ä¸­çš„åŸç†ã€‚æ­£å¥½æ­å»ºäº†æœåŠ¡å™¨ï¼Œéƒ¨ç½²å¥½äº† GitLabï¼Œäºæ˜¯è¯´å¹²å°±å¹²ï¼Œå¼€å§‹ç€æ‰‹åšè‡ªå·±çš„ GitLab CI é…ç½®ã€‚</p><span id="more"></span><h1>è¿‡ç¨‹</h1><h2 id="CI-è„šæœ¬"><a class="header-anchor" href="#CI-è„šæœ¬">Â¶</a>CI è„šæœ¬</h2><p>å·²ç»çŸ¥é“äº†åœ¨é¡¹ç›®ä¸Šæ‰§è¡Œçš„ä¸œè¥¿ï¼ŒåŒ…æ‹¬æ¨ä»£ç ã€æ‰“ tag éƒ½ä¼šå¯¼è‡´ CI çš„è‡ªåŠ¨æ‰§è¡Œï¼Œè€Œä»€ä¹ˆæƒ…å†µæ‰§è¡Œä»€ä¹ˆ CI çš„ stage å°±ç”±é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„.gitlab-ci.yml æ–‡ä»¶å†³å®šã€‚å› æ­¤æ‰¾åˆ°ä¸€ä¸ªé¡¹ç›®çš„ CI æ–‡ä»¶çœ‹çœ‹æ˜¯æ€ä¹ˆå†™çš„ï¼š</p><pre class="language-yml" data-language="yml"><code class="language-yml">image: xxxxxx:maven-openjdk8-onbuildstages:  - build  - releasetest:  stage: build  script:    - rm -rf test_target&#x2F;* &amp;&amp; mkdir -p test_target &amp;&amp; mvn -U clean package -Dmaven.test.skip&#x3D;true -P test    - cp -a oms-web&#x2F;target&#x2F;oms-web.jar test_target&#x2F;ROOT.jar    - chmod +x .&#x2F;test_target&#x2F;ROOT.jar    - cp -rf .&#x2F;.dockerignore .&#x2F;test_target &amp;&amp; cp -rf .&#x2F;Dockerfile .&#x2F;test_target  environment: test  only:    - &#x2F;^neo-java-test-.*$&#x2F;  except:    - branches  artifacts:    paths:     - test_target&#x2F;*    untracked: false    neo-image-upload:  stage: release  image: xxxxx:docker19.06-base-image  script:    - mi_env&#x3D;$(echo $CI_COMMIT_TAG | awk -F &#39;-&#39; &#39;&#123;print $3&#125;&#39;)    - cd .&#x2F;$mi_env&#39;_target&#39;    - docker login hub.pf.xiaomi.com -u $HUBUSER -p $HUBPASS    - docker build . -t  xxxxxx.xxx.xxx&#x2F;$(echo $CI_COMMIT_TAG | awk -F &#39;-&#39; &#39;&#123;print $2&quot;-&quot;$3&#125;&#39;):$CI_COMMIT_TAG    - docker push xxxxxxxxx.xxx.xxx]ã€&#x2F;$(echo $CI_COMMIT_TAG | awk -F &#39;-&#39; &#39;&#123;print $2&quot;-&quot;$3&#125;&#39;):$CI_COMMIT_TAG  environment:    name: neo  only:    - &#x2F;^neo-.*$&#x2F;  except:    - branches...</code></pre><p>é¦–å…ˆä¸Šæ¥æ˜¯å…ˆå®šä¹‰CI éœ€è¦çš„åŸºæœ¬ docker é•œåƒï¼Œä¸ç®¡ä½  CI çš„ç›®çš„æ˜¯ä»€ä¹ˆï¼Œæœ€ç»ˆéƒ½æ˜¯è¦æ‰§è¡Œä¸€æ®µä»£ç ï¼Œè¿™éƒ¨åˆ†ä»£ç ä¸€å®šéœ€è¦ä¸ªç¯å¢ƒå»æ‰§è¡Œçš„ï¼Œè¿™ä¸ªç¯å¢ƒå°±æ˜¯æ¥è‡ªäºå£°æ˜çš„é•œåƒç±»å‹ã€‚ä¸‹é¢æ˜¯å®šä¹‰äº† 2 ä¸ªæ‰§è¡Œé˜¶æ®µï¼šbuild å’Œ releaseã€‚åœ¨ gitlab å¹³å°ä¸Š CI çš„è¿‡ç¨‹çŠ¶æ€å›¾å¯ä»¥çŸ¥é“ï¼šè¿™é‡Œæ˜¯å®šä¹‰äº†ä»–ä»¬æ‰§è¡Œçš„å…ˆåé¡ºåºï¼šéœ€è¦å…ˆæ„å»ºå¥½é¡¹ç›®çš„äº§å‡ºå¯æ‰§è¡ŒåŒ…ï¼Œå†æ¨é€åˆ°æŒ‡å®šçš„å®¹å™¨ä¸­ä¾›å¯åŠ¨ã€‚ä¸‹é¢ 2 éƒ¨åˆ†åˆ™æ˜¯å®šä¹‰äº†å…·ä½“çš„ stage çš„æ¡ä»¶å’Œæ‰§è¡Œçš„å†…å®¹ã€‚stageï¼šæŒ‡å®šä¸ºå“ªä¸ªæ‰§è¡Œé˜¶æ®µã€‚imageï¼šæŒ‡å®šè¯¥é˜¶æ®µä½¿ç”¨çš„é•œåƒã€‚scriptï¼šè¯¥é˜¶æ®µæ‰§è¡Œçš„ä»£ç ï¼Œä¸€èˆ¬ä¸º shell è„šæœ¬ã€‚onlyï¼šæŒ‡å®šè¯¥é˜¶æ®µæ‰§è¡Œçš„è§¦å‘æ¡ä»¶ï¼Œä¸€èˆ¬ä¸ºåˆ†æ”¯æˆ– tag åã€‚</p><p>æ ¹æ®ä¸Šé¢çš„ ci è„šæœ¬ï¼Œæˆ‘å®šä¹‰ä¸€ä¸ªæœ€ç®€å•çš„ CI è„šæœ¬ï¼š</p><pre class="language-shell" data-language="shell"><code class="language-shell">image: docker:dindstages:  - stage1  - stage2stage-first:  stage: stage1  script:    - <span class="token builtin class-name">echo</span> <span class="token string">'I am first executed!'</span>  only:    - master  artifacts:    paths:      - prod_target/*stage-second:  stage: stage2  script:    - <span class="token builtin class-name">echo</span> <span class="token string">'I am second executed!'</span>  only:    - master</code></pre><p>å®šä¹‰äº† 2 ä¸ªé˜¶æ®µï¼Œåˆ†åˆ«æ‰“å°å­—ç¬¦ä¸²ã€‚</p><h2 id="CI-Runner"><a class="header-anchor" href="#CI-Runner">Â¶</a>CI Runner</h2><p>å®Œæˆä¸Šé¢çš„ CI è„šæœ¬åæˆ‘è¿«ä¸åŠå¾…çš„å°†åˆ†æ”¯åˆåˆ° master å¹¶æ¨é€åˆ°è¿œç¨‹ï¼ŒæœŸæœ›ä»–èƒ½ç«‹åˆ»æ‰§è¡Œå‡ºç»“æœã€‚å¯æ˜¯ GitLab ä¸Šæ˜¾ç¤ºçš„CI çŠ¶æ€ä¸ºï¼šPendingï¼šNo Runner available for pipelineã€‚è¡¨æ˜æ²¡æœ‰å¯ä»¥ç”¨æ¥æ‰§è¡ŒCI çš„ Runnerã€‚é‚£ä¹ˆå°±éœ€è¦æŸ¥æ‰¾è·Ÿ Runner ç›¸å…³çš„ä¿¡æ¯ã€‚å¾—çŸ¥ï¼šRunner æ˜¯æ”¯æŒå¤šèŠ‚ç‚¹çš„ç‹¬ç«‹éƒ¨ç½²çš„æœåŠ¡ï¼Œåœ¨æœºå™¨ä¸Šå¯åŠ¨ Runner <strong>ç®¡ç†æœåŠ¡</strong>å<strong>æ³¨å†Œ</strong>ä¸€ä¸ªæ–°çš„ Runnerï¼Œå°†å…¶<strong>ç»‘å®š</strong>åˆ°å¯¹åº”çš„ GitLab ä¸Šï¼ˆå¯ä»¥ç»‘å®šä¸ºä¸€ä¸ª GitLab åº“å…¬ç”¨æˆ–è€…ä¸€ä¸ªæŒ‡å®š repository ä¸“ç”¨ï¼‰å°±å¯ä»¥ç”¨æ¥æ‰§è¡Œ CI äº†ã€‚</p><h3 id="å®‰è£…-gitlab-runner"><a class="header-anchor" href="#å®‰è£…-gitlab-runner">Â¶</a>å®‰è£… gitlab-runner</h3><p>æ­¤æ—¶æˆ‘å°±å»æ‰¾ Runner çš„å®‰è£…äº†ã€‚æˆ‘ç›´æ¥è¿è¡Œï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> gitlab-runner</code></pre><p>å®‰è£…æˆåŠŸï¼Œ<strong>ä½†æ˜¯</strong>æ­¤æ—¶æ‰§è¡Œå†æ‰§è¡Œï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> gitlab-runner register</code></pre><p>æƒ³æ³¨å†Œä¸€ä¸ª Runner å¹¶ç»‘å®šåˆ°æˆ‘çš„ GitLab ä¸Šå‘ç°æ€»æ˜¯å¤±è´¥ã€‚</p><h3 id="Runner-çš„å‘"><a class="header-anchor" href="#Runner-çš„å‘">Â¶</a>Runner çš„å‘</h3><p>ç»è¿‡ä¸€ç•ªæœç´¢ï¼ŒçŸ¥é“äº† GitLab å’Œ Runner çš„ç‰ˆæœ¬æœ‰çº¦æŸï¼š8.X ç‰ˆæœ¬çš„ GitLab åªæ”¯æŒ 1.X ç‰ˆæœ¬çš„ Runner æœåŠ¡ï¼Œè€Œ apt è‡ªåŠ¨å®‰è£…çš„ä¸º 13.X ç‰ˆæœ¬çš„äº†ï¼Œæ— æ³•å…¼å®¹ã€‚äºæ˜¯å°±éœ€è¦å¼€å§‹æœç´¢äº’è”ç½‘ä¸Šçš„ 1.X ç‰ˆæœ¬çš„ Runner å®‰è£…ç¨‹åºã€‚</p><ul><li><p>Runner çš„ RELEASEï¼šæ²¡æœ‰ 1.X ç‰ˆæœ¬ã€‚</p></li><li><p>Runner çš„ Tag åˆ—è¡¨ï¼šæœ‰ 1.X ç‰ˆæœ¬çš„ tag ä½†æ˜¯æ²¡æœ‰ artifacts äº§ç‰©ã€‚</p></li><li><p>å„å¤§é•œåƒç«™ï¼šåªæœ‰ 10.X å¼€å§‹ç‰ˆæœ¬çš„ Runner å®‰è£…ç¨‹åºã€‚</p></li></ul><p>çœ‹ä¼¼å·²ç»å±±ç©·æ°´å°½äº†ã€‚å¿½ç„¶çµå…‰ä¸€ç°ï¼šä½ è™½ç„¶å¯ä»¥åˆ é™¤ RELEASE çš„æ—§ç‰ˆæœ¬ï¼Œä½†æ˜¯ä½ æ‰“ç‰ˆæœ¬ tag çš„é‚£æ¬¡ CI ä¸€å®šæœ‰è¾“å‡ºåˆ°çš„è·¯å¾„ï¼Œæˆ‘å°±å»è¿½æº¯ä½ é‚£ä¸ªç”Ÿæˆ artifact çš„è·¯å¾„ä¸å°±å¯ä»¥äº†ï¼Ÿæœç„¶ï¼Œè¢«æˆ‘æ‰¾åˆ°äº†å¯¼å‡ºåˆ° AWS çš„<a href="https://gitlab-ci-multi-runner-downloads.s3.amazonaws.com/v1.11.5/deb/gitlab-ci-multi-runner_i386.deb">æ–‡ä»¶</a>~</p><p><img onerror="imgOnError(this);" data-fancybox="gallery" src="https://tva1.sinaimg.cn/large/0081Kckwgy1gk38mj082jj31uh0u0h8v.jpg" alt="CI product" data-caption="CI product" loading="lazy"></p><p>æ‰¾åˆ°äº†å®‰è£…æ–‡ä»¶åå°±æ˜¯é¡ºåˆ©çš„å®‰è£…è¿‡ç¨‹~ç›´æ¥ç”¨å‘½ä»¤è¯´æ˜å§ï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">scp</span> ~/Downloads/gitlab-ci-multi-runner_i386.deb haoxingxiao@XXX.XXX.XXX.XXX:~/<span class="token function">ssh</span> XXX.XXX.XXX.XXX<span class="token function">sudo</span> dpkg -i gitlab-ci-multi-runner_i386.deb<span class="token function">sudo</span> gitlab-runner register<span class="token punctuation">(</span>gitlab url<span class="token punctuation">)</span><span class="token operator">></span> http://XXXXXXXX.XXX.XXX/ci/    // æ³¨æ„è¿™é‡Œéœ€è¦æä¾› /ci è·¯å¾„<span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token operator">></span> XXXXXXXXXXXXXX<span class="token punctuation">(</span>runner name<span class="token punctuation">)</span><span class="token operator">></span> tencent-cloud-runner<span class="token punctuation">(</span>tags<span class="token punctuation">)</span><span class="token operator">></span> tencent,common<span class="token punctuation">(</span>allow untagged task?<span class="token punctuation">)</span><span class="token operator">></span> <span class="token boolean">true</span><span class="token punctuation">(</span>choose type:docker,shell <span class="token operator">&amp;</span> etc.?<span class="token punctuation">)</span><span class="token operator">></span> docker</code></pre><h2 id="æ‰§è¡Œ-CI"><a class="header-anchor" href="#æ‰§è¡Œ-CI">Â¶</a>æ‰§è¡Œ CI</h2><p>é…ç½®å¥½ Runner åå°±å¯ä»¥åœ¨ GitLab ä¸Šçœ‹åˆ°åˆ›å»ºæˆåŠŸçš„ Runner äº†:</p><p><img onerror="imgOnError(this);" data-fancybox="gallery" src="https://tva1.sinaimg.cn/large/0081Kckwgy1gk38uzcm7sj31ye0u0dlr.jpg" alt="Runners" data-caption="Runners" loading="lazy"></p><p>è¿™é‡Œæˆ‘å·²ç»æŠŠç§Ÿçš„é˜¿é‡Œäº‘æœåŠ¡å™¨å’Œè…¾è®¯äº‘çš„æœåŠ¡å™¨éƒ½é…ç½®ä¸Šå»äº†ï¼Œæ„æˆäº†å¤šä¸ªèŠ‚ç‚¹çš„ Runner é›†ç¾¤ï¼Œå½“ CI ä»»åŠ¡è¿›å…¥åä¼šè‡ªåŠ¨å¯»æ‰¾ç©ºé—²çš„ Runner å»æ‰§è¡Œã€‚å…¶å®åŒä¸€ä¸ªå®¹å™¨ç»‘å®šå¤šä¸ª Runner ä¹Ÿå¯ä»¥ï¼Œä¸è¿‡è´Ÿè½½å°±éƒ½åœ¨ä¸€å°å®¹å™¨ä¸Šäº†ã€‚</p><p>è€Œåˆšæ‰ Pending çš„ CI ä¹Ÿå¼€å§‹æ‰§è¡Œäº†ã€‚å­¦ä¹ äº†ä¸€ä¸‹ CI è„šæœ¬çš„è¯­æ³•å’ŒçŸ¥è¯†ï¼Œæœ€ç»ˆè¿è¡Œçš„ç»“æœå¦‚ä¸‹å›¾ï¼š</p><p><img onerror="imgOnError(this);" data-fancybox="gallery" src="https://tva1.sinaimg.cn/large/0081Kckwgy1gk38xonz62j32140kcdhu.jpg" alt="stages" data-caption="stages" loading="lazy"></p><p><img onerror="imgOnError(this);" data-fancybox="gallery" src="https://tva1.sinaimg.cn/large/0081Kckwgy1gk38yei629j31i80pqtdh.jpg" alt="stage1" data-caption="stage1" loading="lazy"></p><p>æœ€ç»ˆè¾¾åˆ°äº†æ­å»ºè‡ªå·±çš„è‡ªåŠ¨åŒ– CI çš„ç¯å¢ƒ~ä¹Ÿåˆ©ç”¨äº†å¼€æºå…è´¹çš„ <a href="https://shields.io/category/build">badge æœåŠ¡</a> ç»™é¡¹ç›®çš„ README å¢åŠ äº†ä¸€ä¸ªæ„å»º CI çŠ¶æ€çš„å¾½ç« ï¼š</p><p><img onerror="imgOnError(this);" data-fancybox="gallery" src="https://tva1.sinaimg.cn/large/0081Kckwgy1gk393be6hqj318u0d4mzd.jpg" alt="badge" data-caption="badge" loading="lazy"></p><p>æ–¹ä¾¿ç›´è§‚åœ¨é¡¹ç›®ä¸»é¡µæŸ¥çœ‹çŠ¶æ€ã€‚</p><h1>åç»­</h1><p>ç»è¿‡æ­å»º GitLab å’Œæ­å»º GitLab CI 2 æ­¥ä¹‹åï¼Œä¸‹ä¸€æ­¥æœ‰å¥½å‡ ä¸ªæƒ³è¦åšçš„ä¸œè¥¿ï¼š</p><ol><li>Git Talk æœåŠ¡</li><li>åˆ›å»º Feishu SDK é¡¹ç›®ï¼Œéƒ¨ç½²é£ä¹¦é€šçŸ¥çš„æœåŠ¡ï¼Œå¹¶æ¥å…¥ CIï¼Œå®ç°ä¸»åŠ¨æ¨é€æ„å»ºç»“æœåˆ°é£ä¹¦å®¢æˆ·ç«¯ã€‚</li><li>è¿›ä¸€æ­¥é…ç½® Blogï¼Œç›®å‰ Blog å¼„çš„æ¯”è¾ƒä»“ä¿ƒï¼Œå¾ˆå¤šä¿¡æ¯å’Œé…ç½®è¿˜æ²¡åŠ ä¸Šå»ã€‚</li></ol><p>ä»Šå¤©å°±å…ˆå†™è¿™ä¹ˆå¤šå§~éš¾å¾—æœ‰æ‘¸é±¼çš„æœºä¼šå¼„è‡ªå·±çš„ä¸œè¥¿ï¼Œå¸Œæœ›è¿˜èƒ½ä¸€ç›´ä¿æŒè¿™ç§çƒ­æƒ…åšä¸‹å»ï¼â˜€ï¸</p>]]></content>
      
      
      
        <tags>
            
            <tag> æ•™ç¨‹ </tag>
            
            <tag> æŠ€æœ¯ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ€ç»´å¯¼å›¾demo</title>
      <link href="/2020/07/26/%E6%80%9D%E7%BB%B4%E5%AF%BC%E5%9B%BEdemo/"/>
      <url>/2020/07/26/%E6%80%9D%E7%BB%B4%E5%AF%BC%E5%9B%BEdemo/</url>
      
        <content type="html"><![CDATA[<script>const data = {  label: "Central Topic",  children: [    {      label: "Main Topic 1",      children: [        {          label: "Main Topic 1"        }      ]    },    {      label: "Main Topic 2"    },    {      label: "Main Topic 3"    }  ]}</script> <GGEditor className="editor">      <Mind className="editorBd" data={data} />      <EditableLabel />    </GGEditor><pre class="mermaid">graph TD;A-->B;B-->C;A-->D;</pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>å¦‚ä½•å®ç°å¤åˆ¶Excelå†…å®¹æ›´æ–°æ•°æ®</title>
      <link href="/2020/05/15/%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E5%A4%8D%E5%88%B6Excel%E5%86%85%E5%AE%B9%E6%9B%B4%E6%96%B0%E6%95%B0%E6%8D%AE/"/>
      <url>/2020/05/15/%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E5%A4%8D%E5%88%B6Excel%E5%86%85%E5%AE%B9%E6%9B%B4%E6%96%B0%E6%95%B0%E6%8D%AE/</url>
      
        <content type="html"><![CDATA[<h2 id="èƒŒæ™¯"><a class="header-anchor" href="#èƒŒæ™¯">Â¶</a>èƒŒæ™¯</h2><p>â€ƒâ€ƒä¸Šå­£åº¦åœ¨è¿­ä»£é€šç”¨ç­–ç•¥çš„æ—¶å€™ï¼Œæ›¾ç»å°è¯•è¿ç§» PHP ç‰ˆæœ¬çš„ç­–ç•¥æ•°æ®ä¸Šä¼ åŠŸèƒ½åˆ° Java åå°ï¼Œæœ€åç»“æœæ˜¯é…ç½®ç®¡ç†éƒ¨åˆ†çš„éƒ½å®Œæˆäº†è¿ç§»ï¼ˆæŠ€æœ¯éš¾åº¦è¾ƒä½ï¼‰ï¼Œä½†æ˜¯ç›¸å¯¹è€Œè¨€ï¼Œä¿®æ”¹ä¸‹è½½ä¸‹æ¥çš„ Excel æ•°æ®ï¼Œç„¶åå¤åˆ¶å†…å®¹åˆ°æ–‡æœ¬åŸŸé‡Œå®ç°ä¸Šä¼ æ›´æ–°çš„åŠŸèƒ½å°±å¤æ‚çš„å¤šï¼Œåœ¨ä¸Šæ¬¡çš„è¿ç§»ä¸­ä»¥å¤±è´¥å‘Šç»ˆï¼Œæ²¡æœ‰é¡ºåˆ©è¿ç§»è¿‡æ¥ã€‚</p><p>â€ƒâ€ƒè¿™ä¸ªå­£åº¦éœ€è¦åšçš„éœ€æ±‚â€æ™ºèƒ½è°ƒæ‹¨â€œä¹Ÿæœ‰ç±»ä¼¼çš„æŠ€æœ¯ç‚¹ï¼šéœ€è¦å®ç°æ™ºèƒ½è°ƒæ‹¨æ–¹æ¡ˆçš„ä¸‹è½½æ•°æ®å’Œä¿®æ”¹æ•°æ®ï¼Œç„¶åä¸Šä¼ è¦†ç›–æ›´æ–°ï¼Œè¿˜éœ€è¦è®°å½•æ›´æ–°æ—¥å¿—ã€‚ä¸ä¸€æ ·çš„ä¸šåŠ¡åœºæ™¯ï¼Œç›¸ä¼¼çš„æŠ€æœ¯ç‚¹ï¼Œä¸è¿‡æœ€å¤§çš„ä¸åŒåœ¨äºï¼šè¿™æ¬¡çš„æ–¹æ¡ˆå…¨ç›˜ç”±æˆ‘è‡ªå·±æ¥å†³ç­–ï¼Œéœ€è¦ä»€ä¹ˆå­—æ®µè‡ªå·±åŠ ï¼Œéœ€è¦æ‰§è¡Œä»€ä¹ˆæ“ä½œè‡ªå·±æ„æ€ï¼›è‡ªç”±å‘æŒ¥çš„ç©ºé—´å¾ˆå¤§ã€‚å› æ­¤å¿ƒä¸­å°±å†³å¿ƒè¿™æ¬¡ä¸€å®šè¦æŠŠè¿™ä¸ªåŠŸèƒ½åšå¥½ã€‚</p><p><strong>ç­–ç•¥æ›´æ–°çš„ä¿¡æ¯</strong></p><p><img onerror="imgOnError(this);" data-fancybox="gallery" src="/images/%E7%AD%96%E7%95%A5%E6%9B%B4%E6%96%B0.png" alt="ç­–ç•¥æ›´æ–°è¡¨" data-caption="ç­–ç•¥æ›´æ–°è¡¨" loading="lazy"></p><span id="more"></span><p><strong>æ™ºèƒ½è°ƒæ‹¨æ›´æ–°çš„ä¿¡æ¯</strong></p><p><img onerror="imgOnError(this);" data-fancybox="gallery" src="/images/%E6%99%BA%E8%83%BD%E8%B0%83%E6%8B%A8%E6%9B%B4%E6%96%B0.png" alt="æ™ºèƒ½è°ƒæ‹¨æ›´æ–°è¡¨" data-caption="æ™ºèƒ½è°ƒæ‹¨æ›´æ–°è¡¨" loading="lazy"></p><h2 id="æ„æ€"><a class="header-anchor" href="#æ„æ€">Â¶</a>æ„æ€</h2><p>â€ƒâ€ƒåœ¨å›å¿†ä¸Šæ¬¡å¼€å‘é€šç”¨ç­–ç•¥çš„ç»éªŒä¸­å’Œå¯¹æœ¬æ¬¡æ™ºèƒ½è°ƒæ‹¨æ–¹æ¡ˆçš„æ‹†è§£çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘å°†ä¸Šä¼ æ•°æ®æ›´æ–°çš„éš¾ç‚¹æ‹†åˆ†ä¸ºå¦‚ä¸‹å‡ ä¸ªç‚¹ï¼š</p><h3 id="è¡¨æ ¼æ•°æ®çš„æ ¡éªŒ"><a class="header-anchor" href="#è¡¨æ ¼æ•°æ®çš„æ ¡éªŒ">Â¶</a>è¡¨æ ¼æ•°æ®çš„æ ¡éªŒ</h3><p>â€ƒâ€ƒæ•°æ®è¿›å…¥åå°ç¬¬ä¸€æ­¥å°±æ˜¯éœ€è¦å¯¹ä¼ å…¥çš„æ•°æ®è¿›è¡Œæ ¡éªŒï¼Œå…¶å®ä¸ä»…ä»…æ˜¯ä¸Šä¼ æ›´æ–°ï¼Œæ‰€æœ‰çš„æ¥å£éƒ½åº”è¯¥å¯¹å…¥å‚è¿›è¡Œæ ¡éªŒï¼Œåªæ˜¯è¯¥åœºæ™¯ä¸‹â€éç»“æ„åŒ–æ•°æ®â€”â€”Stringâ€œ è½¬æ¢æˆâ€ç»“æ„åŒ–æ•°æ®â€”â€”è¡¨æ ¼â€œæ‰€éœ€è¦è¿›è¡Œçš„æ ¡éªŒç›¸å¯¹æ›´éº»çƒ¦ã€‚æˆ‘è¿™é‡Œå¯¹æ™ºèƒ½è°ƒæ‹¨æ–¹æ¡ˆçš„æ•°æ®æ ¡éªŒåˆ†æˆ2æ­¥ï¼š</p><p>â€ƒâ€ƒç¬¬ä¸€æ­¥ï¼Œè¡¨å¤´çš„éªŒè¯ã€‚éªŒè¯è¡¨æ ¼çš„åˆ—æ•°æ˜¯å¦å’ŒåŸå§‹æ•°æ®ä¸€è‡´ï¼Œé¡ºåºæ˜¯å¦ä¸€è‡´ã€‚è¿™é‡Œä»åº“è¡¨ä¸­æŒ‰ç…§æŒ‡å®šçš„æ’åºï¼ˆä¸€èˆ¬æŒ‰ç…§ <code>id</code> æ’åºï¼Œç­–ç•¥å­—æ®µè¡¨æœ‰ <code>order</code> å­—æ®µï¼Œå¯ä»¥ç”¨è‡ªå®šä¹‰æ’åºé¡ºåºï¼‰å–å‡ºæœŸæœ›çš„åˆ—ä¿¡æ¯ï¼Œå¹¶å­˜å…¥åˆ° <code>ArrayList</code> è¿™ç§æœ‰åºçš„åˆ—è¡¨ä¸­è¿›è¡Œæ¯”å¯¹ã€‚</p><p>â€ƒâ€ƒç¬¬äºŒæ­¥ï¼Œæ•°æ®è¡Œæ•°çš„éªŒè¯ã€‚æ™ºèƒ½è°ƒæ‹¨æ–¹æ¡ˆå¯¼å…¥éœ€è¦ä¿è¯æ•°æ®è¡Œæ•°å’ŒåŸå§‹æ•°æ®ä¸€è‡´ï¼Œå› æ­¤è¿™é‡ŒæŠŠåŸå§‹è¡¨ä¸­çš„è®°å½•ä¹Ÿå…¨æ•°æŸ¥å‡ºæŒ‰ç…§ç‰¹å®šé¡ºåº(è¿™é‡Œæ˜¯ç”¨çš„å•†å“ ID æ’åº)ï¼Œå¹¶å’Œå…¥å‚é€è¡Œå¯¹æ¯”ç¡®è®¤æ‰€æœ‰çš„è¡Œéƒ½æ˜¯æ­£ç¡®çš„é¡ºåºï¼Œå¹¶ä¸”å’Œä¸Šä¸€æ­¥çš„è¡¨å¤´é•¿åº¦å¯¹æ¯”ï¼Œç¡®è®¤æ¯ä¸€è¡Œéƒ½ä¸ç¼ºæ•°ã€‚é€šç”¨ç­–ç•¥é‚£è¾¹ä¸éœ€è¦ä¿è¯è¡Œæ•°ä¸€è‡´ï¼Œä½†æ˜¯éœ€è¦ä¿è¯æ•°æ®åˆ—ä¸€è‡´ï¼Œå› æ­¤è¿™ä¸€æ­¥ä¹Ÿä¸èƒ½çœç•¥ã€‚</p><h3 id="æ•°æ®é¡¹æ›´æ–°æˆ–æ–°å¢çš„åˆ¤æ–­"><a class="header-anchor" href="#æ•°æ®é¡¹æ›´æ–°æˆ–æ–°å¢çš„åˆ¤æ–­">Â¶</a>æ•°æ®é¡¹æ›´æ–°æˆ–æ–°å¢çš„åˆ¤æ–­</h3><p>â€ƒâ€ƒæ•°æ®é¡¹æ˜¯æ–°å¢è¿˜æ˜¯æ›´æ–°æ˜¯æ ¹æ®æ•°æ®åº“ä¸­æ˜¯å¦æœ‰è®°å½•å†³å®šçš„ï¼Œæ™ºèƒ½è°ƒæ‹¨è¿™é‡Œæ˜¯æ ¹æ®åŸå§‹æ•°é‡æ˜¯å¦ç­‰äº0ç¡®å®šçš„ï¼Œé€šç”¨ç­–ç•¥æ˜¯é€šè¿‡ç´¢å¼•å­—æ®µæ˜¯å¦ä¸€è‡´ç¡®å®šçš„ã€‚ä¸¤è€…å½¢å¼ä¸åŒï¼Œä½†éƒ½éœ€è¦åšæ›´æ–°/æ–°å¢çš„åˆ¤æ–­ã€‚æ™ºèƒ½è°ƒæ‹¨åˆ¤æ–­çš„é€»è¾‘å¦‚ä¸‹ï¼š</p><pre class="language-java" data-language="java"><code class="language-java">updates<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>update <span class="token operator">-></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>update<span class="token punctuation">.</span><span class="token function">getNumFrom</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// ä»æ— åˆ°æœ‰è¦æ–°å¢è®°å½•</span>    itemService<span class="token punctuation">.</span><span class="token function">insertDetailRecord</span><span class="token punctuation">(</span>update<span class="token punctuation">,</span> planId<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>update<span class="token punctuation">.</span><span class="token function">getNumTo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// ä»æœ‰åˆ°æ— è¦åˆ é™¤è®°å½•</span>    itemService<span class="token punctuation">.</span><span class="token function">deleteDetailRecord</span><span class="token punctuation">(</span>update<span class="token punctuation">,</span> planId<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// å¦åˆ™æ›´æ–°è®°å½•</span>    itemService<span class="token punctuation">.</span><span class="token function">updateDetailRecord</span><span class="token punctuation">(</span>update<span class="token punctuation">,</span> planId<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>â€ƒâ€ƒéå¸¸ç®€å•çš„å®ç°äº†æ–°å¢/æ›´æ–°åˆ¤æ–­ã€‚</p><p>â€ƒâ€ƒé€šç”¨ç­–ç•¥çš„æ–°å¢/æ›´æ–°åˆ¤æ–­éœ€è¦æ ¹æ®ç´¢å¼•å­—æ®µç¡®è®¤ï¼Œç›®å‰ç´¢å¼•å­—æ®µæ˜¯é€šè¿‡å–æ•°æ®æ‰‹åŠ¨æ‹¼æ¥å®ç°çš„ï¼Œåç»­è®¡åˆ’åœ¨è¡¨ä¸­å†—ä½™è¯¥å­—æ®µæé«˜æ€§èƒ½ï¼ŒåŒæ—¶ä¹Ÿå®ç°äº†å¯¹ä¿®æ”¹ç´¢å¼•è€Œä¸éœ€è¦æ¸…ç©ºæ•°æ®ã€‚è¿™é‡Œåˆ¤æ–­æ–°å¢/æ›´æ–°çš„é€»è¾‘å¦‚ä¸‹ï¼š</p><pre class="language-java" data-language="java"><code class="language-java">updates<span class="token punctuation">.</span><span class="token function">foreach</span><span class="token punctuation">(</span>update <span class="token operator">-></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span><span class="token punctuation">(</span>existIndexes<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>update<span class="token punctuation">.</span><span class="token function">getIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    strategyDataDoMapper<span class="token punctuation">.</span><span class="token function">updateData</span><span class="token punctuation">(</span>update<span class="token punctuation">,</span> existIndexes<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>update<span class="token punctuation">.</span><span class="token function">getIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> strategyId<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    strategyDataDoMapper<span class="token punctuation">.</span><span class="token function">insertData</span><span class="token punctuation">(</span>update<span class="token punctuation">,</span> strategyId<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>â€ƒâ€ƒå®ç°æ–°å¢/æ›´æ–°åˆ¤æ–­åŒæ ·ä¹Ÿä¸å¤æ‚ã€‚</p><h3 id="ç»´åº¦å€¼çš„è½¬æ¢"><a class="header-anchor" href="#ç»´åº¦å€¼çš„è½¬æ¢">Â¶</a>ç»´åº¦å€¼çš„è½¬æ¢</h3><p>â€ƒâ€ƒæ™ºèƒ½è°ƒæ‹¨æ–¹æ¡ˆçš„ç»´åº¦è½¬æ¢è¾ƒä¸ºæœ‰é™ï¼Œä»…ä»…éœ€è¦ä»“åº“ç»´åº¦ï¼Œåœºæ™¯ä¹Ÿä»…é™äºå±•ç¤ºè¡¨å¤´çš„ä»“åº“ä¿¡æ¯å’Œæ—¥å¿—çš„ä»“åº“ä¿¡æ¯ï¼Œä½¿ç”¨åˆ°ç»´åº¦è½¬æ¢åªæœ‰ä¸€ç±»ï¼š<code>XmDimensionUtil.getRemote(&quot;mihome&quot;, mihomeId)</code>ã€‚ä¸è¿‡é€šç”¨ç­–ç•¥åœºæ™¯çš„æ‰€æœ‰å­—æ®µéƒ½æ˜¯é€šè¿‡é…ç½®å®ç°ï¼Œå› æ­¤ç»´åº¦è½¬æ¢çš„åœºæ™¯æ›´å¤šæ ·ï¼Œç»´åº¦è½¬æ¢+æ•°æ®ç»“æ„è½¬æ¢äº¤ç»‡åœ¨ä¸€èµ·ï¼Œé€ æˆäº†ä¸Šä¸€æ¬¡é€šç”¨ç­–ç•¥çš„æ¥å£è¿ç§»æ— æ¯”ç—›è‹¦ï¼Œæ€»æ˜¯è½¬ç€è½¬ç€å°±å¿˜è®°å½“å‰çš„è¿™ä¸ªå­—æ®µåˆ°åº•æ˜¯åç§°è¿˜æ˜¯é”®ï¼Œè¿˜å­˜åœ¨å¾ªç¯è½¬æ¢çš„æ½œåœ¨é£é™©ã€‚<br>â€ƒâ€ƒè¿™æ¬¡å®ç°æ™ºèƒ½è°ƒæ‹¨çš„è¿‡ç¨‹å°†è¿™ä¸€éƒ¨åˆ†æ€è·¯æ•´ç†æ¸…æ¥šäº†ï¼ŒåŸåˆ™ä¹Ÿå¾ˆç®€å•ï¼šä¿¡æ¯åªæ‹“å±•ä¸è¦†ç›–ã€‚ç”¨é€šä¿—çš„è¯è¯´å°±æ˜¯ï¼š<strong>æŠŠ key å’Œ name éƒ½å­˜èµ·æ¥ï¼Œå°±ä¸å­˜åœ¨è¿·æƒ‘çš„å¯èƒ½äº†</strong>ã€‚è¿™ä¸€å¥è¯´èµ·æ¥ç®€å•ï¼Œä½†æ˜¯ç»´åº¦ä¿¡æ¯æ˜¯ç”¨æˆ·é…ç½®ï¼Œå®è·µèµ·æ¥å¯èƒ½ä»æœ‰ä¸€äº›å‘éœ€è¦è¸©ã€‚</p><h2 id="å®ç°"><a class="header-anchor" href="#å®ç°">Â¶</a>å®ç°</h2><p>â€ƒâ€ƒè€ƒè™‘å®Œæ‰€æœ‰çš„å‘ä¹‹åï¼Œå®ç°èµ·æ¥å°±æ¯”è¾ƒé¡ºåˆ©äº†ï¼Œä¹Ÿæ¯”è¾ƒå¹¸è¿ï¼Œç”¨äº†å¤§çº¦åŠå¤©ï¼ˆ4-6å°æ—¶ï¼‰ä¸€å£æ°”å®ç°äº†è¿™éƒ¨åˆ†çš„ä»£ç ã€‚è‡ªæˆ‘æ„Ÿè§‰åœ¨æ²¡æœ‰å¤§é‡æ³¨é‡Šçš„æƒ…å†µä¸‹å¯è¯»æ€§è¿˜æ˜¯ä¸é”™çš„~è¿™é‡Œç›´æ¥æŠ›å‡ºæ¥ä¾›å¤§å®¶é­ç­–æŒ‡æ­£ã€‚</p><h3 id="service-ä»£ç "><a class="header-anchor" href="#service-ä»£ç ">Â¶</a>service ä»£ç </h3><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">importTransferPlanDetail</span><span class="token punctuation">(</span><span class="token class-name">Long</span> planId<span class="token punctuation">,</span> <span class="token class-name">String</span> data<span class="token punctuation">,</span> <span class="token class-name">Long</span> operator<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token class-name">TransferPlanDO</span> plan <span class="token operator">=</span> transferPlanMapper<span class="token punctuation">.</span><span class="token function">selectPlanByPlanId</span><span class="token punctuation">(</span>planId<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>plan <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">CommonException</span><span class="token punctuation">(</span><span class="token class-name">ErrorCodeEnum</span><span class="token punctuation">.</span>TRANSFER_PLAN_NOT_EXIST<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>plan<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token class-name">TransferConst<span class="token punctuation">.</span>PlanStatus</span><span class="token punctuation">.</span>CREATED<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">CommonException</span><span class="token punctuation">(</span><span class="token class-name">ErrorCodeEnum</span><span class="token punctuation">.</span>TRANSFER_PLAN_NOT_EDITABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token class-name">TransferPlanDetailBO</span> bo <span class="token operator">=</span> <span class="token function">getTransferPlanDetail</span><span class="token punctuation">(</span>planId<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token class-name">StringBuilder</span> err <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>      <span class="token comment">// éªŒè¯æ•°æ® + è·å–æ•°æ®çš„æ›´æ–°ä¿¡æ¯</span>      <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TransferPlanDetailRecordUpdateBO</span><span class="token punctuation">></span></span> updates <span class="token operator">=</span> <span class="token function">getUpdates</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> bo<span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> err<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>      <span class="token comment">// æ›´æ–°æ•°æ®åº“è¯¦æƒ…æ•°æ®</span>      updates<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>update <span class="token operator">-></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>update<span class="token punctuation">.</span><span class="token function">getNumFrom</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// ä»æ— åˆ°æœ‰è¦æ–°å¢è®°å½•</span>  itemService<span class="token punctuation">.</span><span class="token function">insertDetailRecord</span><span class="token punctuation">(</span>update<span class="token punctuation">,</span> planId<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>update<span class="token punctuation">.</span><span class="token function">getNumTo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// ä»æœ‰åˆ°æ— è¦åˆ é™¤è®°å½•</span>  itemService<span class="token punctuation">.</span><span class="token function">deleteDetailRecord</span><span class="token punctuation">(</span>update<span class="token punctuation">,</span> planId<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// å¦åˆ™æ›´æ–°è®°å½•</span>  itemService<span class="token punctuation">.</span><span class="token function">updateDetailRecord</span><span class="token punctuation">(</span>update<span class="token punctuation">,</span> planId<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// æ›´æ–°è°ƒæ‹¨æ–¹æ¡ˆæ›´æ–°æ—¶é—´</span>      transferPlanMapper<span class="token punctuation">.</span><span class="token function">updateTime</span><span class="token punctuation">(</span>planId<span class="token punctuation">,</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// å†™å…¥æ—¥å¿—</span>      logService<span class="token punctuation">.</span><span class="token function">logImport</span><span class="token punctuation">(</span>operator<span class="token punctuation">,</span> planId<span class="token punctuation">,</span> updates<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      err<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> err<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span></code></pre><h3 id="update-å‡½æ•°éƒ¨åˆ†"><a class="header-anchor" href="#update-å‡½æ•°éƒ¨åˆ†">Â¶</a>update å‡½æ•°éƒ¨åˆ†</h3><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TransferPlanDetailRecordUpdateBO</span><span class="token punctuation">></span></span> <span class="token function">getUpdates</span><span class="token punctuation">(</span><span class="token class-name">String</span> data<span class="token punctuation">,</span> <span class="token class-name">TransferPlanDetailBO</span> bo<span class="token punctuation">,</span> <span class="token class-name">StringBuilder</span> err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> rows <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">"[\n]+"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>rows<span class="token punctuation">.</span>length <span class="token operator">!=</span> bo<span class="token punctuation">.</span><span class="token function">getDatas</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"æ•°æ®è¡Œæ•°é”™è¯¯ï¼éœ€è¦"</span> <span class="token operator">+</span> <span class="token punctuation">(</span>bo<span class="token punctuation">.</span><span class="token function">getDatas</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"è¡Œã€‚"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> headers <span class="token operator">=</span> rows<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">"[\t]+"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> dataRows <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">copyOfRange</span><span class="token punctuation">(</span>rows<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> rows<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">PlanDetailHeaderBO</span><span class="token punctuation">[</span><span class="token punctuation">]</span> existHeaders <span class="token operator">=</span> bo<span class="token punctuation">.</span><span class="token function">getHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PlanDetailHeaderBO</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> existDataRows <span class="token operator">=</span> bo<span class="token punctuation">.</span><span class="token function">getDatas</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>existHeaders<span class="token punctuation">.</span>length <span class="token operator">!=</span> headers<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"è¡¨å¤´åˆ—æ•°é”™è¯¯ï¼éœ€è¦"</span> <span class="token operator">+</span> existHeaders<span class="token punctuation">.</span>length <span class="token operator">+</span> <span class="token string">"åˆ—ã€‚"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// éªŒè¯è¡¨å¤´</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> existDataRows<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>headers<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>existHeaders<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">getTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            err<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"è¡¨å¤´ç¼ºå°‘["</span> <span class="token operator">+</span> existHeaders<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">getTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"]\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TransferPlanDetailRecordUpdateBO</span><span class="token punctuation">></span></span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// éªŒè¯æ•°æ®</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> existDataRows<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> cells <span class="token operator">=</span> dataRows<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">"[\t]+"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> existRow <span class="token operator">=</span> existDataRows<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> currentGoodsId <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>existRow<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"goods_id"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> currentGoodsName <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> existRow<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"goods_name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> currentSku <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> existRow<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"sku"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>cells<span class="token punctuation">.</span>length <span class="token operator">!=</span> existRow<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"ç¬¬"</span> <span class="token operator">+</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"è¡Œæ•°æ®åˆ—æ•°é”™è¯¯ï¼éœ€è¦"</span> <span class="token operator">+</span> existRow<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"åˆ—ã€‚\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">boolean</span> goodsId <span class="token operator">=</span> cells<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>currentGoodsId<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">boolean</span> goodsName <span class="token operator">=</span> cells<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>currentGoodsName<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">boolean</span> sku <span class="token operator">=</span> cells<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>currentSku<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>goodsId <span class="token operator">||</span> <span class="token operator">!</span>goodsName <span class="token operator">||</span> <span class="token operator">!</span>sku<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            err<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"ç¬¬"</span> <span class="token operator">+</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"è¡Œæ•°æ®å•†å“ä¿¡æ¯æœ‰è¯¯ï¼Œåº”ä¸º"</span> <span class="token operator">+</span> currentGoodsName<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> cells<span class="token punctuation">.</span>length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">String</span> currentCellInfo <span class="token operator">=</span> existHeaders<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">getTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"è°ƒæ‹¨"</span> <span class="token operator">+</span> currentGoodsName<span class="token punctuation">;</span>            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                <span class="token comment">// è½¬æ¢æ•°æ®</span>                <span class="token class-name">Integer</span> preNum <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Double</span><span class="token punctuation">)</span> existRow<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>existHeaders<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">getDataIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">intValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">Integer</span> newNum <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>cells<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>newNum <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    err<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>currentCellInfo <span class="token operator">+</span> <span class="token string">"æ•°æ®æœ‰è¯¯ï¼Œè¯·æ£€æŸ¥ã€‚\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">continue</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>preNum<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>newNum<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> mihomePair <span class="token operator">=</span> existHeaders<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">getDataIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">"-"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> mihomeNamepair <span class="token operator">=</span> existHeaders<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">getTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">"-"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    result<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">TransferPlanDetailRecordUpdateBO</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                            <span class="token punctuation">.</span><span class="token function">goodsId</span><span class="token punctuation">(</span>currentGoodsId<span class="token punctuation">)</span>                            <span class="token punctuation">.</span><span class="token function">goodsName</span><span class="token punctuation">(</span>currentGoodsName<span class="token punctuation">)</span>                            <span class="token punctuation">.</span><span class="token function">sku</span><span class="token punctuation">(</span>currentSku<span class="token punctuation">)</span>                            <span class="token punctuation">.</span><span class="token function">mihomeFrom</span><span class="token punctuation">(</span>mihomePair<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>                            <span class="token punctuation">.</span><span class="token function">mihomeTo</span><span class="token punctuation">(</span>mihomePair<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>                            <span class="token punctuation">.</span><span class="token function">mihomeFromName</span><span class="token punctuation">(</span>mihomeNamepair<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>                            <span class="token punctuation">.</span><span class="token function">mihomeToName</span><span class="token punctuation">(</span>mihomeNamepair<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>                            <span class="token punctuation">.</span><span class="token function">numFrom</span><span class="token punctuation">(</span>preNum<span class="token punctuation">)</span>                            <span class="token punctuation">.</span><span class="token function">numTo</span><span class="token punctuation">(</span>newNum<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                err<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>currentCellInfo <span class="token operator">+</span> <span class="token string">"æ•°æ®æœ‰è¯¯ï¼Œè¯·æ£€æŸ¥ã€‚\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> result<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>â€ƒâ€ƒ<code>getUpdates</code>éƒ¨åˆ†çš„ä»£ç ä¸€å¼€å§‹å…¶å®æ˜¯å‡†å¤‡æŠŠéªŒè¯å’Œè¯»æ•°åˆ†å¼€åšçš„~å…ˆéªŒè¯æ ¼å¼æ­£ç¡®æ€§ï¼Œå–å‡ºå…¥å‚çš„å­é›†æ•°æ®<code>int[][]</code>ï¼Œå†è¿›è¡Œæ–°å»º/æ›´æ–°åˆ¤æ–­ï¼Œä½†æ˜¯åšçš„è¿‡ç¨‹ä¸­å‘ç°æ²¡æœ‰å¿…è¦ï¼Œå·²ç»éå†åˆ°å…·ä½“çš„æ•°å€¼äº†ï¼Œå¯¹åº”çš„åŸå§‹æ•°å€¼ä¹Ÿæ­£å¥½èƒ½è¯»åˆ°ï¼ˆå·²æœ‰æ•°æ®çš„æ•°æ®ç»“æ„æ˜¯ç”¨ HashMap å­˜å‚¨çš„ï¼Œç”¨<code>dataRow.get([headerName])</code>å°±å¯ä»¥å¾—åˆ°ï¼‰ï¼Œå°±ç›´æ¥å»ç”Ÿæˆå¯¹åº”çš„å˜æ›´è®°å½•åˆ—è¡¨äº†ã€‚ç”±äºè¿èƒŒäº†ä¸€å¼€å§‹çš„è®¾è®¡æ€è·¯ï¼Œæ‰€ä»¥å¯èƒ½çœ‹èµ·æ¥æœ‰ç‚¹ä¹±ï¼Œå¦‚æœä½ æœ‰æ›´ä¼˜é›…çš„å®ç°æ–¹å¼ä¹Ÿå¯ä»¥è·Ÿæˆ‘äº¤æµä¸‹~</p><h2 id="åç»­è¿­ä»£è®¡åˆ’"><a class="header-anchor" href="#åç»­è¿­ä»£è®¡åˆ’">Â¶</a>åç»­è¿­ä»£è®¡åˆ’</h2><p>â€ƒâ€ƒè¿™é‡Œä½¿ç”¨äº†100è¡Œä¸åˆ°çš„ä»£ç å®ç°äº†å¯¹ä¸Šä¼ æ•°æ®è¡¨æ ¼æ›´æ–°æ•°æ®åº“çš„å…·ä½“æ“ä½œï¼ˆå½“ç„¶è¿˜æœ‰å‰ç½®è¯»å–åŸå§‹æ•°æ®çš„æ­¥éª¤ï¼‰ï¼Œè™½ç„¶ä»£ç ä¸å¤šï¼Œä½†æ˜¯è¿˜æ˜¯æ¯”è¾ƒé”»ç‚¼æ€ç»´èƒ½åŠ›ï¼Œæˆ‘ç¬¬äºŒæ¬¡å¼€å‘æ‰ç®—æ¯”è¾ƒæ»¡æ„çš„å®ç°äº†é¢„æœŸçš„æ•ˆæœï¼Œåç»­è®¡åˆ’å°†å¯¹ä¸Šæ¬¡æœªå®Œæˆçš„é€šç”¨ç­–ç•¥çš„æ•°æ®å¯¼å…¥è¿›è¡Œå¼€å‘ï¼Œè¿›ä¸€æ­¥æé«˜å¯¹è¿™éƒ¨åˆ†æŠ€æœ¯ç‚¹çš„æŒæ¡ã€‚</p><blockquote><p>å¹³å‡¡çš„ä¸šåŠ¡ä¸­ä¹Ÿæœ‰ä¸å¹³å‡¡çš„é—ªå…‰ç‚¹~</p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> æŠ€æœ¯æ–¹æ¡ˆ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å­¦ä»¥è‡´ç”¨</title>
      <link href="/2020/04/30/%E5%AD%A6%E4%BB%A5%E8%87%B4%E7%94%A8/"/>
      <url>/2020/04/30/%E5%AD%A6%E4%BB%A5%E8%87%B4%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h2 id="åˆ·é¢˜ç»å†"><a class="header-anchor" href="#åˆ·é¢˜ç»å†">Â¶</a>åˆ·é¢˜ç»å†</h2><p>â€ƒâ€ƒæœ€è¿‘ä¸€ç›´åœ¨åˆ· Leetcodeï¼Œåˆšå¥½é‡åˆ°ä¸€ä¸ª <a href="https://leetcode.com/problems/reformat-department-table/">SQL çš„é¢˜</a>æ¶‰åŠåˆ°æ²¡æœ‰å­¦ä¹ è¿‡çš„çŸ¥è¯†ç‚¹ã€‚è¯¥é¢˜æè¿°å¦‚ä¸‹ï¼š</p><blockquote><p>ç»™å®šä¸€ä¸ªæ•°æ®è¡¨ <code>Department</code>ï¼Œæ•°æ®æ ¼å¼å¦‚ä¸‹ï¼š</p></blockquote><table><thead><tr><th>id</th><th>revenue</th><th>month</th></tr></thead><tbody><tr><td>1</td><td>8000</td><td>Jan</td></tr><tr><td>2</td><td>9000</td><td>Jan</td></tr><tr><td>3</td><td>10000</td><td>Feb</td></tr><tr><td>1</td><td>7000</td><td>Feb</td></tr><tr><td>1</td><td>6000</td><td>Mar</td></tr></tbody></table><blockquote><p>è¦æ±‚è¿”å›çš„æ ¼å¼æ˜¯ä¸Šè¿°æ•°æ®çš„æŒ‰ <code>id</code> å’Œ <code>month</code> è¿›è¡Œèšåˆï¼Œä½†æ˜¯åˆ—åŒæ—¶è¿˜æ˜¯æŒ‰æœˆè¿›è¡Œåˆ‡åˆ†çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¡Œæ–¹å‘æ˜¯æ ¹æ® id åŒºåˆ†çš„ï¼Œåˆ—æ–¹å‘æ˜¯æ ¹æ® month åŒºåˆ†çš„ï¼Œå¦‚ä¸‹è¡¨ï¼š</p></blockquote><span id="more"></span><table><thead><tr><th>id</th><th>Jan_Revenue</th><th>Feb_Revenue</th><th>Mar_Revenue</th><th>â€¦</th><th>Dec_Revenue</th></tr></thead><tbody><tr><td>1</td><td>8000</td><td>7000</td><td>6000</td><td>â€¦</td><td>null</td></tr><tr><td>2</td><td>9000</td><td>null</td><td>null</td><td>â€¦</td><td>null</td></tr><tr><td>3</td><td>null</td><td>10000</td><td>null</td><td>â€¦</td><td>null</td></tr></tbody></table><p>â€ƒâ€ƒè¿™ç§ä¸€çœ‹å°±çŸ¥é“ç”¨å¸¸è§„è¯­æ³•å°±æ— æ³•åšåˆ°ï¼Œæ‰€ä»¥å½“æ—¶ç›´æ¥å»æŸ¥äº†ç­”æ¡ˆï¼Œç­”æ¡ˆä¹Ÿå¾ˆç®€å•ï¼š</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span>     id<span class="token punctuation">,</span>    <span class="token function">SUM</span><span class="token punctuation">(</span><span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> <span class="token keyword">month</span><span class="token operator">=</span><span class="token string">'Jan'</span> <span class="token keyword">then</span> revenue <span class="token keyword">else</span> <span class="token boolean">null</span> <span class="token keyword">end</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'Jan_Revenue'</span><span class="token punctuation">,</span>    <span class="token function">SUM</span><span class="token punctuation">(</span><span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> <span class="token keyword">month</span><span class="token operator">=</span><span class="token string">'Feb'</span> <span class="token keyword">then</span> revenue <span class="token keyword">else</span> <span class="token boolean">null</span> <span class="token keyword">end</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'Feb_Revenue'</span><span class="token punctuation">,</span>    <span class="token function">SUM</span><span class="token punctuation">(</span><span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> <span class="token keyword">month</span><span class="token operator">=</span><span class="token string">'Mar'</span> <span class="token keyword">then</span> revenue <span class="token keyword">else</span> <span class="token boolean">null</span> <span class="token keyword">end</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'Mar_Revenue'</span><span class="token punctuation">,</span>    <span class="token function">SUM</span><span class="token punctuation">(</span><span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> <span class="token keyword">month</span><span class="token operator">=</span><span class="token string">'Apr'</span> <span class="token keyword">then</span> revenue <span class="token keyword">else</span> <span class="token boolean">null</span> <span class="token keyword">end</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'Apr_Revenue'</span><span class="token punctuation">,</span>    <span class="token function">SUM</span><span class="token punctuation">(</span><span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> <span class="token keyword">month</span><span class="token operator">=</span><span class="token string">'May'</span> <span class="token keyword">then</span> revenue <span class="token keyword">else</span> <span class="token boolean">null</span> <span class="token keyword">end</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'May_Revenue'</span><span class="token punctuation">,</span>    <span class="token function">SUM</span><span class="token punctuation">(</span><span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> <span class="token keyword">month</span><span class="token operator">=</span><span class="token string">'Jun'</span> <span class="token keyword">then</span> revenue <span class="token keyword">else</span> <span class="token boolean">null</span> <span class="token keyword">end</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'Jun_Revenue'</span><span class="token punctuation">,</span>    <span class="token function">SUM</span><span class="token punctuation">(</span><span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> <span class="token keyword">month</span><span class="token operator">=</span><span class="token string">'Jul'</span> <span class="token keyword">then</span> revenue <span class="token keyword">else</span> <span class="token boolean">null</span> <span class="token keyword">end</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'Jul_Revenue'</span><span class="token punctuation">,</span>    <span class="token function">SUM</span><span class="token punctuation">(</span><span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> <span class="token keyword">month</span><span class="token operator">=</span><span class="token string">'Aug'</span> <span class="token keyword">then</span> revenue <span class="token keyword">else</span> <span class="token boolean">null</span> <span class="token keyword">end</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'Aug_Revenue'</span><span class="token punctuation">,</span>    <span class="token function">SUM</span><span class="token punctuation">(</span><span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> <span class="token keyword">month</span><span class="token operator">=</span><span class="token string">'Sep'</span> <span class="token keyword">then</span> revenue <span class="token keyword">else</span> <span class="token boolean">null</span> <span class="token keyword">end</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'Sep_Revenue'</span><span class="token punctuation">,</span>    <span class="token function">SUM</span><span class="token punctuation">(</span><span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> <span class="token keyword">month</span><span class="token operator">=</span><span class="token string">'Oct'</span> <span class="token keyword">then</span> revenue <span class="token keyword">else</span> <span class="token boolean">null</span> <span class="token keyword">end</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'Oct_Revenue'</span><span class="token punctuation">,</span>    <span class="token function">SUM</span><span class="token punctuation">(</span><span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> <span class="token keyword">month</span><span class="token operator">=</span><span class="token string">'Nov'</span> <span class="token keyword">then</span> revenue <span class="token keyword">else</span> <span class="token boolean">null</span> <span class="token keyword">end</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'Nov_Revenue'</span><span class="token punctuation">,</span>    <span class="token function">SUM</span><span class="token punctuation">(</span><span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> <span class="token keyword">month</span><span class="token operator">=</span><span class="token string">'Dec'</span> <span class="token keyword">then</span> revenue <span class="token keyword">else</span> <span class="token boolean">null</span> <span class="token keyword">end</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'Dec_Revenue'</span><span class="token keyword">from</span> Department<span class="token keyword">group</span> <span class="token keyword">by</span> id<span class="token keyword">order</span> <span class="token keyword">by</span> id<span class="token punctuation">;</span></code></pre><p>â€ƒâ€ƒå…¶ä¸­é‡ç‚¹éƒ¨åˆ†å°±æ˜¯ <code>SUM(CASE WHEN XX THEN XX else XX END)</code>ï¼Œå…¶ä¸­çš„ <code>WHEN</code> å’Œ <code>THEN</code> æ—¢å¯ä»¥æ˜¯å­—æ®µä¹Ÿå¯ä»¥æ˜¯å‡½æ•°ä¹Ÿå¯ä»¥æ˜¯ç®€å•çš„å€¼ï¼Œå¾ˆç®€å•ï¼Œè¯­æ³•å°±èƒ½çœ‹æ‡‚åœ¨åšä»€ä¹ˆï¼Œä¸å¤šè§£é‡Šäº†ã€‚</p><h2 id="åšå®Œæ€è€ƒ"><a class="header-anchor" href="#åšå®Œæ€è€ƒ">Â¶</a>åšå®Œæ€è€ƒ</h2><p>â€ƒâ€ƒç”±äºé¢˜ç›®çš„è§£æ³•æ˜¯ç½‘ä¸Šç›´æ¥æœçš„ç­”æ¡ˆï¼Œå½“æ—¶å°±åœ¨æƒ³ï¼ŒSQL é¢˜ç›®çš„è€ƒå¯Ÿç‚¹éƒ½æ˜¯åå‘æ²¡è§è¿‡çš„è¯­æ³•ï¼Œéƒ½åªèƒ½ç›´æ¥æŸ¥ç»“æœï¼Œå¾—ä¸åˆ°ç»ƒä¹ æ€ç»´çš„æ•ˆæœäº†ï¼Œä¸€åº¦æƒ³è¦æŠŠ SQL é¢˜è¿‡æ»¤æ‰ã€‚æœ€åè¿˜æ˜¯å†³å®šç•™ä¸‹ï¼Œæ¯æ¬¡é‡åˆ° SQL é¢˜å°±ç›´æ¥æœç»“æœå­¦ä¹ ä¸‹ï¼Œå¹¶ä¸”å¤šåšä¸€é“ç¨‹åºé¢˜æ¥å¼¥è¡¥ã€‚æŠŠ SQL çš„é¢˜å½“åšå­¦ä¹ ã€‚</p><h2 id="ğŸ¤Ÿ-ğŸ‘‰-ğŸ-ğŸ«"><a class="header-anchor" href="#ğŸ¤Ÿ-ğŸ‘‰-ğŸ-ğŸ«">Â¶</a>ğŸ¤Ÿ ğŸ‘‰ ğŸ ğŸ«</h2><p>â€ƒâ€ƒæ­£å¦‚ã€Šé˜¿ç”˜æ­£ä¼ ã€‹é‡Œè¯´çš„é‚£æ ·ï¼šâ€Life is like a box of chocolate, you never konw what youâ€™ll gonna getâ€œã€‚æˆ‘ä¹Ÿæ²¡æƒ³åˆ°è¿™ç§ä¸å¸¸ç”¨çš„ SQL è¿˜ä¼šæœ‰æ’ä¸Šç”¨åœºçš„æ—¶å€™ã€‚<br>â€ƒâ€ƒåœºæ™¯æ˜¯è¿™æ ·çš„ï¼šç°åœ¨æä¾›ä¸€ä¸ªæ¥å£ï¼Œå®ç°çš„æ˜¯è‡ªåŠ¨ç”Ÿæˆè°ƒæ‹¨æ–¹æ¡ˆï¼Œå­˜åœ¨è¡¨ä¸­çš„ç»“æ„æ˜¯ç”±æ–¹æ¡ˆIDã€å•†å“IDã€å‘è´§ä»“åº“ã€æ”¶è´§ä»“åº“å››ä¸ªå­—æ®µå”¯ä¸€ç¡®å®šçš„ä¸€æ¡è®°å½•ï¼Œå­—æ®µè¿˜åŒ…æ‹¬å½“å‰å•†å“çš„åç§°ã€å½“å‰å•†å“çš„è°ƒæ‹¨æ•°é‡ç­‰ä¿¡æ¯ã€‚å¦‚ä¸‹è¡¨ï¼š</p><table><thead><tr><th>id</th><th>plan_id</th><th>goods_id</th><th>goods_name</th><th>from</th><th>to</th><th>number</th></tr></thead><tbody><tr><td>1</td><td>31029</td><td>A123</td><td>å°ç±³10 Pro</td><td>31024</td><td>31028</td><td>20</td></tr></tbody></table><p>â€ƒâ€ƒä¸Šè¿°çš„ä¸€æ¡è®°å½•è¡¨ç¤ºçš„æ˜¯ï¼šåˆ›å»ºçš„è‡ªåŠ¨è°ƒæ‹¨æ–¹æ¡ˆ 31029 ä¸­æœ‰ä¸€æ¡è°ƒæ‹¨è®°å½•ï¼Œéœ€è¦å°† 20 åªå°ç±³ 10 Proæ‰‹æœº(ID: A123)ä» 31024 ä»“åº“è°ƒæ‹¨åˆ° 31028 ä»“åº“ã€‚<br>â€ƒâ€ƒç°åœ¨éœ€è¦æä¾›ä¸€ä¸ªç•Œé¢ï¼Œä¾›ç”¨æˆ·æŸ¥è¯¢ä¸€ä¸ªè°ƒæ‹¨æ–¹æ¡ˆçš„è¯¦è¡¨ï¼Œå…¶ä¸­æ¯ä¸€è¡Œä»£è¡¨äº†ä¸€ç§å•†å“ï¼Œä¸€åˆ—æ•°æ®ä»£è¡¨äº†ä¸€ä¸ª[å‘è´§ä»“]-[æ”¶è´§ä»“]çš„å¯¹åº”å…³ç³»ï¼Œå¦‚æœè¯¥å•†å“åœ¨è¿™ä¸ªè°ƒæ‹¨å…³ç³»ä¸Šæ²¡æœ‰æ•°æ®åˆ™ç•™ç©ºã€‚æœ€ç»ˆæ•ˆæœå¦‚ä¸‹å›¾ï¼ˆæ¥è‡ªäºç³»ç»ŸåŸå‹å›¾ï¼‰ï¼š<br><img onerror="imgOnError(this);" data-fancybox="gallery" src="/images/%E6%99%BA%E8%83%BD%E8%B0%83%E6%8B%A8%E6%95%88%E6%9E%9C%E5%9B%BE.png" alt="æ™ºèƒ½è°ƒæ‹¨æ•ˆæœ" data-caption="æ™ºèƒ½è°ƒæ‹¨æ•ˆæœ" loading="lazy"></p><p>â€ƒâ€ƒä¸€å¼€å§‹è€ƒè™‘çš„æŠ€æœ¯æ–¹æ¡ˆæ˜¯ï¼Œå°†è¡¨ä¸­å¯¹åº”çš„æ‰€æœ‰æ•°æ®é¡¹éƒ½æŸ¥è¯¢å‡ºæ¥ï¼Œç„¶åé€šè¿‡ç¨‹åºå»åšæ•°æ®çš„èšåˆï¼Œæ•´ç†å‡ºæ¥çš„æ€è·¯å¦‚ä¸‹ï¼š</p><pre><code>æ˜¾ç¤ºè°ƒæ‹¨æ–¹æ¡ˆè¯¦æƒ…ï¼š- æŸ¥è¯¢å¾—åˆ°List&lt;Item&gt;     items- æ‰€æœ‰çš„ MihomeFrom-MihomeTo pair åšæˆ HashSet- ç”Ÿæˆ Headers- Sku è¿‡æ»¤æˆ HashSet sku- foreach sku in skus- - foreach item in items.filter(sku)- - data.add(item.mihomeFrom-item.mihomeTo, item.number)å¯¼å‡ºæŠ¥è¡¨ï¼šä½¿ç”¨æ˜¾ç¤ºè¯¦æƒ…çš„æ¥å£ï¼Œå¹¶å°† header+data çš„ç»“æœè½¬æ¢æˆ csv- headerè½¬æ¢æˆ ArrayList- data ä¹Ÿè½¬æ¢æˆåŒå¤§å°çš„ ArrayListï¼Œå¹¶ search åˆ°å¯¹åº”çš„å€¼</code></pre><p>â€ƒâ€ƒåæ¥å›å¿†èµ·åšè¿‡çš„åšè¿‡çš„ LeetCode é¢˜ç›®ï¼Œå¯ä»¥çœ‹å‡ºï¼Œä¸Šè¡¨ä¸­çš„æ¯ä¸€è¡Œè®°å½•å¯¹åº”äº†åŸå‹å›¾ä¸­çš„è¡¨æ ¼çš„æ¯ä¸€ä¸ªæ ¼ç‚¹ï¼Œè¿™ä¸ªä¸šåŠ¡åœºæ™¯å°±å®Œç¾å¥‘åˆäº†ä¸Šé¢é¢˜ç›®çš„è€ƒå¯Ÿç‚¹ï¼šå¯¹åŸå§‹è¡¨ä¸­çš„æ•°æ®è¿›è¡Œç‰¹å®šæƒ…å†µçš„èšåˆï¼Œç”Ÿæˆæ–°çš„æ•°æ®åˆ—ã€‚ä¸åŒçš„åœ°æ–¹åœ¨äºï¼Œä¾‹é¢˜ä¸­çš„æ•°æ®åˆ—æ˜¯ç»™å®šçš„12ä¸ªæœˆï¼Œè€Œå½“å‰çš„ä¸šåŠ¡éœ€è¦æ ¹æ®æ•°æ®çš„ç‰¹ç‚¹åŠ¨æ€ç”Ÿæˆã€‚è¿™ä¸€éš¾ç‚¹åœ¨Mybatisä¸­ä¹Ÿæ¯”è¾ƒå¥½è§£å†³ï¼šMapper.xml ä½œä¸ºDALå±‚è®¿é—®æ•°æ®åº“çš„ä»£ç†ï¼Œæ—¢å¯ä»¥ä¼ å…¥å‚æ•°ï¼Œä¹Ÿæ”¯æŒä¸€äº›ç®€å•çš„é€»è¾‘æ“ä½œæŒ‡ä»¤ï¼Œæ¯”å¦‚forå¾ªç¯æ’å…¥<code>SUM</code>å‡½æ•°å°±å¯ä»¥å®ç°ç”ŸæˆåŠ¨æ€åˆ—çš„æ•ˆæœã€‚</p><h2 id="è§£å†³æ–¹æ¡ˆ"><a class="header-anchor" href="#è§£å†³æ–¹æ¡ˆ">Â¶</a>è§£å†³æ–¹æ¡ˆ</h2><h3 id="1-æŸ¥è¯¢å‡ºæ‰€éœ€çš„æ‰€æœ‰åŠ¨æ€åˆ—æ•°æ®"><a class="header-anchor" href="#1-æŸ¥è¯¢å‡ºæ‰€éœ€çš„æ‰€æœ‰åŠ¨æ€åˆ—æ•°æ®">Â¶</a>1. æŸ¥è¯¢å‡ºæ‰€éœ€çš„æ‰€æœ‰åŠ¨æ€åˆ—æ•°æ®</h3><p>SQLï¼š</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> mihome_from<span class="token punctuation">,</span> mihome_to <span class="token keyword">from</span> plan_test <span class="token keyword">as</span> l <span class="token keyword">where</span> l<span class="token punctuation">.</span>plan_id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></code></pre><p>ç»“æœé›†ï¼š</p><table><thead><tr><th>mihome_from</th><th>mihome_to</th></tr></thead><tbody><tr><td>1</td><td>10</td></tr><tr><td>1</td><td>12</td></tr><tr><td>2</td><td>10</td></tr><tr><td>3</td><td>14</td></tr></tbody></table><p>â€ƒâ€ƒå°†ä¸Šè¿°ç»“æœç”¨ä¸€ä¸ªæ•°æ®ç»“æ„ List&lt;MihomePair&gt; ä¿å­˜èµ·æ¥ï¼Œåœ¨ä¸‹ä¸€æ­¥ä¸­ä½¿ç”¨ã€‚</p><h3 id="2-åŠ¨æ€æ„å»º-SQL"><a class="header-anchor" href="#2-åŠ¨æ€æ„å»º-SQL">Â¶</a>2. åŠ¨æ€æ„å»º SQL</h3><p>mapper.xml:</p><pre class="language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>selectDetailTable<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>java.util.HashMap<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>select sku, goods_id,goods_name,   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>foreach</span> <span class="token attr-name">collection</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mihomePair<span class="token punctuation">"</span></span> <span class="token attr-name">index</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>index<span class="token punctuation">"</span></span> <span class="token attr-name">item</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>pair<span class="token punctuation">"</span></span> <span class="token attr-name">separator</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>,<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  SUM(CASE WHEN mihome_from=#&#123;pair.from&#125; and mihome_to = #&#123;pair_to&#125; then number else null end) as '#&#123;pair.from&#125;-#&#123;pair_to&#125;'  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>foreach</span><span class="token punctuation">></span></span>from plan_test where plan_id = 1 group by sku,goods_id, goods_name<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span></code></pre><p>SQL æ‰§è¡Œç»“æœï¼š<br><img onerror="imgOnError(this);" data-fancybox="gallery" src="/images/%E6%99%BA%E8%83%BD%E8%B0%83%E6%8B%A8%E5%8A%A8%E6%80%81SQL.png" alt="æ™ºèƒ½è°ƒæ‹¨åŠ¨æ€SQL" data-caption="æ™ºèƒ½è°ƒæ‹¨åŠ¨æ€SQL" loading="lazy"></p><h3 id="è¾“å‡ºç»“æœ"><a class="header-anchor" href="#è¾“å‡ºç»“æœ">Â¶</a>è¾“å‡ºç»“æœ</h3><p>â€ƒâ€ƒç»“æœé›†<code>HashMap</code>ä¸­çš„<code>KeySet</code>è‡ªèº«å¯ä»¥ä½œä¸ºè¡¨å¤´ï¼Œç¨è½¬æ¢ä¸‹å³å¯è¿”å›ï¼Œæ•°æ®é¡¹éƒ½ç¬¦åˆå‰ç«¯éœ€è¦çš„æ ¼å¼ï¼Œä¹Ÿå¯ä»¥ç›´æ¥è¿”å›ã€‚</p><p>â€ƒâ€ƒè¯¥ç»“æœå¯ä»¥è¿›ä¸€æ­¥è½¬æ¢æˆ SKU ä½œä¸ºé”®çš„ Listï¼Œä¾›ç”¨æˆ·çš„æ›´æ–°æ“ä½œæ–¹ä¾¿æ“ä½œåŸå§‹æ•°æ®ã€‚ä¹Ÿå¯ä»¥å°† KeySet è½¬æ¢ä¸º Listï¼Œæ•°æ®åˆ—ä» Map è½¬æ¢æˆæ•°ç»„ï¼Œæ–¹ä¾¿å¯¼å‡º CSV æ ¼å¼çš„æ–‡ä»¶ã€‚</p><h2 id="é¡¹ç›®å®è·µ"><a class="header-anchor" href="#é¡¹ç›®å®è·µ">Â¶</a>é¡¹ç›®å®è·µ</h2><p>â€ƒâ€ƒåœ¨æ™ºèƒ½è°ƒæ‹¨é¡¹ç›®ä¸­å°†è¿™ä¸ªæŠ€æœ¯ç‚¹åº”ç”¨åˆ°å®è·µä¸­ï¼Œæœ€ç»ˆå®ç°çš„æ•ˆæœå¦‚ä¸‹ï¼š</p><p>** è¯·æ±‚å“åº” json **<br><img onerror="imgOnError(this);" data-fancybox="gallery" src="/images/json.png" alt="å“åº”" data-caption="å“åº”" loading="lazy"></p><p>** ç”¨æˆ·ç•Œé¢ **</p><p><img onerror="imgOnError(this);" data-fancybox="gallery" src="/images/%E7%95%8C%E9%9D%A2.png" alt="ç•Œé¢" data-caption="ç•Œé¢" loading="lazy"></p><h2 id="æ€è€ƒ"><a class="header-anchor" href="#æ€è€ƒ">Â¶</a>æ€è€ƒ</h2><p>â€ƒâ€ƒè¿™ä¸ªé—®é¢˜çœ‹ä¼¼ç®€å•ï¼Œä½†æ˜¯å¯ä»¥åæ˜ å‡ºä¸€äº›æœ‰æ„æ€çš„è§‚ç‚¹ï¼šâ€ä¸–ç•Œä¸Šæ²¡æœ‰é”™è¯¯çš„é“è·¯ï¼Œä»–ä»¬æœ€ç»ˆéƒ½èµ°å‘æ­£ç¡®â€œã€‚ä¸è¦æ”¾å¼ƒå¹³æ—¶çš„ç§¯ç´¯ï¼Œä¹Ÿè®¸ä»–ä»¬ä¼šåœ¨æ„æƒ³ä¸åˆ°çš„æ—¶å€™ç»™ä½ ä¸€ä¸ªbonus~</p>]]></content>
      
      
      
        <tags>
            
            <tag> leetcode </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆ›å»ºhexoè„šæœ¬</title>
      <link href="/2020/01/06/%E5%88%9B%E5%BB%BAhexo%E8%84%9A%E6%9C%AC/"/>
      <url>/2020/01/06/%E5%88%9B%E5%BB%BAhexo%E8%84%9A%E6%9C%AC/</url>
      
        <content type="html"><![CDATA[<h1>èµ·å› </h1><p>æœ¬äººåˆ›å»º<code>Hexo</code>è„šæœ¬çš„ç—›ç‚¹ä¸»è¦æ˜¯2ç‚¹ï¼š</p><ol><li>æˆ‘ç”¨ vs code çš„ç»ˆç«¯è¿è¡Œ hexo å‘½ä»¤å’Œç®¡ç†èµ„æºæ–‡ä»¶ï¼Œç”¨ Typora æ’°å†™æ–‡ç« ï¼Œå› æ­¤æ¯æ¬¡ä¸ç®¡æ˜¯æ–°å»ºæ–‡ç« è¿˜æ˜¯é¢„è§ˆè¿˜æ˜¯å‘å¸ƒéƒ½éœ€è¦æ¥å›åˆ‡æ¢ï¼Œæ­¥éª¤è¾ƒå¤šæŒºéº»çƒ¦çš„ã€‚</li><li>åšå®¢æºç çš„ç‰ˆæœ¬ç®¡ç†ã€‚ä¹‹å‰å†™è¿‡å¥½å‡ ç¯‡åšæ–‡ï¼Œå¯æ˜¯åœ¨ä¸€æ¬¡è£…æœºçš„è¿‡ç¨‹ä¸­å¿˜è®°è¿ç§»ï¼Œç»“æœä¸¢å¤±äº†åŸå§‹markdownçš„æ–‡ç« å’Œé…ç½®æ–‡ä»¶ï¼Œå¯¼è‡´æ— æ³•ç»§ç»­å†™ä¸‹å»äº†ï¼Œåªå¾—é‡å¤´å¼€å§‹!<code>QAQ</code></li></ol><span id="more"></span><h1>è„šæœ¬</h1><p>åŸºäºä»¥ä¸Š2ä¸ªåŸå› ï¼Œè¿™é‡Œæˆ‘åˆ›å»ºäº†3ä¸ªç›¸å…³çš„è„šæœ¬ï¼Œè¿˜æœ‰ä¸€ä¸ªéº»çƒ¦ä¸€ç‚¹æ­£åœ¨å®ç°ä¸­~</p><h2 id="1-æ–°å»ºæ–‡ç« "><a class="header-anchor" href="#1-æ–°å»ºæ–‡ç« ">Â¶</a>1. æ–°å»ºæ–‡ç« </h2><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> ~/repos/blog-srchexo new <span class="token string">"&#123;query&#125;"</span><span class="token function">open</span> source/_posts/<span class="token punctuation">&#123;</span>query<span class="token punctuation">&#125;</span>.md</code></pre><p>æ ¸å¿ƒæ˜¯<code>hexo new xx</code>å‘½ä»¤ï¼Œåˆ›å»ºäº†æ–°mdæ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨openå‘½ä»¤ä½¿ç”¨é»˜è®¤æ–¹å¼ï¼ˆæˆ‘è®¾ç½®çš„æ˜¯Typoraï¼‰æ‰“å¼€è¯¥æ–‡ä»¶å¼€å§‹å†™æ–‡ç« ã€‚</p><h2 id="2-æœ¬åœ°è¿è¡Œåšå®¢"><a class="header-anchor" href="#2-æœ¬åœ°è¿è¡Œåšå®¢">Â¶</a>2. æœ¬åœ°è¿è¡Œåšå®¢</h2><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> ~/repos/blog-srchexo cleanhexo generatehexo server -p <span class="token punctuation">&#123;</span>query<span class="token punctuation">&#125;</span><span class="token function">open</span> https://localhost:<span class="token punctuation">&#123;</span>query<span class="token punctuation">&#125;</span></code></pre><p>æœ‰ç‚¹åƒgitçš„æäº¤å’Œæœ¬åœ°è¿è¡Œï¼Œå°±æ˜¯ç”¨hexoçš„serveræœ¬åœ°è¿è¡Œå‘½ä»¤,è¿è¡Œå¯åŠ¨åéœ€è¦æ‰“å¼€æµè§ˆå™¨è®¿é—®æœ¬åœ°åœ°å€ã€‚ç”±äºhexo serveræŠŠå½“å‰çš„ç»ˆç«¯æŒ‚èµ·äº†ï¼Œå› æ­¤éœ€è¦å°†è®¿é—®é¡µé¢çš„å‘½ä»¤æ¢ä¸ªåœ°æ–¹å¯åŠ¨ï¼Œè¿™é‡Œç›´æ¥æŠŠå¯åŠ¨Chromeï¼Œè®¿é—®localhost:{query}çš„æ“ä½œæ”¾åœ¨è¾“å…¥ä¹‹åï¼Œè™½ç„¶ä¼šæš‚æ—¶æ˜¾ç¤ºæ— æ³•è®¿é—®ï¼Œä½†æ˜¯ç”±äºChromeå¼€å¯äº†è‡ªåŠ¨é‡è½½ç‰¹æ€§ï¼Œæ‰€ä»¥èµ·èµ·æ¥åè¿˜æ˜¯èƒ½æ˜¾ç¤ºåšå®¢ï¼Œå°±æš‚å…ˆè¿™ä¹ˆå®ç°äº†ã€‚</p><h2 id="3-å‘å¸ƒåšå®¢"><a class="header-anchor" href="#3-å‘å¸ƒåšå®¢">Â¶</a>3. å‘å¸ƒåšå®¢</h2><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> ~/repos/blog-src<span class="token function">git</span> <span class="token function">add</span> <span class="token builtin class-name">.</span><span class="token function">git</span> commit -m <span class="token string">"update"</span><span class="token function">git</span> pushhexo ghexo d</code></pre><p>å‘å¸ƒåšå®¢éœ€è¦å…ˆæŠŠé¡¹ç›®çš„æºç æ¨åˆ° github ä¸Šå†æ‰§è¡Œéƒ¨ç½²ï¼Œä¿è¯äº†æºç å’Œåšå®¢éƒ½å¾—åˆ°åŒæ­¥ã€‚</p><h2 id="4-ç¼–è¾‘åšå®¢"><a class="header-anchor" href="#4-ç¼–è¾‘åšå®¢">Â¶</a>4. ç¼–è¾‘åšå®¢</h2><p>åœ¨å®Œæˆä¸Šè¿°å‡ ä¸ªè„šæœ¬åè¿›ä¸€æ­¥ï¼Œéœ€è¦å®ç°ä¸€ä¸ªå¯¹å½“å‰å·²æœ‰åšæ–‡çš„ç¼–è¾‘åŠŸèƒ½ï¼Œç›®æ ‡æ˜¯å®ç°åˆ—å‡ºå½“å‰æ‰€æœ‰åšæ–‡å¹¶é€‰æ‹©å…¶ä¸­ä¸€ä¸ªæ‰“å¼€ç¼–è¾‘ã€‚<br>å‚è€ƒäº†ä¸€äº›åˆ«äººå†™çš„ python çš„ workflowï¼Œå®ç°äº†ç®€å•çš„è·å–æ‰€æœ‰åšæ–‡å¹¶åˆ—å‡ºçš„åŠŸèƒ½ï¼š</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> os <span class="token keyword">import</span> listdir<span class="token keyword">from</span> os<span class="token punctuation">.</span>path <span class="token keyword">import</span> isfile<span class="token punctuation">,</span> join<span class="token keyword">import</span> sys<span class="token keyword">from</span> workflow <span class="token keyword">import</span> Workflow3<span class="token punctuation">,</span> ICON_INFO<span class="token builtin">reload</span><span class="token punctuation">(</span>sys<span class="token punctuation">)</span>sys<span class="token punctuation">.</span>setdefaultencoding<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>log <span class="token operator">=</span> <span class="token boolean">None</span>mypath <span class="token operator">=</span> <span class="token string">'/Users/haoxingxiao/repos/blog-src/source/_posts'</span><span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span>wf<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># åˆ—å‡ºæ‰€æœ‰ markdown æ–‡ä»¶</span>    md_files <span class="token operator">=</span> <span class="token punctuation">[</span>f <span class="token keyword">for</span> f <span class="token keyword">in</span> listdir<span class="token punctuation">(</span>mypath<span class="token punctuation">)</span> <span class="token keyword">if</span> isfile<span class="token punctuation">(</span>join<span class="token punctuation">(</span>mypath<span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">and</span> f<span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">'.md'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>    <span class="token comment"># å±•ç¤ºåœ¨ workflow çš„ä¸‹æ‹‰åˆ—è¡¨ä¸­ï¼Œarg è¡¨ç¤ºè¾“å‡ºç»™åç»­æµç¨‹çš„å‚æ•°å­—ç¬¦ä¸²</span>    <span class="token keyword">for</span> <span class="token builtin">file</span> <span class="token keyword">in</span> md_files <span class="token punctuation">:</span>        wf<span class="token punctuation">.</span>add_item<span class="token punctuation">(</span>            <span class="token builtin">file</span><span class="token punctuation">,</span>            mypath<span class="token operator">+</span> <span class="token string">'/'</span> <span class="token operator">+</span><span class="token builtin">file</span><span class="token punctuation">,</span>            valid<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>            icon<span class="token operator">=</span>ICON_INFO<span class="token punctuation">,</span>            arg<span class="token operator">=</span>mypath<span class="token operator">+</span> <span class="token string">'/'</span> <span class="token operator">+</span> <span class="token builtin">file</span>        <span class="token punctuation">)</span>    wf<span class="token punctuation">.</span>send_feedback<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">u"__main__"</span><span class="token punctuation">:</span>    wf <span class="token operator">=</span> Workflow3<span class="token punctuation">(</span><span class="token punctuation">)</span>    log <span class="token operator">=</span> wf<span class="token punctuation">.</span>logger    sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span>wf<span class="token punctuation">.</span>run<span class="token punctuation">(</span>main<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>åç»­å†è¿½åŠ ä¸Šä¸€ä¸ª <code>Run Script</code>æŠŠ{query}ä¼ é€’è¿›å»æ‰“å¼€è¯¥æ–‡ä»¶å³å¯ã€‚</p><p>æ•ˆæœï¼š</p><p><img onerror="imgOnError(this);" data-fancybox="gallery" src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gih01zia3qj30w20mkax9.jpg" alt="blog-edit å®ç°æ•ˆæœ" data-caption="blog-edit å®ç°æ•ˆæœ" loading="lazy"></p><h2 id="base64-ç¼–ç è§£ç "><a class="header-anchor" href="#base64-ç¼–ç è§£ç ">Â¶</a>base64 ç¼–ç è§£ç </h2><p>å®Œæˆä¸Šè¿°çš„å‡ ä¸ª workflow åï¼Œç»§ç»­ä¸€é¼“ä½œæ°”å®Œæˆäº† base64  ç¼–ç è§£ç çš„ workflowã€‚è¿˜å¢åŠ äº†æ–°çš„ç‰¹æ€§ï¼šfilterï¼Œé€šè¿‡ Notification æç¤ºç”¨æˆ·è½¬æ¢æˆåŠŸè¿˜æ˜¯å¤±è´¥ã€‚<br>è¿˜æ˜¯ç”¨ python çš„åº“æ‰§è¡Œæ ¸å¿ƒçš„è½¬æ¢ï¼š</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> sys<span class="token keyword">import</span> base64query <span class="token operator">=</span> <span class="token string">"&#123;query&#125;"</span>sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>write<span class="token punctuation">(</span>base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>ä»£ç å¾ˆç®€å•ï¼Œè¿™éƒ¨åˆ†æµç¨‹æ§åˆ¶æ›´é‡è¦ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p>workflow æµç¨‹å›¾ï¼š</p><p><img onerror="imgOnError(this);" data-fancybox="gallery" src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gih1cgizuhj31830u0all.jpg" alt="base64è§£ç " data-caption="base64è§£ç " loading="lazy"></p><p>åœ¨æ‰§è¡Œå®Œç¼–ç å’Œè§£ç åï¼Œæ ¹æ®å†…å®¹æ˜¯å¦ä¸ºç©ºåˆ¤æ–­æ˜¯å¦æˆåŠŸï¼Œå¹¶ä½¿ç”¨ Notification æç¤ºç”¨æˆ·ç»“æœ~æˆåŠŸäº†è¿˜ä¼šè‡ªåŠ¨å¤åˆ¶åˆ°å‰ªè´´æ¿ä¸­ã€‚</p><h2 id="æ€»ç»“"><a class="header-anchor" href="#æ€»ç»“">Â¶</a>æ€»ç»“</h2><p>ä½¿ç”¨ alfred å®ç°äº†åšå®¢æ–‡ç« çš„æ–°å¢ã€ç¼–è¾‘ã€æœ¬åœ°è¿è¡Œå’Œå‘å¸ƒå‡ ä¸ªå¸¸ç”¨åŠŸèƒ½ï¼Œå¯¹è‡ªå·±æ—¥å¸¸ä½¿ç”¨ä¹Ÿéå¸¸æœ‰æ„ä¹‰ï¼Œè€Œä¸”å¯¹ç†Ÿæ‚‰ workflow åº“çš„è¯­æ³•ä¹Ÿæœ‰å¸®åŠ©ï¼Œåç»­å¯ä»¥è¿›ä¸€æ­¥è€ƒè™‘æŠŠå¸¸ç”¨çš„ä¸€äº›å·¥ä½œæµä¼˜åŒ–åˆ° workflow~</p><p>e.p.:</p><ol><li>base64 çš„è½¬æ¢(Done)</li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> hexo </tag>
            
            <tag> productivity </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è§„åˆ™é…ç½®å¹³å°</title>
      <link href="/2020/01/05/%E8%A7%84%E5%88%99%E9%85%8D%E7%BD%AE%E5%B9%B3%E5%8F%B0/"/>
      <url>/2020/01/05/%E8%A7%84%E5%88%99%E9%85%8D%E7%BD%AE%E5%B9%B3%E5%8F%B0/</url>
      
        <content type="html"><![CDATA[<h3 id="1-ä¸šåŠ¡èƒŒæ™¯"><a class="header-anchor" href="#1-ä¸šåŠ¡èƒŒæ™¯">Â¶</a>1 ä¸šåŠ¡èƒŒæ™¯</h3><h4 id="1-1-æ˜¯ä»€ä¹ˆæ ·çš„ä¸šåŠ¡åœºæ™¯"><a class="header-anchor" href="#1-1-æ˜¯ä»€ä¹ˆæ ·çš„ä¸šåŠ¡åœºæ™¯">Â¶</a>1.1 æ˜¯ä»€ä¹ˆæ ·çš„ä¸šåŠ¡åœºæ™¯</h4><p>å½“å‰ä¸šåŠ¡åœºæ™¯ä¸­å­˜åœ¨è¿™æ ·çš„ä¸€ç§è¾ƒä¸ºç‰¹æ®Šçš„éœ€æ±‚ï¼šè®¢å•æµçš„å¤„ç†è¿‡ç¨‹ä¸­ï¼ŒåŒ…æ‹¬äº†ä¸€äº›å†³ç­–çš„èŠ‚ç‚¹ã€‚å¦‚ï¼šæ‹†å•ã€åˆå•ã€åˆ†å¿«é€’ç­‰ã€‚è¿™äº›åœºæ™¯å­˜åœ¨å…±åŒç‚¹ï¼š</p><ol><li><p>è§„åˆ™æ•°é‡ç›¸å¯¹å¤šï¼Œç”¨å•çº¯çš„åˆ†æ”¯ä»£ç é€»è¾‘å®ç°èµ·æ¥éº»çƒ¦ä¸”ä¸ä¼˜é›…</p></li><li><p>è§„åˆ™éšæ—¶å¯èƒ½ä¼šè°ƒæ•´ï¼Œå¦‚æœç”¨ç¡¬ç¼–ç å®ç°åˆ™è°ƒæ•´å‘¨æœŸé•¿ï¼Œä¸èƒ½æ»¡è¶³ä¸šåŠ¡åœºæ™¯çš„è¦æ±‚ï¼›æ­¤å¤–ï¼Œç¡¬ç¼–ç å¯¼è‡´æ¯æ¬¡è°ƒæ•´éƒ½éœ€è¦å¼€å‘çš„æ”¯æŒï¼ŒåŠ é‡äº†å¼€å‘çš„è´Ÿæ‹…ã€‚</p></li><li><p>è§„åˆ™çš„è¾“å…¥è¾“å‡ºç›¸å¯¹å›ºå®šï¼šè¾“å…¥ä¸€äº›å­—æ®µçš„å€¼ï¼Œè¾“å‡ºä¸€äº›å›ºå®šå€¼çš„ç»“æœã€‚ä¸ç”¨çš„åœºæ™¯é€‚åˆç”¨åŒä¸€å¥—ç³»ç»Ÿå»ç»´æŠ¤ã€‚</p></li></ol><p>æ­¤å‰ PHP ç‰ˆæœ¬çš„ç³»ç»Ÿä¸­å®ç°äº†ä¸€å¥—è¾ƒä¸ºç®€å•çš„è§„åˆ™é…ç½®ç³»ç»Ÿï¼Œä½†æ˜¯å…¶ä¸ç®¡æ˜¯è¾“å…¥è¿˜æ˜¯è¾“å‡ºï¼Œéƒ½æ˜¯ç›´æ¥ä¸¢ç»™ç”¨æˆ·ä¸€ä¸ªè¾“å…¥æ¡†ç›´æ¥è¾“å…¥å…¨æ–‡ï¼Œç”¨æˆ·é¢å¯¹è¿™æ ·çš„ä¸€ä¸ªç©ºç™½é¡µé¢å…¶å®æ ¹æœ¬ä¸çŸ¥é“å¡«å†™ä»€ä¹ˆã€‚<br>å› æ­¤ï¼Œè¿™ç‰ˆçš„ Java æ–°ç³»ç»Ÿéœ€æ±‚æ˜¯éœ€è¦å®ç°ä¸€ä¸ªæ›´æ˜“ç”¨ã€æ‹“å±•æ€§æ›´å¼ºçš„ä¸€ä¸ªè§„åˆ™é…ç½®ä¸­å¿ƒã€‚æš‚æ—¶ç»™çš„åœºæ™¯æ˜¯è§„åˆ™æ•°é‡è¾ƒå°‘çš„åˆå•è§„åˆ™â€”â€”å½“å‰ä»…æœ‰3æ¡æ˜ç¡®çš„åˆå•è§„åˆ™ï¼Œéœ€è¦å…ˆå°†è¿™äº›è§„åˆ™æ­£ç¡®é…ç½®åˆ°ç³»ç»Ÿä¸­ã€‚</p><span id="more"></span><h4 id="1-2-åˆè¯†-Drools"><a class="header-anchor" href="#1-2-åˆè¯†-Drools">Â¶</a>1.2 åˆè¯† Drools</h4><p>æœ¬æ¥è®¡åˆ’è‡ªè¡Œå®ç°ä¸€ä¸ªè¾ƒä¸ºå›ºå®šé€»è¾‘çš„å­—æ®µè¯»å–ã€å­—æ®µå†™å…¥çš„ä¸€å¥—å¯¹è±¡å¤„ç†æµç¨‹ï¼š</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">// precode for params</span><span class="token class-name">RuleResult</span> result <span class="token operator">=</span> <span class="token class-name">RuleParser</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>ruleParams<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// postcode for result</span></code></pre><p>ç°åœ¨æƒ³æƒ³å°±èƒ½å‘ç°è¿™ç§è®¾è®¡æ€è·¯å­˜åœ¨ä¸€äº›æœªè€ƒè™‘åˆ°çš„é—®é¢˜ï¼š</p><ol><li>æ‹“å±•æ€§æå·®ï¼›è¯¥éƒ¨åˆ†çš„é…ç½®å®Œå…¨ä¾èµ–äºå½“æ—¶çš„ä¸šåŠ¡åœºæ™¯çš„éœ€æ±‚ï¼Œå¦‚æœå‡ºç°äº†æ–°çš„éœ€æ±‚ï¼Œå¦‚éœ€è¦è°ƒæ•´åç»­çš„ç¨‹åºç»“æ„ï¼Œåˆ™åªèƒ½é€šè¿‡è°ƒæ•´<code>post</code>ä»£ç å®ç°ï¼Œè™½ç„¶è¿™æ ·ä¹Ÿèƒ½æ»¡è¶³å½“åœºçš„éœ€æ±‚ï¼Œä½†å¯¹äºåç»­æ–°éœ€æ±‚çš„æ”¯æŒèƒ½åŠ›ä¸è¶³ï¼Œç»´æŠ¤èµ·æ¥ä»ç„¶è¾ƒä¸ºåƒåŠ›ã€‚</li><li>è§„åˆ™åŒ¹é…éƒ¨åˆ†çš„ç®—å­è®¾è®¡ï¼›è¯¥éƒ¨åˆ†çš„ä»£ç å¯èƒ½èƒ½å®ç°ï¼Œä½†æ˜¯éœ€è¦è€—è´¹ä¸€å®šæ—¶é—´è®¾è®¡+å®ç°+è°ƒè¯•ã€‚è€Œä¸”è¿™éƒ¨åˆ†çš„å®ç°å®é™…ä¸Šå±äºåº•å±‚æ”¯æŒï¼Œå¼€å‘ç³»ç»Ÿåº”è¯¥ç§‰æŒçš„åŸåˆ™åº”è¯¥æ˜¯ï¼šèƒ½ç”¨ç°æˆçš„å·¥å…·å°±ä¸è¦è‡ªå·±å‘æ˜è½®å­ã€‚å› æ­¤ï¼Œè¿™éƒ¨åˆ†ä»£ç å±å®ä¸å¿…è¦ã€‚</li></ol><p>å¶ç„¶çš„æœºä¼šï¼Œè·Ÿå°çˆ±éƒ¨é—¨çš„å°åº·åŒå­¦èŠäº†èŠï¼Œä»–ç»™æˆ‘è¯´ä»–ä»¬éƒ¨é—¨åˆšå¥½éœ€è¦è°ƒç ”ä¸€ä¸ªå¼€æºå·¥å…·ï¼šDroolsè§„åˆ™å¼•æ“ã€‚ä»è€Œæ‰“å¼€äº†æ–°ä¸–ç•Œçš„å¤§é—¨ã€‚</p><h3 id="2-æŠ€æœ¯åŸç†"><a class="header-anchor" href="#2-æŠ€æœ¯åŸç†">Â¶</a>2 æŠ€æœ¯åŸç†</h3><h4 id="2-1ä»€ä¹ˆæ˜¯è§„åˆ™å¼•æ“"><a class="header-anchor" href="#2-1ä»€ä¹ˆæ˜¯è§„åˆ™å¼•æ“">Â¶</a>2.1ä»€ä¹ˆæ˜¯è§„åˆ™å¼•æ“</h4><p>è§„åˆ™å¼•æ“æ˜¯åŸºäºè§„åˆ™çš„ä¸“å®¶ç³»ç»Ÿçš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œä¸»è¦ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼šè§„åˆ™åº“(Knowledge base)+Working Memory(Fact base)+æ¨ç†æœº(è§„åˆ™å¼•æ“)ï¼Œè§„åˆ™å¼•æ“æ ¹æ®æ—¢å®šäº‹å®å’ŒçŸ¥è¯†åº“æŒ‰ç…§ä¸€å®šçš„ç®—æ³•æ‰§è¡Œæ¨ç†é€»è¾‘å¾—åˆ°æ­£ç¡®çš„ç»“æœã€‚ï¼ˆ<a href="http://www.drools.org.cn/166.html">Droolsä¸­æ–‡ç½‘</a>ï¼‰</p><h4 id="2-2-Drools"><a class="header-anchor" href="#2-2-Drools">Â¶</a>2.2 Drools</h4><p>Drools æ˜¯ä¸€ä¸ªåŸºäºCharles Forgyâ€™sçš„RETEç®—æ³•çš„ï¼Œæ˜“äºè®¿é—®ä¼ä¸šç­–ç•¥ã€æ˜“äºè°ƒæ•´ä»¥åŠæ˜“äºç®¡ç†çš„å¼€æºä¸šåŠ¡è§„åˆ™å¼•æ“ï¼Œç¬¦åˆä¸šå†…æ ‡å‡†ï¼Œé€Ÿåº¦å¿«ã€æ•ˆç‡é«˜ã€‚<br>ä¸šåŠ¡åˆ†æå¸ˆäººå‘˜æˆ–å®¡æ ¸äººå‘˜å¯ä»¥åˆ©ç”¨å®ƒè½»æ¾æŸ¥çœ‹ä¸šåŠ¡è§„åˆ™ï¼Œä»è€Œæ£€éªŒæ˜¯å¦å·²ç¼–ç çš„è§„åˆ™æ‰§è¡Œäº†æ‰€éœ€çš„ä¸šåŠ¡è§„åˆ™ã€‚ï¼ˆ<a href="http://www.drools.org.cn/166.html">è¿˜æ˜¯Droolsä¸­æ–‡ç½‘</a>ï¼‰</p><h4 id="2-3-Droolsç‰¹ç‚¹"><a class="header-anchor" href="#2-3-Droolsç‰¹ç‚¹">Â¶</a>2.3 Droolsç‰¹ç‚¹</h4><ol><li>æ”¯æŒDSLè¯­æ³•ã€XMLè¯­æ³•å®šä¹‰è§„åˆ™ã€‚</li><li>é‡‡ç”¨RETEç®—æ³•</li><li>å¼€æºäº§å“</li><li>JBossäº§å“ï¼Œæˆç†Ÿåº¦é«˜</li></ol><h4 id="2-4-å°±å†³å®šæ˜¯ä½ äº†"><a class="header-anchor" href="#2-4-å°±å†³å®šæ˜¯ä½ äº†">Â¶</a>2.4 å°±å†³å®šæ˜¯ä½ äº†</h4><p>ä¸ç®¡æ˜¯ä»æŠ€æœ¯æ ˆï¼ˆJavaï¼‰è¿˜æ˜¯ä»äº§å“çš„åŠŸèƒ½ä¸Šæ¥çœ‹ï¼ŒDroolsè§„åˆ™å¼•æ“éƒ½å®Œç¾ç¬¦åˆæˆ‘ä»¬å½“å‰çš„ä¸šåŠ¡åœºæ™¯çš„éœ€è¦ï¼Œè€Œåæˆ‘ä»¬åˆè°ƒç ”äº†å®ƒçš„ç®—å­æ”¯æŒã€ç»“æœè¯­å¥çš„æ”¯æŒã€åŠ¨æ€åŠ è½½çš„å®ç°ç­‰å¤šä¸ªæ–¹é¢çš„ç‰¹æ€§ï¼Œæœ€ç»ˆæ•²å®šé‡‡ç”¨è¯¥æ–¹æ¡ˆå®ç°æˆ‘ä»¬çš„è§„åˆ™é…ç½®ä¸­å¿ƒã€‚</p><h3 id="3-è§„åˆ™è¯­æ³•ä»‹ç»"><a class="header-anchor" href="#3-è§„åˆ™è¯­æ³•ä»‹ç»">Â¶</a>3 è§„åˆ™è¯­æ³•ä»‹ç»</h3><p>Droolsé‡‡ç”¨ç‰¹æ®Šçš„DSLè¯­æ³•å®šä¹‰è§„åˆ™ï¼Œå› æ­¤éœ€è¦å…ˆç†Ÿæ‚‰è¯¥éƒ¨åˆ†çš„è¯­æ³•ã€‚</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>sample<span class="token punctuation">.</span>drools<span class="token punctuation">.</span>rule</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span><span class="token punctuation">;</span>function <span class="token function">isZero</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> val <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>rule <span class="token string">"name"</span>no<span class="token operator">-</span>loop <span class="token boolean">true</span>when  $message<span class="token operator">:</span><span class="token class-name">Message</span><span class="token punctuation">(</span>status <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>then  <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"fit"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  $message<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">update</span><span class="token punctuation">(</span>$message<span class="token punctuation">)</span><span class="token punctuation">;</span>end</code></pre><ol><li>importsï¼šè™½ç„¶æ˜¯DSLï¼Œä½†æ˜¯å…¶åŸºäº<code>Java</code>è¯­æ³•ï¼Œå› æ­¤åŒæ ·éœ€è¦ç”¨ Java çš„ import è¯­å¥å®ç°ç±»çš„å¼•ç”¨ã€‚</li><li>functionsï¼šå¯ä»¥å®ç°ä¸€äº›è‡ªå®šä¹‰å‡½æ•°ï¼Œç”¨åœ¨å…·ä½“çš„è§„åˆ™ä¸­ã€‚ç”±äºä½¿ç”¨ DSL è¯­æ³•ï¼Œåœ¨é…ç½®ä¸­å¿ƒéš¾ä»¥å®ç°è¯¥éƒ¨åˆ†ä»£ç æ ¡éªŒï¼Œå› æ­¤æš‚ä¸å®ç°è¯¥éƒ¨åˆ†ã€‚</li><li>rulesï¼šè¯¥éƒ¨åˆ†æ˜¯è§„åˆ™è¯­æ³•çš„é‡ç‚¹ï¼Œå…¶ä¸­åŒ…æ‹¬äº†ruleå£°æ˜è¡Œã€å‚æ•°è¡Œã€æ¡ä»¶ï¼ˆwhenï¼‰ã€ç»“æœï¼ˆthenï¼‰ç­‰éƒ¨åˆ†,ä¸‹é¢ä¾æ¬¡ä»‹ç»ã€‚</li><li>å£°æ˜è¡Œï¼šrule + â€œnameâ€,ä¸€ä¸ªè§„åˆ™çš„åç§°ã€‚</li><li>å‚æ•°è¡Œï¼šå¯ä»¥é…ç½®å½“å‰è§„åˆ™çš„å‚æ•°ï¼Œå¸¸è§çš„æœ‰ï¼šno-loop, silience, agenda-group, auto-focus, activation-group, durationç­‰ï¼Œæœ¬é¡¹ç›®ç”¨åˆ°äº†no-loopï¼šæ˜¯å¦é‡å¤æ‰§è¡Œå½“å‰è§„åˆ™ï¼Œsilienceï¼šä¼˜å…ˆçº§ï¼Œactivation-groupï¼šåŒç»„åªä¼šæ‰§è¡Œä¸€æ¡åŒ¹é…çš„è§„åˆ™ã€‚</li><li>æ¡ä»¶çº¦æŸï¼š æ¡ä»¶è¯­å¥åŸºæœ¬æ ¼å¼æ˜¯ï¼šval:Object([field op value]*),ä¸€äº›ä¾‹å­ï¼š</li></ol><pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">// ä¸€èˆ¬çº¦æŸ</span>$c <span class="token operator">:</span> <span class="token class-name">Cheese</span><span class="token punctuation">(</span> type <span class="token operator">==</span> â€œstiltonâ€<span class="token punctuation">,</span> price <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">,</span> age <span class="token operator">==</span> â€œmatureâ€ <span class="token punctuation">)</span><span class="token comment">// &amp;&amp; å’Œ || çº¦æŸ</span><span class="token class-name">Cheese</span><span class="token punctuation">(</span> type <span class="token operator">==</span> â€œstiltonâ€ <span class="token operator">&amp;&amp;</span> price <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">,</span> age <span class="token operator">==</span> â€œmatureâ€ <span class="token punctuation">)</span><span class="token class-name">Cheese</span><span class="token punctuation">(</span> type <span class="token operator">==</span> â€œstiltonâ€ <span class="token operator">||</span> price <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">,</span> age <span class="token operator">==</span> â€œmatureâ€ <span class="token punctuation">)</span><span class="token comment">// matches æ“ä½œ</span><span class="token class-name">Cheese</span><span class="token punctuation">(</span> type matches â€œ<span class="token punctuation">(</span><span class="token class-name">Buffalo</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token operator">/</span><span class="token class-name">S</span><span class="token operator">*</span><span class="token class-name">Mozerella</span>â€ <span class="token punctuation">)</span><span class="token class-name">Cheese</span><span class="token punctuation">(</span> type not matches â€œ<span class="token punctuation">(</span><span class="token class-name">Buffulo</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token operator">/</span><span class="token class-name">S</span><span class="token operator">*</span><span class="token class-name">Mozerella</span>â€ <span class="token punctuation">)</span><span class="token comment">// contains æ“ä½œ</span><span class="token class-name">CheeseCounter</span><span class="token punctuation">(</span> cheeses contains â€œstiltonâ€ <span class="token punctuation">)</span><span class="token class-name">CheeseCounter</span><span class="token punctuation">(</span> cheeses not contains â€œcheddarâ€ <span class="token punctuation">)</span><span class="token comment">// memberof æ“ä½œ</span><span class="token class-name">CheeseCounter</span><span class="token punctuation">(</span> cheese memberof $matureCheeses <span class="token punctuation">)</span><span class="token class-name">CheeseCounter</span><span class="token punctuation">(</span> cheese not memberof $matureCheeses <span class="token punctuation">)</span><span class="token comment">// å­—ç¬¦ä¸²çº¦æŸ</span><span class="token class-name">Cheese</span><span class="token punctuation">(</span> quantity <span class="token operator">==</span> <span class="token number">5</span> <span class="token punctuation">)</span><span class="token class-name">Cheese</span><span class="token punctuation">(</span> bestBefore <span class="token operator">&lt;</span> â€œ<span class="token number">27</span><span class="token operator">-</span><span class="token class-name">Oct</span><span class="token operator">-</span><span class="token number">2007</span>â€ <span class="token punctuation">)</span><span class="token class-name">Cheese</span><span class="token punctuation">(</span> type <span class="token operator">==</span> â€œstiltonâ€ <span class="token punctuation">)</span><span class="token class-name">Cheese</span><span class="token punctuation">(</span> smelly <span class="token operator">==</span> <span class="token boolean">true</span> <span class="token punctuation">)</span><span class="token comment">// ç»‘å®šå˜é‡çº¦æŸ</span><span class="token class-name">Person</span><span class="token punctuation">(</span> likes <span class="token operator">:</span> favouriteCheese <span class="token punctuation">)</span><span class="token class-name">Cheese</span><span class="token punctuation">(</span> type <span class="token operator">==</span> likes <span class="token punctuation">)</span><span class="token comment">// è¿”å›å€¼çº¦æŸ</span><span class="token class-name">Person</span><span class="token punctuation">(</span> girlAge <span class="token operator">:</span> age<span class="token punctuation">,</span> sex <span class="token operator">==</span> â€œ<span class="token class-name">F</span>â€ <span class="token punctuation">)</span><span class="token class-name">Person</span><span class="token punctuation">(</span> age <span class="token operator">==</span> <span class="token punctuation">(</span> girlAge <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">,</span> sex <span class="token operator">==</span> â€˜<span class="token class-name">M</span>â€™ <span class="token punctuation">)</span><span class="token comment">// å¤åˆå€¼çº¦æŸ</span><span class="token class-name">Person</span><span class="token punctuation">(</span> $cheese <span class="token operator">:</span> favouriteCheese <span class="token punctuation">)</span><span class="token class-name">Cheese</span><span class="token punctuation">(</span> type in <span class="token punctuation">(</span> â€œstiltonâ€<span class="token punctuation">,</span> â€œcheddarâ€<span class="token punctuation">,</span> $cheese <span class="token punctuation">)</span><span class="token comment">// å¤šé‡çº¦æŸ</span><span class="token class-name">Person</span><span class="token punctuation">(</span> age <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token operator">></span> <span class="token number">30</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">&lt;</span> <span class="token number">40</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token operator">></span> <span class="token number">20</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">&lt;</span> <span class="token number">25</span><span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token class-name">Person</span><span class="token punctuation">(</span> age <span class="token operator">></span> <span class="token number">30</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">&lt;</span> <span class="token number">40</span> <span class="token operator">||</span> location <span class="token operator">==</span> â€œlondonâ€ <span class="token punctuation">)</span><span class="token comment">// å†…è” eval çº¦æŸ</span><span class="token class-name">Person</span><span class="token punctuation">(</span> girlAge <span class="token operator">:</span> age<span class="token punctuation">,</span> sex <span class="token operator">=</span> â€œ<span class="token class-name">F</span>â€ <span class="token punctuation">)</span><span class="token class-name">Person</span><span class="token punctuation">(</span> <span class="token function">eval</span><span class="token punctuation">(</span> girlAge <span class="token operator">==</span> boyAge <span class="token operator">+</span> <span class="token number">2</span> <span class="token punctuation">)</span><span class="token punctuation">,</span> sex <span class="token operator">=</span> â€˜<span class="token class-name">M</span>â€™ <span class="token punctuation">)</span></code></pre><ol start="7"><li>æ‰§è¡Œæ“ä½œï¼šè¿™éƒ¨åˆ†çš„ä»£ç è™½ç„¶å¯ä»¥ç›´æ¥å†™<code>Java</code>ç¨‹åºï¼Œä½†æ˜¯åº”è¯¥ç®€çŸ­ï¼Œä¸»è¦ç›®çš„æ˜¯æ’å…¥å’Œæ›´æ–°ã€‚</li></ol><blockquote><p>æ­¤å¤–ï¼Œè¿˜æœ‰<code>query</code>ç­‰å…¶ä»–è§„åˆ™æˆåˆ†ï¼Œç”±äºå¤æ‚åº¦çš„é™åˆ¶ï¼Œé¡¹ç›®ä¸­ä¸ä¼šé‡‡ç”¨è¿™äº›åŠŸèƒ½ï¼Œè¿™é‡Œä¹Ÿä¸åšä»‹ç»ã€‚</p></blockquote><h3 id="4-å°†Droolsåº”ç”¨åˆ°é¡¹ç›®ä¸­"><a class="header-anchor" href="#4-å°†Droolsåº”ç”¨åˆ°é¡¹ç›®ä¸­">Â¶</a>4 å°†Droolsåº”ç”¨åˆ°é¡¹ç›®ä¸­</h3><p>ä»ä¸Šè¿°çš„è§„åˆ™æ–‡ä»¶è¯­æ³•ä¸­å¯ä»¥çœ‹å‡ºï¼Œå®ƒçš„è¯­æ³•è§„åˆ™åŸºäºJavaï¼Œæ˜¯éå¸¸çµæ´»çš„ã€‚ä½†æ˜¯æœ¬åœºæ™¯ä¸‹éœ€è¦å°†è¿™éƒ¨åˆ†çš„åŠŸèƒ½æä¾›ç»™ä¸šåŠ¡æ–¹é…ç½®ï¼Œå› æ­¤è¿‡äºçµæ´»çš„é…ç½®æ–¹æ¡ˆä¸ç®¡æ˜¯å®ç°ï¼Œè¿˜æ˜¯äº¤ä»˜ä½¿ç”¨æˆæœ¬éƒ½å°†ä¼šéå¸¸é«˜ï¼Œå› æ­¤éœ€è¦å¯¹è§„åˆ™è¿›è¡Œä¸€å®šç¨‹åº¦çš„é™åˆ¶ã€‚</p><ul><li>åŒ¹é…çš„è¿‡ç¨‹æ¡ä»¶æ˜¯å¤šä¸ªå¯¹è±¡ã€æ¯ä¸ªå¯¹è±¡åˆæœ‰å¤šä¸ªå­—æ®µçš„åˆ¤æ–­ï¼Œè¿™éƒ¨åˆ†çš„å¤šæ¬¡é…ç½®å°†ä¼šé€ æˆä¸šåŠ¡æ–¹ä¸€å®šå›°æ‰°ï¼Œå› æ­¤è¿™é‡Œæˆ‘ä»¬ç®€åŒ–ä¸ºï¼šä¼ å…¥ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…æ‹¬æ‰€æœ‰å­—æ®µï¼Œä¸šåŠ¡ä»…é€‰æ‹©å­—æ®µå’Œå†™å¯¹åº”æ¯ä¸ªå­—æ®µçš„ç­›é€‰æ¡ä»¶å³å¯ã€‚</li><li>importsï¼šæˆ‘ä»¬é»˜è®¤å¯¼å…¥java.util.Mapå’Œjava.util.HashMapä½œä¸ºç»“æœé›†çš„ç±»å‹ï¼Œä»¥åŠå…¥å‚çš„å¯¹è±¡çš„å¼•ç”¨ã€‚</li><li>function å’Œ queryï¼šå‡ºäºç®€åŒ–è€ƒè™‘æš‚ä¸å®ç°è¯¥éƒ¨åˆ†çš„é…ç½®ã€‚</li><li>ruleå‚æ•°é…ç½®ï¼šè¿™é‡Œä½¿ç”¨äº†éƒ¨åˆ†éœ€è¦çš„å‚æ•°ï¼š<ul><li>salienceï¼šä¼˜å…ˆçº§ï¼Œè¿™ä¸ªå‚æ•°æ˜¯æä¾›ç»™ç”¨æˆ·é…ç½®çš„ï¼Œç¡®è®¤æ‰§è¡Œçš„é¡ºåºã€‚</li><li>activation-groupï¼šä¸€ä¸ªè§„åˆ™é›†ä¸­çš„è§„åˆ™éƒ½åœ¨åŒä¸€ä¸ªåˆ†ç»„ä¸­ï¼Œé¿å…åŒ¹é…å®Œé«˜ä¼˜å…ˆçº§çš„è§„åˆ™åä»ç„¶è¿›å…¥ä½ä¼˜å…ˆçº§çš„è§„åˆ™å¯¼è‡´ç»“æœé›†å­—æ®µè¢«è¦†ç›–ã€‚</li><li>no-loopï¼šæœ¬æ˜¯ç”¨äºé˜²æ­¢è§„åˆ™é‡å¤åŒ¹é…ï¼Œè¿™é‡Œç»“æœæ“ä½œä¸­æ²¡æœ‰updateæ“ä½œï¼Œå› æ­¤ä¹Ÿä¸ä¼šå‡ºç°é‡å¤åŒ¹é…ï¼Œä¸ºäº†ä¿é™©è¿˜æ˜¯è®¾ç½®ä¸€ä¸‹è¯¥å‚æ•°ã€‚</li></ul></li><li>rule æ¡ä»¶é…ç½®ï¼šåªæä¾›ä¸€ä¸ªæ¡ä»¶å¯¹è±¡å’Œè¿”å›ç»“æœé›†åˆï¼Œç”¨æˆ·èƒ½é…ç½®çš„éƒ¨åˆ†ä¸ºæ¡ä»¶å¯¹è±¡çš„å­—æ®µçš„æ¡ä»¶ï¼Œæ¡ä»¶é—´çš„å…³ç³»æš‚å®šé€—å·åˆ†éš”ï¼Œéƒ½ä¸ºä¸”ï¼ˆ&amp;&amp;ï¼‰ã€‚</li><li>rule ç»“æœé…ç½®ï¼šå¯ä»¥ç›´æ¥å†™ Java ç¨‹åºï¼Œä½†æ˜¯ä¸ºäº†ä¿è¯ä¸šåŠ¡æ–¹çš„ä½¿ç”¨ä½“éªŒï¼Œå› æ­¤è¿™éƒ¨åˆ†åšäº†æå¤§çš„é™åˆ¶ï¼šåªèƒ½å‘ä¼ å…¥çš„Mapä¸­å†™å…¥é”®å€¼å¯¹ã€‚è€Œä¸”é”®ä¹Ÿæ˜¯ç”±ç®¡ç†å‘˜é…ç½®çš„å­—æ®µä¸­é€‰å–ï¼Œä»è€Œä¿è¯äº†ä¸šåŠ¡æ–¹é¢çš„ä½¿ç”¨ä¸ä¼šæœ‰å¤ªé«˜çš„é—¨æ§›ã€‚<br>ç»¼åˆä»¥ä¸Šçš„æ¡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°æˆ‘ä»¬é¡¹ç›®ä¸­ä½¿ç”¨çš„è§„åˆ™æ–‡ä»¶çš„åŸºæœ¬ç»“æ„ï¼š</li></ul><pre class="language-none"><code class="language-none">package com.sample.drools.ruleimport java.util.Mapimport java.util.HashMapimport com.sample.RuleConditionrule &quot;[ruleName]&quot;  no-loop: true  salience: [priority]  activation-group: sample  when    $condition: Condition([f1] [op] [v1], [f2] [op] [v2])    $resultMap: HashMap()  then    $resultMap.put([key1], [value1])    $resultMap.put([key2], [value2])    ...end</code></pre><p>ä¸Šè¿°çš„ä»£ç ï¼Œåªæœ‰æ‹¬å·åŒ…å«çš„å€¼æ˜¯ç”¨æˆ·é…ç½®çš„ï¼Œè€Œä¸”å¤§éƒ¨åˆ†éƒ½ä¸ºé€‰é¡¹ï¼Œæœ€å¤§ç¨‹åº¦é™ä½äº†é…ç½®æˆæœ¬ã€‚ä½†æ˜¯ä¸ºäº†ä¿è¯å¥å£®å’Œçµæ´»æ€§ï¼Œä¹Ÿéœ€è¦å°†æ¯ä¸ªè§„åˆ™é›†çš„æ¡ä»¶å’Œç»“æœå®šä¹‰äº¤ç»™æ›´æœ‰ç»éªŒçš„å¼€å‘è€…é…ç½®ï¼Œå› æ­¤åŒæ ·éœ€è¦è®¾è®¡ä¸€ä¸ªè§„åˆ™é›†å’Œå­—æ®µç®¡ç†çš„ç®¡ç†å‘˜é…ç½®æ¨¡å—ã€‚</p><h3 id="5-åŠŸèƒ½è®¾è®¡"><a class="header-anchor" href="#5-åŠŸèƒ½è®¾è®¡">Â¶</a>5 åŠŸèƒ½è®¾è®¡</h3><p>åŠŸèƒ½è®¾è®¡ä¸Šå‚è€ƒä¹‹å‰é€šç”¨ç­–ç•¥éƒ¨åˆ†ï¼Œå®ç°äº†â€œç®¡ç†å‘˜ä¾§â€å’Œâ€œç”¨æˆ·ä¾§â€2éƒ¨åˆ†çš„ç®¡ç†ç³»ç»Ÿï¼Œå…·ä½“åŠŸèƒ½å¦‚ä¸‹å›¾ï¼š<br><img onerror="imgOnError(this);" data-fancybox="gallery" src="/images/%E9%80%9A%E7%94%A8%E8%A7%84%E5%88%99%E5%BC%95%E6%93%8E%E5%8A%9F%E8%83%BD%E8%AE%BE%E8%AE%A1.png" alt="åŠŸèƒ½è®¾è®¡å›¾" data-caption="åŠŸèƒ½è®¾è®¡å›¾" loading="lazy"><br>ç®¡ç†å‘˜ä¾§å¯ä»¥åˆ›å»ºè§„åˆ™é›†ï¼Œå¯¹åº”ç€åº”ç”¨è§„åˆ™çš„ä¸åŒåœºæ™¯ï¼ŒåŒæ—¶å¯ä»¥ä¿®æ”¹åˆ é™¤ï¼›è¿˜éœ€è¦å®ç°è§„åˆ™é›†å†…æ‰€æœ‰æ¡ä»¶å­—æ®µã€ç»“æœå­—æ®µçš„æ–°å¢è°ƒæ•´ï¼Œä»¥ä¾›ç”¨æˆ·ä¾§é€‰æ‹©ã€‚<br>ç”¨æˆ·ä¾§å¯ä»¥é€‰æ‹©ä¸€ä¸ªè§„åˆ™é›†ï¼Œæ·»åŠ æ–°çš„è§„åˆ™ï¼Œæ·»åŠ çš„æ—¶å€™è¦åŒæ—¶åœ¨æ‰€æœ‰å­—æ®µä¸­é€‰æ‹©æ‰€éœ€è¦çš„æ¡ä»¶å­—æ®µã€ç»“æœå­—æ®µï¼Œå¹¶è®¾ç½®å¥½ä»–ä»¬çš„æ“ä½œç¬¦å’Œå€¼ï¼Œç¡®è®¤å½“å‰è§„åˆ™çš„æ‰§è¡Œæµç¨‹ã€‚ç”¨æˆ·åŒæ ·å¯ä»¥ä¿®æ”¹ã€åˆ é™¤è§„åˆ™ã€‚<br>ç®¡ç†å‘˜åœ¨ç¼–è¾‘è§„åˆ™é›†å’Œè§„åˆ™é›†å­—æ®µçš„æ—¶å€™æœ‰ä½¿ç”¨çŠ¶æ€çº¦æŸï¼Œåœ¨ä½¿ç”¨ä¸­çš„è§„åˆ™é›†å’Œå­—æ®µæ˜¯æ— æ³•åˆ é™¤çš„ï¼›ç”¨æˆ·åœ¨ç¼–è¾‘è§„åˆ™å’Œå­—æ®µçš„æ—¶å€™æœ‰è§„åˆ™å¼•æ“æ ¡éªŒçº¦æŸï¼Œå¦‚æœå¡«å†™çš„è§„åˆ™å¯¼è‡´æ ¡éªŒå¤±è´¥ï¼ŒåŒæ ·æ˜¯æ— æ³•é…ç½®çš„ã€‚</p><h3 id="6-åº“è¡¨ç»“æ„è®¾è®¡"><a class="header-anchor" href="#6-åº“è¡¨ç»“æ„è®¾è®¡">Â¶</a>6 åº“è¡¨ç»“æ„è®¾è®¡</h3><p>åŸæœ¬è®¡åˆ’ç”¨ä¸€å¥—æ–°åº“è¡¨ç»“æ„å®ç°è¯¥éƒ¨åˆ†çš„æ•°æ®å­˜å‚¨ï¼Œä¸ºäº†éªŒè¯é€šç”¨ç­–ç•¥çš„æ‹“å±•æ€§ï¼Œå› æ­¤å°†é€šç”¨è§„åˆ™éƒ¨åˆ†çš„æ•°æ®é€‚é…åˆ°é€šç”¨ç­–ç•¥çš„åº“è¡¨ç»“æ„ä¸­ã€‚<br><img onerror="imgOnError(this);" data-fancybox="gallery" src="/images/strategy_db_uml.png" alt="åº“è¡¨ç»“æ„UML" data-caption="åº“è¡¨ç»“æ„UML" loading="lazy"><br>ä¸è¿‡æ¯”è¾ƒå¥½çš„æ˜¯ï¼Œè¯¥åº“è¡¨ç»“æ„åªéœ€è¦è¿›è¡Œå°‘é‡çš„æ‹“å±•å³å¯å®ç°å¯¹è§„åˆ™éƒ¨åˆ†çš„æ”¯æŒã€‚</p><ol><li>ç­–ç•¥é›†å­—æ®µå¢åŠ è§’è‰²ä¿¡æ¯å­—æ®µï¼ˆroleï¼‰ï¼Œæ˜¯å¦å¿…å¡«ï¼ˆisRequiredï¼‰ã€‚</li><li>ç­–ç•¥é›†è¡¨å¢åŠ <code>type</code>å±æ€§åˆ¤æ–­æ˜¯è§„åˆ™è¿˜æ˜¯ç­–ç•¥ã€‚<br>è§„åˆ™æ–‡ä»¶å’Œåº“è¡¨ç»“æ„å¯¹åº”å…³ç³»å¦‚ä¸‹è¡¨ï¼š<br>|è§„åˆ™æ–‡ä»¶å­—æ®µ|åº“è¡¨ç»“æ„ä½ç½®|<br>|â€“|â€“|<br>|||</li></ol><h3 id="7-å®ç°æ•ˆæœå±•ç¤º"><a class="header-anchor" href="#7-å®ç°æ•ˆæœå±•ç¤º">Â¶</a>7 å®ç°æ•ˆæœå±•ç¤º</h3><h3 id="8-åç»­å¼€å‘è®¡åˆ’"><a class="header-anchor" href="#8-åç»­å¼€å‘è®¡åˆ’">Â¶</a>8 åç»­å¼€å‘è®¡åˆ’</h3><h4 id="8-1-å¸¦æœ‰é€»è¾‘çš„è§„åˆ™è¯­å¥çš„æ”¯æŒ"><a class="header-anchor" href="#8-1-å¸¦æœ‰é€»è¾‘çš„è§„åˆ™è¯­å¥çš„æ”¯æŒ">Â¶</a>8.1 å¸¦æœ‰é€»è¾‘çš„è§„åˆ™è¯­å¥çš„æ”¯æŒ</h4>]]></content>
      
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> drools </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é€šç”¨ç­–ç•¥æ–‡æ¡£</title>
      <link href="/2019/11/26/%E9%80%9A%E7%94%A8%E7%AD%96%E7%95%A5%E6%96%87%E6%A1%A3/"/>
      <url>/2019/11/26/%E9%80%9A%E7%94%A8%E7%AD%96%E7%95%A5%E6%96%87%E6%A1%A3/</url>
      
        <content type="html"><![CDATA[<h2 id="é¡¹ç›®èƒŒæ™¯"><a class="header-anchor" href="#é¡¹ç›®èƒŒæ™¯">Â¶</a>é¡¹ç›®èƒŒæ™¯</h2><p>åœºæ™¯æ˜¯æ ¹æ®ä¸€äº›æ¡ä»¶å»æŸ¥è¯¢æŒ‡å®šçš„ç»“æœï¼Œåœºæ™¯è¾ƒå¤šï¼Œå¦‚æœæ¯ä¸ªåœºæ™¯éƒ½ç»´æŠ¤ä¸€å¥—å¯¹åº”çš„åº“è¡¨å’Œæ•°æ®ç»“æ„ï¼Œæˆæœ¬è¿‡é«˜è€Œä¸”ä¸é€šç”¨ï¼Œè¿™é‡Œç”¨é€šç”¨ç­–ç•¥å»é…ç½®ï¼Œå®ç°çš„æ•ˆæœæ˜¯ä¼ å…¥æŒ‡å®šçš„ç­–ç•¥codeå’Œæ¡ä»¶æ•°æ®å¯ä»¥å¾—åˆ°å¯¹åº”çš„æŸ¥è¯¢ç»“æœã€‚<br>åœ¨å¾ˆå¤šåœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®ä¸€äº›æ¡ä»¶å»æŸ¥è¯¢ç»“æœï¼Œ</p><h2 id="é¡¹ç›®åœ°å€"><a class="header-anchor" href="#é¡¹ç›®åœ°å€">Â¶</a>é¡¹ç›®åœ°å€</h2><table><thead><tr><th></th><th>å‰ç«¯åœ°å€</th><th>ç®¡ç†åœ°å€</th></tr></thead><tbody><tr><td>æµ‹è¯•ç¯å¢ƒ</td><td><a href="http://wl.be.test.mi.com/oms">http://wl.be.test.mi.com/oms</a></td><td><a href="http://wl.be.test.mi.com/oms/#/admin/common-strategy">http://wl.be.test.mi.com/oms/#/admin/common-strategy</a></td></tr><tr><td>çº¿ä¸Šç¯å¢ƒ</td><td><a href="http://wl.be.mi.com/oms">http://wl.be.mi.com/oms</a></td><td><a href="http://wl.be.mi.com/oms/#/admin/common-strategy">http://wl.be.mi.com/oms/#/admin/common-strategy</a></td></tr></tbody></table><ul><li>å¦‚é‡æ— æ³•ç™»é™†è¯·åœ¨å·¥ä½œå°(<a href="http://wl.be.test.mi.com/work/">æµ‹è¯•</a>/<a href="http://wl.be.mi.com/work/">çº¿ä¸Š</a>)æ·»åŠ ç³»ç»Ÿæƒé™ã€‚</li></ul><h2 id="ä½¿ç”¨æŒ‡å—"><a class="header-anchor" href="#ä½¿ç”¨æŒ‡å—">Â¶</a>ä½¿ç”¨æŒ‡å—</h2><h3 id="1-åˆ›å»ºç­–ç•¥é›†"><a class="header-anchor" href="#1-åˆ›å»ºç­–ç•¥é›†">Â¶</a>1. åˆ›å»ºç­–ç•¥é›†</h3><h3 id="2-å®šä¹‰ç­–ç•¥é›†å­—æ®µ"><a class="header-anchor" href="#2-å®šä¹‰ç­–ç•¥é›†å­—æ®µ">Â¶</a>2. å®šä¹‰ç­–ç•¥é›†å­—æ®µ</h3><h3 id="3-åˆ›å»ºç­–ç•¥"><a class="header-anchor" href="#3-åˆ›å»ºç­–ç•¥">Â¶</a>3. åˆ›å»ºç­–ç•¥</h3><h3 id="4-é€‰æ‹©ç­–ç•¥å­—æ®µ"><a class="header-anchor" href="#4-é€‰æ‹©ç­–ç•¥å­—æ®µ">Â¶</a>4. é€‰æ‹©ç­–ç•¥å­—æ®µ</h3><h3 id="5-ä¸‹è½½ç­–ç•¥å’ŒåŸºç¡€æ•°æ®"><a class="header-anchor" href="#5-ä¸‹è½½ç­–ç•¥å’ŒåŸºç¡€æ•°æ®">Â¶</a>5. ä¸‹è½½ç­–ç•¥å’ŒåŸºç¡€æ•°æ®</h3><h3 id="6-å¡«å†™å¥½ç­–ç•¥æ•°æ®ï¼Œå¹¶å¯¼å…¥"><a class="header-anchor" href="#6-å¡«å†™å¥½ç­–ç•¥æ•°æ®ï¼Œå¹¶å¯¼å…¥">Â¶</a>6. å¡«å†™å¥½ç­–ç•¥æ•°æ®ï¼Œå¹¶å¯¼å…¥</h3><h3 id="7-å®šä¹‰è¯¥ç­–ç•¥çš„åŒ¹é…è§„åˆ™"><a class="header-anchor" href="#7-å®šä¹‰è¯¥ç­–ç•¥çš„åŒ¹é…è§„åˆ™">Â¶</a>7. å®šä¹‰è¯¥ç­–ç•¥çš„åŒ¹é…è§„åˆ™</h3><h3 id="8-é€šè¿‡ç³»ç»Ÿç¬¬ä¸‰æ–¹X5æ¥å£æŸ¥è¯¢ç­–ç•¥æ•°æ®"><a class="header-anchor" href="#8-é€šè¿‡ç³»ç»Ÿç¬¬ä¸‰æ–¹X5æ¥å£æŸ¥è¯¢ç­–ç•¥æ•°æ®">Â¶</a>8. é€šè¿‡ç³»ç»Ÿç¬¬ä¸‰æ–¹X5æ¥å£æŸ¥è¯¢ç­–ç•¥æ•°æ®</h3>]]></content>
      
      
      
        <tags>
            
            <tag> mi </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
