import{_ as g}from"./ValaxyMain.vue_vue_type_style_index_0_lang.BOxa4x0W.js";import"./chunks/@vueuse/motion.DExMrowK.js";import{e as m,u as E,a as c}from"./chunks/vue-router.BNn-cICo.js";import{aa as y,ap as n,ag as t,af as s,ae as b,ai as a,F,ab as u,Z as f}from"./framework.BfPwxjTV.js";import"./app.CvLFRx2e.js";import"./chunks/dayjs.BdcnXKr1.js";import"./chunks/vue-i18n.Bc4ESJIK.js";import"./chunks/pinia.wpQ7btRk.js";import"./chunks/nprogress.0ha8kAew.js";/* empty css                    */import"./YunComment.vue_vue_type_style_index_0_lang.BajIiQUt.js";import"./index.C5okkQwF.js";import"./YunPageHeader.vue_vue_type_script_setup_true_lang.Dm5vxeuM.js";import"./post.jxfEQmKM.js";const B=m("/posts/macOS_config_mongoDB_transaction",async e=>JSON.parse('{"title":"macOS配置mongoDB支持事务","description":"","frontmatter":{"layout":"post","title":"macOS配置mongoDB支持事务","date":"2025-03-17 21:06:00"},"headers":[],"relativePath":"pages/posts/macOS_config_mongoDB_transaction.md","lastUpdated":1769141942000}'),{lazy:(e,o)=>e.name===o.name}),z={__name:"macOS_config_mongoDB_transaction",setup(e,{expose:o}){const{data:h}=B(),k=c(),p=E(),r=Object.assign(p.meta.frontmatter||{},h.value?.frontmatter||{});return k.currentRoute.value.data=h.value,f("valaxy:frontmatter",r),globalThis.$frontmatter=r,o({frontmatter:{layout:"post",title:"macOS配置mongoDB支持事务",date:"2025-03-17 21:06:00"}}),(l,i)=>{const d=g;return u(),y(d,{frontmatter:F(r)},{"main-content-md":n(()=>[i[0]||(i[0]=s("h1",{id:"背景",tabindex:"-1"},[a("背景 "),s("a",{class:"header-anchor",href:"#背景","aria-label":'Permalink to "背景"'},"​")],-1)),i[1]||(i[1]=s("p",null,[a("在 macOS 中使用 homebrew 安装 mongoDB 很方便，"),s("code",null,"brew install mongodb-community"),a(" 即可快速安装好 mongoDB 并使用,但是默认安装的版本是 stand alone 的,在使用事务相关特性时会出现错误:")],-1)),b(" more "),i[2]||(i[2]=s("div",{class:"language-bash"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"MongoServerError:"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," Transaction"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," numbers"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," are"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," only"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," allowed"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," on"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," a"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," replica"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," set"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," member"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," or"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," mongos...")])])]),s("button",{class:"code-block-unfold-btn"})],-1)),i[3]||(i[3]=s("p",null,"需要将本地部署的 mongoDB 改为 replica，集群模式才能正常使用事务。",-1)),i[4]||(i[4]=s("h1",{id:"步骤",tabindex:"-1"},[a("步骤 "),s("a",{class:"header-anchor",href:"#步骤","aria-label":'Permalink to "步骤"'},"​")],-1)),i[5]||(i[5]=s("h2",{id:"_1-停止本地的-mongodb-服务",tabindex:"-1"},[a("1. 停止本地的 mongoDB 服务 "),s("a",{class:"header-anchor",href:"#_1-停止本地的-mongodb-服务","aria-label":'Permalink to "1. 停止本地的 mongoDB 服务"'},"​")],-1)),i[6]||(i[6]=s("div",{class:"language-bash"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"brew"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," services"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," stop"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," mongodb-community")])])]),s("button",{class:"code-block-unfold-btn"})],-1)),i[7]||(i[7]=s("h2",{id:"_2-修改-brew-安装的-mongodb-配置文件",tabindex:"-1"},[a("2. 修改 brew 安装的 mongoDB 配置文件 "),s("a",{class:"header-anchor",href:"#_2-修改-brew-安装的-mongodb-配置文件","aria-label":'Permalink to "2. 修改 brew 安装的 mongoDB 配置文件"'},"​")],-1)),i[8]||(i[8]=s("div",{class:"language-bash"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"sudo"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," vim"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," /opt/homebrew/etc/mongod.conf")])])]),s("button",{class:"code-block-unfold-btn"})],-1)),i[9]||(i[9]=s("div",{class:"language-conf"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"conf"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",null,"systemLog:")]),a(`
`),s("span",{class:"line"},[s("span",null,"  destination: file")]),a(`
`),s("span",{class:"line"},[s("span",null,"  path: /opt/homebrew/var/log/mongodb/mongo.log")]),a(`
`),s("span",{class:"line"},[s("span",null,"  logAppend: true")]),a(`
`),s("span",{class:"line"},[s("span",null,"storage:")]),a(`
`),s("span",{class:"line"},[s("span",null,"  dbPath: /opt/homebrew/var/mongodb")]),a(`
`),s("span",{class:"line"},[s("span",null,"net:")]),a(`
`),s("span",{class:"line"},[s("span",null,"  bindIp: localhost  # this line")]),a(`
`),s("span",{class:"line"},[s("span",null,"  ipv6: true")]),a(`
`),s("span",{class:"line"},[s("span",null,"replication:")]),a(`
`),s("span",{class:"line"},[s("span",null,'  replSetName: "rs0" # and this line')])])]),s("button",{class:"code-block-unfold-btn"})],-1)),i[10]||(i[10]=s("p",null,"保存并退出",-1)),i[11]||(i[11]=s("h2",{id:"_3-重新启动-mongodb-服务",tabindex:"-1"},[a("3. 重新启动 mongoDB 服务 "),s("a",{class:"header-anchor",href:"#_3-重新启动-mongodb-服务","aria-label":'Permalink to "3. 重新启动 mongoDB 服务"'},"​")],-1)),i[12]||(i[12]=s("div",{class:"language-bash"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"brew"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," services"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," start"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," mongodb-community")])])]),s("button",{class:"code-block-unfold-btn"})],-1)),i[13]||(i[13]=s("h2",{id:"_4-验证结果",tabindex:"-1"},[a("4. 验证结果 "),s("a",{class:"header-anchor",href:"#_4-验证结果","aria-label":'Permalink to "4. 验证结果"'},"​")],-1)),i[14]||(i[14]=s("p",null,[a("在"),s("a",{href:"https://www.mongodb.com/try/download/atlascli",target:"_blank",rel:"noreferrer"},"官方 APP"),a("中就可以清晰看到我们部署的服务已经变成了 replica 的模式:")],-1)),i[15]||(i[15]=s("figure",null,[s("img",{src:"https://xiaohaoxing-1257815318.cos.ap-chengdu.myqcloud.com/blog/%E6%88%AA%E5%B1%8F2025-03-17%2021.14.08.png",alt:"",loading:"lazy",decoding:"async"})],-1)),i[16]||(i[16]=s("h2",{id:"_5-代码实现",tabindex:"-1"},[a("5. 代码实现 "),s("a",{class:"header-anchor",href:"#_5-代码实现","aria-label":'Permalink to "5. 代码实现"'},"​")],-1)),i[17]||(i[17]=s("p",null,"写一点简单的 TypeScript 来验证结果：",-1)),i[18]||(i[18]=s("div",{class:"language-typescript"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"typescript"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"  ...")]),a(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"  try"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),a(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    await"),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," withTransaction"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"async"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),s("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"session"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=>"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),a(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"      // 删除正向关系")]),a(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"      await"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," FriendshipModel."),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"deleteOne"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"({")]),a(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        userId,")]),a(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        friendId,")]),a(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"      })."),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"session"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(session)")]),a(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"      // 删除反向关系")]),a(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"      await"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," FriendshipModel."),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"deleteOne"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"({")]),a(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        userId: friendId,")]),a(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        friendId: userId,")]),a(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"      })."),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"session"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(session)")]),a(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    })")]),a(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  } "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"catch"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (error) {")]),a(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    console."),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"log"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(error)")]),a(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    throw"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Error"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'删除好友关系失败'"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),a(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  }")]),a(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"  ...")])])]),s("button",{class:"code-block-unfold-btn"})],-1)),i[19]||(i[19]=s("h1",{id:"参考资料",tabindex:"-1"},[a("参考资料 "),s("a",{class:"header-anchor",href:"#参考资料","aria-label":'Permalink to "参考资料"'},"​")],-1)),i[20]||(i[20]=s("ol",null,[s("li",null,[s("a",{href:"https://www.mongodb.com/zh-cn/docs/manual/tutorial/convert-standalone-to-replica-set/",target:"_blank",rel:"noreferrer"},"将独立运行的自管理mongod转换为副本集 - MongoDB手册 v8.0 - MongoDB Docs")]),s("li",null,[s("a",{href:"https://stackoverflow.com/questions/51461952/mongodb-v4-0-transaction-mongoerror-transaction-numbers-are-only-allowed-on-a",target:"_blank",rel:"noreferrer"},"javascript - Mongodb v4.0 Transaction, MongoError: Transaction numbers are only allowed on a replica set member or mongos - Stack Overflow")])],-1))]),"main-header":n(()=>[t(l.$slots,"main-header")]),"main-header-after":n(()=>[t(l.$slots,"main-header-after")]),"main-nav":n(()=>[t(l.$slots,"main-nav")]),"main-content-before":n(()=>[t(l.$slots,"main-content-before")]),"main-content":n(()=>[t(l.$slots,"main-content")]),"main-content-after":n(()=>[t(l.$slots,"main-content-after")]),"main-nav-before":n(()=>[t(l.$slots,"main-nav-before")]),"main-nav-after":n(()=>[t(l.$slots,"main-nav-after")]),comment:n(()=>[t(l.$slots,"comment")]),footer:n(()=>[t(l.$slots,"footer")]),aside:n(()=>[t(l.$slots,"aside")]),"aside-custom":n(()=>[t(l.$slots,"aside-custom")]),default:n(()=>[t(l.$slots,"default")]),_:3},8,["frontmatter"])}}};export{z as default,B as usePageData};
